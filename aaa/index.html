<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.2">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha256-XOqroi11tY4EFQMR9ZYwZWKj5ZXiftSx36RRuC3anlA=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"abelxiaoxing.github.io","root":"/","images":"/images","scheme":"Muse","darkmode":false,"version":"8.20.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="一个个人资料记录的小地方">
<meta property="og:type" content="website">
<meta property="og:title" content="abel的小天地">
<meta property="og:url" content="https://abelxiaoxing.github.io/aaa/index.html">
<meta property="og:site_name" content="abel的小天地">
<meta property="og:description" content="一个个人资料记录的小地方">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="abelxiaoxing">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://abelxiaoxing.github.io/aaa/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"aaa/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>abel的小天地</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">abel的小天地</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
    </div>
  </div>
</div>







</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">abelxiaoxing</p>
  <div class="site-description" itemprop="description">一个个人资料记录的小地方</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">8</span>
        <span class="site-state-item-name">标签</span>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://abelxiaoxing.github.io/2025/03/14/%E7%BB%93%E6%9E%84%E5%9B%BE%E6%B5%81%E7%A8%8B%E5%9B%BE%E5%BF%AB%E9%80%9F%E7%BB%98%E5%88%B6%E6%96%B9%E6%B3%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="abelxiaoxing">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="abel的小天地">
      <meta itemprop="description" content="一个个人资料记录的小地方">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | abel的小天地">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/03/14/%E7%BB%93%E6%9E%84%E5%9B%BE%E6%B5%81%E7%A8%8B%E5%9B%BE%E5%BF%AB%E9%80%9F%E7%BB%98%E5%88%B6%E6%96%B9%E6%B3%95/" class="post-title-link" itemprop="url">结构图/流程图快速绘制方法（Trae+Claude+DrawIO工作流）</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2025-03-14 17:04:34" itemprop="dateCreated datePublished" datetime="2025-03-14T17:04:34+08:00">2025-03-14</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-03-18 17:25:26" itemprop="dateModified" datetime="2025-03-18T17:25:26+08:00">2025-03-18</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="🌐-工具准备清单"><a href="#🌐-工具准备清单" class="headerlink" title="🌐 工具准备清单"></a>🌐 工具准备清单</h2><ol>
<li>科学上网工具（必备）</li>
<li><a target="_blank" rel="noopener" href="https://www.trae.ai/">Trae.ai 官网</a></li>
<li><a target="_blank" rel="noopener" href="https://www.diagrams.net/">DrawIO 下载</a></li>
<li>Claude Sonnet 3.7 (可选，如果有api，则无需trae工具)</li>
</ol>
<h2 id="📌-四步高效绘制流程"><a href="#📌-四步高效绘制流程" class="headerlink" title="📌 四步高效绘制流程"></a>📌 四步高效绘制流程</h2><h3 id="步骤-1：环境准备"><a href="#步骤-1：环境准备" class="headerlink" title="步骤 1：环境准备"></a>步骤 1：环境准备</h3><ol>
<li>连接科学上网</li>
<li>访问 trae.ai 下载最新客户端</li>
<li>安装后启动软件 &gt; 点击”检查更新”获取最新版本</li>
</ol>
<h3 id="步骤-2：AI-转换处理"><a href="#步骤-2：AI-转换处理" class="headerlink" title="步骤 2：AI 转换处理"></a>步骤 2：AI 转换处理</h3><ol>
<li>将待转换内容（图片&#x2F;文字）发送至 trae build模式下，模型选择Claude sonnet 3.7</li>
<li>使用固定prompt模板：<br>请用 drawio 的 mxGraph XML 格式清晰地复刻该____流程示意图，生成后缀为drawio文件，确保:  <ul>
<li>层级结构准确</li>
<li>图形元素完整</li>
<li>连线关系明确</li>
</ul>
</li>
<li>等待生成规范的XML代码</li>
</ol>
<h3 id="步骤-3：文件创建规范"><a href="#步骤-3：文件创建规范" class="headerlink" title="步骤 3：文件创建规范"></a>步骤 3：文件创建规范</h3><ol>
<li>新建txt文本文件 &gt; 重命名为”流程图.drawio”</li>
<li>用记事本打开该文件，粘贴生成的XML代码</li>
<li>保存时选择编码格式为 UTF-8</li>
</ol>
<h3 id="步骤-4：可视化编辑"><a href="#步骤-4：可视化编辑" class="headerlink" title="步骤 4：可视化编辑"></a>步骤 4：可视化编辑</h3><ol>
<li>右键文件 &gt; 选择”Open with drawio”</li>
<li>进入图形化编辑界面后：<ul>
<li>按 Ctrl+Shift+F 格式化排版</li>
<li>使用F6快捷键调出样式面板</li>
<li>通过左侧工具栏添加新元素</li>
</ul>
</li>
</ol>
<h2 id="💡-进阶技巧"><a href="#💡-进阶技巧" class="headerlink" title="💡 进阶技巧"></a>💡 进阶技巧</h2><ul>
<li><strong>批量处理</strong>：可同时转换多个流程图组件后合并</li>
<li><strong>版本控制</strong>：建议使用Git管理.drawio文件</li>
<li><strong>云端协同</strong>：导出为XML后可直接导入GitHub&#x2F;GitLab</li>
<li><strong>样式优化</strong>：在Claude prompt中添加特定样式要求<blockquote>
<p>示例：”使用material design风格，配色方案#2E86C1&#x2F;#F4D03F”</p>
</blockquote>
</li>
</ul>
<h2 id="⚠️-常见问题排查"><a href="#⚠️-常见问题排查" class="headerlink" title="⚠️ 常见问题排查"></a>⚠️ 常见问题排查</h2><table>
<thead>
<tr>
<th>问题现象</th>
<th>解决方案</th>
</tr>
</thead>
<tbody><tr>
<td>文件打开乱码</td>
<td>检查编码格式是否为UTF-8</td>
</tr>
<tr>
<td>图形显示异常</td>
<td>验证XML头信息是否完整</td>
</tr>
<tr>
<td>连线错位</td>
<td>添加<code>&lt;mxGeometry as=&quot;geometry&quot;/&gt;</code>节点</td>
</tr>
<tr>
<td>样式丢失</td>
<td>确保<code>&lt;mxStylesheet&gt;</code>标签存在</td>
</tr>
</tbody></table>
<h2 id="🛠️-效率工具链"><a href="#🛠️-效率工具链" class="headerlink" title="🛠️ 效率工具链"></a>🛠️ 效率工具链</h2><ul>
<li><strong>Snipaste</strong>：快速截图转文字</li>
<li><strong>PowerToys</strong>：即时OCR识别</li>
<li><strong>VS Code</strong>：安装DrawIO插件实时预览</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://abelxiaoxing.github.io/2025/02/19/%E5%BA%94%E7%94%A8%E4%BB%A3%E7%90%86%E8%AE%BE%E7%BD%AE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="abelxiaoxing">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="abel的小天地">
      <meta itemprop="description" content="一个个人资料记录的小地方">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | abel的小天地">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/02/19/%E5%BA%94%E7%94%A8%E4%BB%A3%E7%90%86%E8%AE%BE%E7%BD%AE/" class="post-title-link" itemprop="url">应用代理设置</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2025-02-19 11:32:10 / 修改时间：13:24:50" itemprop="dateCreated datePublished" datetime="2025-02-19T11:32:10+08:00">2025-02-19</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>很多linux应用需要开代理才能启动，每一次在终端设置代理环境变量再启动极为繁琐因此直接配置对应的.desktop文件进行启动，本文以discord为例进行配置</p>
<h3 id="1-定位-desktop文件"><a href="#1-定位-desktop文件" class="headerlink" title="1.定位.desktop文件"></a>1.定位.desktop文件</h3><p>找到Discord的桌面启动文件，通常路径为:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/share/applications/discord.desktop</span><br></pre></td></tr></table></figure>
<h3 id="2-修改Exec命令"><a href="#2-修改Exec命令" class="headerlink" title="2.修改Exec命令"></a>2.修改Exec命令</h3><p>用文本编辑器（如sudo nano或vim）打开文件，找到以Exec&#x3D;开头的行，修改为：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Exec=<span class="built_in">env</span> HTTP_PROXY=http://127.0.0.1:7890 HTTPS_PROXY=http://127.0.0.1:7890 /usr/bin/discord</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://abelxiaoxing.github.io/2024/12/26/%E7%B3%BB%E7%BB%9F%E8%BF%81%E7%A7%BB/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="abelxiaoxing">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="abel的小天地">
      <meta itemprop="description" content="一个个人资料记录的小地方">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | abel的小天地">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/12/26/%E7%B3%BB%E7%BB%9F%E8%BF%81%E7%A7%BB/" class="post-title-link" itemprop="url">跨平台系统迁移指南</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-12-26 10:17:21" itemprop="dateCreated datePublished" datetime="2024-12-26T10:17:21+08:00">2024-12-26</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-03-16 13:03:16" itemprop="dateModified" datetime="2025-03-16T13:03:16+08:00">2025-03-16</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="系统迁移操作指南"><a href="#系统迁移操作指南" class="headerlink" title="系统迁移操作指南"></a>系统迁移操作指南</h1><h2 id="Windows-系统迁移"><a href="#Windows-系统迁移" class="headerlink" title="Windows 系统迁移"></a>Windows 系统迁移</h2><h3 id="🛠️-准备工作"><a href="#🛠️-准备工作" class="headerlink" title="🛠️ 准备工作"></a>🛠️ 准备工作</h3><ul>
<li><strong>源系统盘</strong>：需要迁移的旧硬盘</li>
<li><strong>目标磁盘</strong>：新硬盘（容量 ≥ 源盘已用空间）</li>
<li><strong>PE启动U盘</strong>：需集成DiskGenius工具（推荐微PE工具箱）</li>
</ul>
<h3 id="📝-详细操作步骤"><a href="#📝-详细操作步骤" class="headerlink" title="📝 详细操作步骤"></a>📝 详细操作步骤</h3><ol>
<li><p><strong>制作启动盘</strong></p>
<ul>
<li>使用微PE工具箱制作启动U盘（官网：<a target="_blank" rel="noopener" href="https://www.wepe.com.cn/%EF%BC%89">https://www.wepe.com.cn/）</a></li>
</ul>
</li>
<li><p><strong>进入PE环境</strong></p>
<ul>
<li>插入U盘 → 开机时反复按<code>F12/Del/F2</code>（不同主板按键不同）</li>
<li>在BIOS中设置U盘为第一启动项 → 进入PE桌面</li>
</ul>
</li>
<li><p><strong>执行系统迁移</strong></p>
<ul>
<li>打开DiskGenius软件</li>
<li>顶部菜单选择 <strong>工具 → 系统迁移</strong></li>
<li>按向导操作：<ol>
<li>选择<strong>源磁盘</strong>（原系统盘）</li>
<li>选择<strong>目标磁盘</strong>（新硬盘）</li>
<li>调整目标分区大小（默认自动填充）</li>
</ol>
</li>
</ul>
</li>
<li><p><strong>迁移后操作</strong></p>
<ul>
<li>重启进入BIOS → 设置新硬盘为第一启动项</li>
<li>进入系统后运行 <code>chkdsk C: /f</code> 检查磁盘完整性</li>
</ul>
</li>
</ol>
<blockquote>
<p>⚠️ 关键注意事项：</p>
<ol>
<li>目标磁盘必须为<strong>GPT格式</strong>（如原系统为UEFI启动）</li>
<li>迁移前备份重要数据（目标磁盘将被覆盖）</li>
<li>迁移完成后拔出旧硬盘测试启动</li>
</ol>
</blockquote>
<hr>
<h2 id="Linux-系统迁移"><a href="#Linux-系统迁移" class="headerlink" title="Linux 系统迁移"></a>Linux 系统迁移</h2><h3 id="🧰-准备工作"><a href="#🧰-准备工作" class="headerlink" title="🧰 准备工作"></a>🧰 准备工作</h3><ul>
<li>Live USB（推荐和迁移系统相同的系统镜像）</li>
<li>新硬盘（建议容量 ≥ 源盘已用空间）</li>
</ul>
<h3 id="🐧-操作流程"><a href="#🐧-操作流程" class="headerlink" title="🐧 操作流程"></a>🐧 操作流程</h3><h4 id="1-进入Live环境"><a href="#1-进入Live环境" class="headerlink" title="1. 进入Live环境"></a>1. 进入Live环境</h4>   <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lsblk  <span class="comment"># 确认磁盘标识（假设原盘为sdb，新盘为sda）</span></span><br></pre></td></tr></table></figure>

<h4 id="2-分区操作"><a href="#2-分区操作" class="headerlink" title="2. 分区操作"></a>2. 分区操作</h4>   <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cfdisk /dev/sda  <span class="comment"># 创建新分区</span></span><br></pre></td></tr></table></figure>
<ul>
<li>分区方案建议：<table>
<thead>
<tr>
<th>分区</th>
<th>类型</th>
<th>建议大小</th>
</tr>
</thead>
<tbody><tr>
<td>&#x2F;boot</td>
<td>EFI</td>
<td>512M</td>
</tr>
<tr>
<td>&#x2F;</td>
<td>f2fs</td>
<td>剩余空间</td>
</tr>
</tbody></table>
</li>
</ul>
<h4 id="3-格式化分区"><a href="#3-格式化分区" class="headerlink" title="3. 格式化分区"></a>3. 格式化分区</h4>   <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkfs.fat -F32 /dev/sda1  <span class="comment"># 格式化EFI分区</span></span><br><span class="line">mkfs.f2fs -f /dev/sda2   <span class="comment"># f2fs格式化根分区</span></span><br></pre></td></tr></table></figure>

<h4 id="4-挂载文件系统"><a href="#4-挂载文件系统" class="headerlink" title="4. 挂载文件系统"></a>4. 挂载文件系统</h4>   <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 挂载新分区(假设新系统在sda2,新系统的EFI分区在sda1)</span></span><br><span class="line">mount /dev/sda2 /mnt</span><br><span class="line"><span class="built_in">mkdir</span> -p /mnt/boot &amp;&amp; mount /dev/sda1 /mnt/boot</span><br><span class="line"></span><br><span class="line"><span class="comment"># 挂载原分区（假设原系统在sdb2,原系统的根分区在sdb1）</span></span><br><span class="line"><span class="built_in">mkdir</span> /old_root &amp;&amp; mount /dev/sdb2 /old_root</span><br></pre></td></tr></table></figure>

<h4 id="5-数据迁移"><a href="#5-数据迁移" class="headerlink" title="5. 数据迁移"></a>5. 数据迁移</h4>   <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rsync -avhP --exclude=&#123;<span class="string">&quot;/dev/*&quot;</span>,<span class="string">&quot;/proc/*&quot;</span>,<span class="string">&quot;/sys/*&quot;</span>,<span class="string">&quot;/tmp/*&quot;</span>&#125; /old_root/ /mnt/</span><br></pre></td></tr></table></figure>

<h4 id="6-系统配置更新"><a href="#6-系统配置更新" class="headerlink" title="6. 系统配置更新"></a>6. 系统配置更新</h4>   <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 生成新fstab</span></span><br><span class="line">genfstab -U /mnt &gt;&gt; /mnt/etc/fstab</span><br><span class="line"></span><br><span class="line"><span class="comment"># Chroot环境配置</span></span><br><span class="line">arch-chroot /mnt</span><br></pre></td></tr></table></figure>

<h4 id="7-引导修复"><a href="#7-引导修复" class="headerlink" title="7. 引导修复"></a>7. 引导修复</h4>   <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">grub-install --target=x86_64-efi --efi-directory=/boot --bootloader-id=ArchLinux</span><br><span class="line">grub-mkconfig -o /boot/grub/grub.cfg</span><br></pre></td></tr></table></figure>

<h3 id="🔍-验证检查"><a href="#🔍-验证检查" class="headerlink" title="🔍 验证检查"></a>🔍 验证检查</h3><ol>
<li>确认<code>/etc/fstab</code>中UUID与<code>blkid</code>输出一致</li>
<li>检查EFI分区是否包含引导文件</li>
<li>测试从新硬盘启动</li>
</ol>
<hr>
<h2 id="通用注意事项"><a href="#通用注意事项" class="headerlink" title="通用注意事项"></a>通用注意事项</h2><ol>
<li><p><strong>数据备份</strong>：建议使用<code>dd</code>命令创建完整磁盘镜像</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">dd</span> <span class="keyword">if</span>=/dev/sdX of=/path/to/backup.img bs=4M status=progress</span><br></pre></td></tr></table></figure></li>
<li><p><strong>迁移工具替代方案</strong>：</p>
<ul>
<li>Clonezilla（跨平台克隆工具）</li>
<li>Timeshift（Linux系统快照工具）</li>
</ul>
</li>
<li><p><strong>故障排查</strong>：</p>
<ul>
<li>引导失败：尝试<code>boot-repair</code>工具</li>
<li>文件系统错误：使用<code>fsck</code>进行检查修复</li>
</ul>
</li>
</ol>
<hr>
<h2 id="历史数据-Linux-已废弃"><a href="#历史数据-Linux-已废弃" class="headerlink" title="历史数据(Linux,已废弃)"></a>历史数据(Linux,已废弃)</h2><ol>
<li>准备工作：<ul>
<li>原系统硬盘</li>
<li>新系统硬盘</li>
<li>带有Live USB的Un盘</li>
</ul>
</li>
<li>bios设置启动U盘,进入U盘Live USB的linux系统</li>
<li>输入<code>lsblk</code>命令查看磁盘信息,找到原系统的磁盘和新系统的磁盘,例如&#x2F;dev&#x2F;sdb1和&#x2F;dev&#x2F;sdb2分别为原系统的EFI分区和根分区,&#x2F;dev&#x2F;sda为新系统磁盘(此处为举例,具体根据<code>lsblk</code>命令输出进行修改)</li>
<li>输入<code>cfdisk</code>命令,对新磁盘进行分区,创建efi分区和根分区,efi设置分区类型为fat32,根分区类型须和原来系统一致,例如原系统为ext4,则新系统根分区也为ext4<br> 格式化EFI分区<br> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">    mkfs.fat -F32 /dev/sda1</span><br><span class="line">    ```  </span><br><span class="line">格式化根分区  </span><br><span class="line">    ```bash</span><br><span class="line">    mkfs.ext4 /dev/sda2</span><br></pre></td></tr></table></figure></li>
<li>挂载分区<ul>
<li>挂载旧磁盘  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> /sdb1</span><br><span class="line">mount /dev/sdb1 /sdb1</span><br><span class="line"><span class="built_in">mkdir</span> /sdb2</span><br><span class="line">mount /dev/sdb2 /sdb2</span><br></pre></td></tr></table></figure></li>
<li>挂载新磁盘  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mount /dev/sda2 /mnt</span><br><span class="line"><span class="built_in">mkdir</span> /mnt/boot</span><br><span class="line">mount /dev/sda1 /mnt/boot</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li>复制原系统文件到新系统<ul>
<li>复制根分区数据  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rsync -aHAXxSP --exclude=/boot /sdb2/ /mnt/</span><br></pre></td></tr></table></figure></li>
<li>复制EFI分区数据  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rsync -aHAXxSP /sdb2/ /mnt/boot/</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li>更新fstab<ul>
<li>生成新的UUID  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">blkid</span><br></pre></td></tr></table></figure></li>
<li>修改&#x2F;etc&#x2F;fstab文件,将原系统的UUID和新系统的UUID进行替换</li>
</ul>
</li>
<li>配置启动加载器 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mount --<span class="built_in">bind</span> /dev /mnt/dev</span><br><span class="line">mount --<span class="built_in">bind</span> /proc /mnt/proc</span><br><span class="line">mount --<span class="built_in">bind</span> /sys /mnt/sys</span><br><span class="line"><span class="built_in">cp</span> /etc/resolv.conf /mnt/etc/resolv.conf</span><br></pre></td></tr></table></figure></li>
<li>切换到新根目录   <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">arch-chroot /mnt</span><br></pre></td></tr></table></figure></li>
<li>安装配置grub  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pacman -S grub efibootmgr</span><br><span class="line">grub-install --target=x86_64-efi --efi-directory=/boot --bootloader-id=ArchLinux</span><br><span class="line">grub-mkconfig -o /boot/grub/grub.cfg</span><br></pre></td></tr></table></figure></li>
<li>重启系统,bios设置从新硬盘启动,进入新系统</li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://abelxiaoxing.github.io/2024/12/03/firefox%E5%9E%82%E7%9B%B4%E6%A0%8F%E9%85%8D%E7%BD%AE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="abelxiaoxing">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="abel的小天地">
      <meta itemprop="description" content="一个个人资料记录的小地方">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | abel的小天地">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/12/03/firefox%E5%9E%82%E7%9B%B4%E6%A0%8F%E9%85%8D%E7%BD%AE/" class="post-title-link" itemprop="url">firefox垂直栏配置</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-12-03 16:07:12" itemprop="dateCreated datePublished" datetime="2024-12-03T16:07:12+08:00">2024-12-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-01-09 15:38:54" itemprop="dateModified" datetime="2025-01-09T15:38:54+08:00">2025-01-09</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>Firefox浏览器的侧边栏默认是水平的,但是edge的垂直侧边栏很受欢迎,所以我想尝试一下在Firefox浏览器中实现垂直侧边栏。</p>
<h2 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h2><ol>
<li>打开火狐浏览器，访问<a target="_blank" rel="noopener" href="https://addons.mozilla.org/zh-CN/firefox/addon/sidebery">sidebery插件</a> 下载该插件。</li>
<li>打开about:config，搜索并启用以下选项：  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">toolkit.legacyUserProfileCustomizations.stylesheets</span><br></pre></td></tr></table></figure></li>
<li>修改userChrome.css,打开设置-&gt;浏览器帮助-&gt;更多排障信息-&gt;配置文件夹-&gt;打开目录,创建chrome文件夹，并在chrome文件夹下创建userChrome.css文件，将以下代码复制进去：<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br></pre></td><td class="code"><pre><span class="line">/* #tabbrowser-tabs[orient=&quot;horizontal&quot;] &#123;</span><br><span class="line">    visibility: collapse !important;</span><br><span class="line">&#125; */</span><br><span class="line"></span><br><span class="line">:root &#123;</span><br><span class="line">    /* Delay before expanding tabs */</span><br><span class="line">    --delay: 0s;</span><br><span class="line">    /* Time it takes for sidebar to expand. */</span><br><span class="line">    --transition-time: 0.2s;</span><br><span class="line">    /* Width of expanded sidebar */</span><br><span class="line">    --expanded-width: 250px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#TabsToolbar:not([customizing=&quot;true&quot;]) &#123;</span><br><span class="line">    visibility: collapse !important;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@media (-moz-platform: macos) &#123;</span><br><span class="line">    :root:not([customizing=&quot;true&quot;]) #nav-bar:not([inFullscreen]) &#123;</span><br><span class="line">        padding-left: 80px !important;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    :root:not([customizing=&quot;true&quot;]) #TabsToolbar .titlebar-buttonbox-container &#123;</span><br><span class="line">        visibility: visible !important;</span><br><span class="line">        position: absolute;</span><br><span class="line">        top: 12px;</span><br><span class="line">        left: 0px;</span><br><span class="line">        display: block;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/* Linux/GTK specific styles */</span><br><span class="line">@media (-moz-gtk-csd-available),</span><br><span class="line">(-moz-platform: linux) &#123;</span><br><span class="line">    .browser-toolbar:not(.titlebar-color) &#123;</span><br><span class="line">        /* Fixes wrong coloring applied with --toolbar-bgcolor by Firefox (#101) */</span><br><span class="line">        background-color: transparent !important;</span><br><span class="line">        box-shadow: none !important;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    #TabsToolbar:not([customizing=&quot;true&quot;]) &#123;</span><br><span class="line">        visibility: collapse !important;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    #toolbar-menubar &#123;</span><br><span class="line">        padding-top: 0px !important;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /* Fixes issue in FF 123 where minimize, close, and maximize buttons no longer work. */</span><br><span class="line">    :root[tabsintitlebar] #titlebar &#123;</span><br><span class="line">        will-change: auto !important;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    :root:not([customizing=&quot;true&quot;]) #toolbar-menubar[inactive]+#TabsToolbar .titlebar-buttonbox-container &#123;</span><br><span class="line">        visibility: visible !important;</span><br><span class="line">        position: absolute;</span><br><span class="line">        top: var(--uc-win-ctrl-vertical-offset);</span><br><span class="line">        display: block;</span><br><span class="line">        z-index: 101;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /* enable rounded top corners */</span><br><span class="line">    :root[tabsintitlebar][sizemode=&quot;normal&quot;]:not([gtktiledwindow=&quot;true&quot;]):not([customizing=&quot;true&quot;]) #nav-bar &#123;</span><br><span class="line">        border-top-left-radius: env(-moz-gtk-csd-titlebar-radius);</span><br><span class="line">        border-top-right-radius: env(-moz-gtk-csd-titlebar-radius);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /* window control padding values (these don&#x27;t change the size of the actual buttons, only the padding for the navbar) */</span><br><span class="line">    :root[tabsintitlebar]:not([customizing=&quot;true&quot;]) &#123;</span><br><span class="line">        /* default button/padding size based on adw-gtk3 theme */</span><br><span class="line">        --uc-win-ctrl-btn-width: 38px;</span><br><span class="line">        --uc-win-ctrl-padding: 12px;</span><br><span class="line">        /* vertical offset from the top of the window, calculation: (1/2 * (NAVBAR_HEIGHT - BUTTON_HEIGHT)) */</span><br><span class="line">        --uc-win-ctrl-vertical-offset: 8px;</span><br><span class="line">        /* extra window drag space */</span><br><span class="line">        --uc-win-ctrl-drag-space: 20px;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    :root[tabsintitlebar][lwtheme]:not([customizing=&quot;true&quot;]) &#123;</span><br><span class="line">        /* seperate values for when using a theme, based on the Firefox defaults */</span><br><span class="line">        --uc-win-ctrl-btn-width: 30px;</span><br><span class="line">        --uc-win-ctrl-padding: 12px;</span><br><span class="line">        /* vertical offset from the top of the window, calculation: (1/2 * (NAVBAR_HEIGHT - BUTTON_HEIGHT)) */</span><br><span class="line">        --uc-win-ctrl-vertical-offset: 5px;</span><br><span class="line">        /* extra window drag space */</span><br><span class="line">        --uc-win-ctrl-drag-space: 20px;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /* setting the padding value for all button combinations */</span><br><span class="line">    @media (-moz-gtk-csd-minimize-button),</span><br><span class="line">    (-moz-gtk-csd-maximize-button),</span><br><span class="line">    (-moz-gtk-csd-close-button) &#123;</span><br><span class="line">        #nav-bar &#123;</span><br><span class="line">            --uc-navbar-padding: calc(var(--uc-win-ctrl-btn-width) * 1);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @media (-moz-gtk-csd-minimize-button) and (-moz-gtk-csd-maximize-button),</span><br><span class="line">    (-moz-gtk-csd-minimize-button) and (-moz-gtk-csd-close-button),</span><br><span class="line">    (-moz-gtk-csd-maximize-button) and (-moz-gtk-csd-close-button) &#123;</span><br><span class="line">        #nav-bar &#123;</span><br><span class="line">            --uc-navbar-padding: calc(var(--uc-win-ctrl-btn-width) * 2);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @media (-moz-gtk-csd-minimize-button) and (-moz-gtk-csd-maximize-button) and (-moz-gtk-csd-close-button) &#123;</span><br><span class="line">        #nav-bar &#123;</span><br><span class="line">            --uc-navbar-padding: calc(var(--uc-win-ctrl-btn-width) * 3);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /* only applies padding/positioning if there is 1 or more buttons */</span><br><span class="line">    @media (-moz-gtk-csd-minimize-button),</span><br><span class="line">    (-moz-gtk-csd-maximize-button),</span><br><span class="line">    (-moz-gtk-csd-close-button) &#123;</span><br><span class="line"></span><br><span class="line">        /* window controls on the right */</span><br><span class="line">        @media not (-moz-gtk-csd-reversed-placement) &#123;</span><br><span class="line">            #nav-bar &#123;</span><br><span class="line">                padding-inline: 0 calc(var(--uc-navbar-padding, 0) + var(--uc-win-ctrl-padding) + var(--uc-win-ctrl-drag-space)) !important;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            .titlebar-buttonbox-container &#123;</span><br><span class="line">                right: 0;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        /* window controls on the left */</span><br><span class="line">        @media (-moz-gtk-csd-reversed-placement) &#123;</span><br><span class="line">            #nav-bar &#123;</span><br><span class="line">                padding-inline: calc(var(--uc-navbar-padding, 0) + var(--uc-win-ctrl-padding) + var(--uc-win-ctrl-drag-space)) 0 !important;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            .titlebar-buttonbox-container &#123;</span><br><span class="line">                left: 0;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /* Hide window buttons in fullscreen */</span><br><span class="line">    #navigator-toolbox[style*=&quot;margin-top: -&quot;] .titlebar-buttonbox-container,</span><br><span class="line">    [inDOMFullscreen=&quot;true&quot;] .titlebar-buttonbox-container &#123;</span><br><span class="line">        transform: translateY(-100px)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/* Windows specific styles */</span><br><span class="line">@media (-moz-platform: windows),</span><br><span class="line">(-moz-platform: windows-win10) &#123;</span><br><span class="line"></span><br><span class="line">    /* Hide main tabs toolbar */</span><br><span class="line">    :root[tabsintitlebar] &#123;</span><br><span class="line">        --uc-window-control-width: 137px;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    #nav-bar &#123;</span><br><span class="line">        border-inline: var(--uc-window-drag-space-width, 80px) solid var(--toolbar-bgcolor);</span><br><span class="line">        border-inline-style: solid !important;</span><br><span class="line">        border-right-width: calc(var(--uc-window-control-width, 0px) + var(--uc-window-drag-space-width, 0px));</span><br><span class="line">        /* This makes it possible to drag the maximized window. */</span><br><span class="line">        padding-top: .5px !important;</span><br><span class="line">        /* Removes the space left when hiding .titlebar-buttonbox-container */</span><br><span class="line">        margin-left: -80px;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    #back-button &#123;</span><br><span class="line">        margin-top: -.5px !important;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    #forward-button &#123;</span><br><span class="line">        margin-top: -.5px !important;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    #reload-button &#123;</span><br><span class="line">        margin-top: -.5px !important;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    #PanelUI-button &#123;</span><br><span class="line">        margin-top: -.5px !important;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    #nav-bar-overflow-button &#123;</span><br><span class="line">        margin-top: -.5px !important;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    :root &#123;</span><br><span class="line">        --uc-toolbar-height: 32px;</span><br><span class="line">        --chrome-content-separator-color: none !important;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    :root:not([uidensity=&quot;compact&quot;]) &#123;</span><br><span class="line">        --uc-toolbar-height: 38px;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    #TabsToolbar &#123;</span><br><span class="line">        visibility: collapse !important;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /* Hide the Windows controls on the left side. */</span><br><span class="line">    #TabsToolbar .titlebar-buttonbox-container &#123;</span><br><span class="line">        visibility: hidden !important;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /* Line up the Windows controls with the rest of the icons in the toolbar. */</span><br><span class="line">    :root:not([sizemode=&quot;maximized&quot;]) .titlebar-buttonbox-container &#123;</span><br><span class="line">        margin-top: 3px;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    :root:not([inFullscreen]) #nav-bar &#123;</span><br><span class="line">        margin-top: calc(0px - var(--uc-toolbar-height));</span><br><span class="line">        z-index: 2;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    #toolbar-menubar &#123;</span><br><span class="line">        min-height: unset !important;</span><br><span class="line">        height: var(--uc-toolbar-height) !important;</span><br><span class="line">        position: relative;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    .titlebar-buttonbox &#123;</span><br><span class="line">        z-index: 3 !important;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    .titlebar-buttonbox * &#123;</span><br><span class="line">        width: 35px;</span><br><span class="line">        height: 38px;</span><br><span class="line">        pointer-events: auto;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    #titlebar &#123;</span><br><span class="line">        z-index: 3;</span><br><span class="line">        pointer-events: none;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    #main-menubar &#123;</span><br><span class="line">        -moz-box-flex: 1;</span><br><span class="line">        background-color: var(--toolbar-bgcolor, --toolbar-non-lwt-bgcolor);</span><br><span class="line">        background-clip: padding-box;</span><br><span class="line">        border-right: 30px solid transparent;</span><br><span class="line">        border-image: linear-gradient(to left, transparent, var(--toolbar-bgcolor, --toolbar-non-lwt-bgcolor) 30px) 20 / 30px;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    #toolbar-menubar:not([inactive]) &#123;</span><br><span class="line">        z-index: 2;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    #toolbar-menubar[inactive]&gt;#menubar-items &#123;</span><br><span class="line">        opacity: 0;</span><br><span class="line">        pointer-events: none;</span><br><span class="line">        margin-left: var(--uc-window-drag-space-width, 0px);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    :root[inFullscreen] #nav-bar &#123;</span><br><span class="line">        border-right: none !important;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#sidebar-box[sidebarcommand=&quot;_3c078156-979c-498b-8990-85f7987dd929_-sidebar-action&quot;] #sidebar-header &#123;</span><br><span class="line">    visibility: collapse;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#sidebar-box[sidebarcommand=&quot;_3c078156-979c-498b-8990-85f7987dd929_-sidebar-action&quot;] &#123;</span><br><span class="line">    position: relative;</span><br><span class="line">    min-width: 48px !important;</span><br><span class="line">    width: 48px !important;</span><br><span class="line">    max-width: 48px !important;</span><br><span class="line">    z-index: 1;</span><br><span class="line">    margin-top: -1px;</span><br><span class="line">    transition: min-width var(--transition-time) linear !important;</span><br><span class="line">    will-change: min-width;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/* positioned=true means sidebar docked to the right */</span><br><span class="line">#sidebar-box[sidebarcommand=&quot;_3c078156-979c-498b-8990-85f7987dd929_-sidebar-action&quot;][positionend=&quot;true&quot;] &#123;</span><br><span class="line">    position: absolute;</span><br><span class="line">    top: 0;</span><br><span class="line">    bottom: 0;</span><br><span class="line">    right: 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#browser:has(#sidebar-box[sidebarcommand=&quot;_3c078156-979c-498b-8990-85f7987dd929_-sidebar-action&quot;][positionend=&quot;true&quot;])&gt;#appcontent &#123;</span><br><span class="line">    margin-right: 50px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#sidebar-box[sidebarcommand=&quot;_3c078156-979c-498b-8990-85f7987dd929_-sidebar-action&quot;]:hover &#123;</span><br><span class="line">    min-width: var(--expanded-width) !important;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#sidebar-box[sidebarcommand=&quot;_3c078156-979c-498b-8990-85f7987dd929_-sidebar-action&quot;]&gt;#sidebar &#123;</span><br><span class="line">    transition: min-width var(--transition-time) linear var(--delay) !important;</span><br><span class="line">    will-change: min-width;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#sidebar-box[sidebarcommand=&quot;_3c078156-979c-498b-8990-85f7987dd929_-sidebar-action&quot;]:hover&gt;#sidebar &#123;</span><br><span class="line">    min-width: var(--expanded-width) !important;</span><br><span class="line">    transition: min-width var(--transition-time) linear var(--delay);</span><br><span class="line">    clip-path: inset(0px -15px 0px -15px);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#sidebar,</span><br><span class="line">#sidebar-header &#123;</span><br><span class="line">    background-color: var(--toolbar-bgcolor) !important;</span><br><span class="line">    border-inline: 1px solid var(--chrome-content-separator-color) !important;</span><br><span class="line">    border-inline-width: 0px 1px !important;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#sidebar-box[sidebarcommand=&quot;_3c078156-979c-498b-8990-85f7987dd929_-sidebar-action&quot;]:not([positionend]):hover~#appcontent #statuspanel &#123;</span><br><span class="line">    inset-inline: auto 0px !important;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#sidebar-box[sidebarcommand=&quot;_3c078156-979c-498b-8990-85f7987dd929_-sidebar-action&quot;]:not([positionend]):hover~#appcontent #statuspanel-label &#123;</span><br><span class="line">    margin-inline: 0px !important;</span><br><span class="line">    border-left-style: solid !important;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>修改sidebery拓展配置,打开sidebery的设置页面,点击样式编辑器,在右侧复制以下代码：<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line"> #root.root &#123;</span><br><span class="line">    --tabs-font: 10pt sans-serif;</span><br><span class="line">    --tabs-count-font: .625rem Segoe UI;</span><br><span class="line">    --bookmarks-bookmark-font: .875rem Segoe UI;</span><br><span class="line">    --bookmarks-folder-font: 9pt Segoe UI;</span><br><span class="line">    --nav-btn-width: 42px;</span><br><span class="line">    --nav-btn-height: 42px;</span><br><span class="line">    --tabs-height: 40px;</span><br><span class="line">    --tabs-inner-gap: 11px;</span><br><span class="line">    --tabs-pinned-width: 42px;</span><br><span class="line">    --tabs-pinned-height: 42px;</span><br><span class="line">    --search-height: 36px;</span><br><span class="line">    --search-icon-width: 42px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@media (prefers-color-scheme:light) &#123;</span><br><span class="line">    #root &#123;</span><br><span class="line">        --tabs-activated-bg: white !important;</span><br><span class="line">        --tabs-bg-active: var(--tabs-activated-bg) !important;</span><br><span class="line">        --tabs-selected-fg: var(--tabs-activated-fg) !important;</span><br><span class="line">        --tabs-selected-bg: var(--tabs-activated-bg) !important;</span><br><span class="line">        --bg: #f9f9fb !important;</span><br><span class="line">        --badge-bg: rgb(255 255 255 / 0.85);</span><br><span class="line">        --border: #606060 !important;</span><br><span class="line">        --ctx-menu-separator: rgb(204 204 204);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@media (prefers-color-scheme:dark) &#123;</span><br><span class="line">    #root &#123;</span><br><span class="line">        --tabs-activated-bg: #42414d !important;</span><br><span class="line">        --tabs-bg-active: var(--tabs-activated-bg) !important;</span><br><span class="line">        --tabs-selected-fg: var(--tabs-activated-fg) !important;</span><br><span class="line">        --tabs-selected-bg: var(--tabs-activated-bg) !important;</span><br><span class="line">        --bg: #2b2a33 !important;</span><br><span class="line">        --badge-bg: rgb(30 30 30 / 0.85);</span><br><span class="line">        --border: #c0c0c0 !important;</span><br><span class="line">        --ctx-menu-separator: rgb(51 51 62);</span><br><span class="line">        --tabs-bg-hover: rgb(51 51 62) !important;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.NavigationBar &#123;</span><br><span class="line">    background: transparent;</span><br><span class="line">    border-bottom: 1px solid var(--ctx-menu-separator);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.NavigationBar[data-layout=&quot;wrap&quot;] .main-items &#123;</span><br><span class="line">    display: flex;</span><br><span class="line">    justify-content: center;</span><br><span class="line">    border: 1px solid red;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.NavigationBar[data-layout=&quot;inline&quot;] .main-items .nav-item[data-index=&quot;-1&quot;][data-active=&quot;true&quot;] &#123;</span><br><span class="line">    opacity: 1;</span><br><span class="line">    z-index: 100;</span><br><span class="line">    transform: scale(1, 1);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.NavigationBar .static-btns &#123;</span><br><span class="line">    transition: opacity 0.5s linear;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#root:not(:hover) .NavigationBar[data-layout=&quot;inline&quot;] .static-btns &#123;</span><br><span class="line">    opacity: 0;</span><br><span class="line">    z-index: -1;</span><br><span class="line">    transform: scale(0, 0);;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#root:not(:hover) .TabsPanel &#123;</span><br><span class="line">    --tabs-indent: 0px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#root:not(:hover)[data-tabs-tree-lvl-marks=&quot;true&quot;] .Tab[data-pin=&quot;false&quot;]:not([data-lvl=&quot;0&quot;]) .body:after &#123;</span><br><span class="line">    display: none;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.Tab .close &#123;</span><br><span class="line">    margin: 0 5px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.Tab .audio &#123;</span><br><span class="line">    position: absolute;</span><br><span class="line">    top: unset !important;</span><br><span class="line">    bottom: -2px;</span><br><span class="line">    right: -2px;</span><br><span class="line">    height: 16px !important;</span><br><span class="line">    width: 16px !important;</span><br><span class="line">    background: var(--badge-bg);</span><br><span class="line">    border-radius: 3px;</span><br><span class="line">    box-shadow: var(--nav-btn-active-shadow);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.Tab .t-box &#123;</span><br><span class="line">    --audio-btn-offset: 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#root:not(:hover) .SearchBar::before &#123;</span><br><span class="line">    background: transparent;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#root:not(:hover) .SearchBar .placeholder,</span><br><span class="line">#root:not(:hover) .SearchBar .input &#123;</span><br><span class="line">    opacity: 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#root:not(:hover) .SearchBar .clear-btn &#123;</span><br><span class="line">    display: none;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#root:not(:hover) .PanelPlaceholder &#123;</span><br><span class="line">    writing-mode: vertical-rl;</span><br><span class="line">    text-orientation: mixed;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.BottomBar .tool-btn &#123;</span><br><span class="line">    min-width: var(--tabs-pinned-width);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>重启浏览器，完成配置。</li>
</ol>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ol>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_55349490/article/details/140774366">火狐浏览器firefox垂直标签页</a></li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://abelxiaoxing.github.io/2024/11/15/kvm%E5%A4%9A%E6%98%BE%E5%8D%A1%E7%9B%B4%E9%80%9A/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="abelxiaoxing">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="abel的小天地">
      <meta itemprop="description" content="一个个人资料记录的小地方">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | abel的小天地">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/11/15/kvm%E5%A4%9A%E6%98%BE%E5%8D%A1%E7%9B%B4%E9%80%9A/" class="post-title-link" itemprop="url">kvm多显卡直通</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-11-15 21:31:22" itemprop="dateCreated datePublished" datetime="2024-11-15T21:31:22+08:00">2024-11-15</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-01-09 15:38:54" itemprop="dateModified" datetime="2025-01-09T15:38:54+08:00">2025-01-09</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <ol>
<li>主板bios打开虚拟化（有的老旧cpu不支持）  </li>
<li>宿主机系统中启用iommu组<br>打开&#x2F;etc&#x2F;default&#x2F;grub，找到GRUB_CMDLINE_LINUX_DE FAULT，修改为下面内容  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GRUB_CMDLINE_LINUX_DEFAULT=&quot;quiet splash intel_iommu=on&quot;</span><br></pre></td></tr></table></figure>
更新grub  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo grub-mkconfig -o /boot/grub/grub.cfg # Arch Linux</span><br><span class="line">sudo update-grub -u # Ubuntu</span><br></pre></td></tr></table></figure>
重启电脑，检查iommu是否正确启用  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dmesg | grep -i iommu</span><br></pre></td></tr></table></figure>
如果你在输出中看到很多pci xxxx:xx:xx.x: Adding to iommu group xx，那么恭喜你，第一步完成了。<br>系统中的所有设备只能按照iommu group为单位分配给宿主机或者虚拟机。因此如果你看到两个不相关的设备在一个group里，那也没招，你只能给这俩设备一起丢虚拟机里去。<br>很可惜的是，Linux系统并不支持预留iommu group。<br>iommu group是硬件实现上的分组。在Linux的实现中，只认得各个在总线上的硬件，并挨个挨个的启动起来。<br>我们要做的就是阻止Linux内核在启动时初始化某些组里的硬件。   </li>
<li>寻找需要预留的iommu组<br>首先确认我们显卡所在的PCIE总线和产品型号：  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lspci -nnv | grep -i nvidia</span><br></pre></td></tr></table></figure>
我的电脑上输出如下：  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">01:00.0 VGA compatible controller [0300]: NVIDIA Corporation Device [10de:2203] (rev a1) (prog-if 00 [VGA controller])</span><br><span class="line">        Kernel driver in use: nvidia</span><br><span class="line">        Kernel modules: nvidiafb, nouveau, nvidia_drm, nvidia</span><br><span class="line">01:00.1 Audio device [0403]: NVIDIA Corporation GA102 High Definition Audio Controller [10de:1aef] (rev a1)</span><br><span class="line">05:00.0 VGA compatible controller [0300]: NVIDIA Corporation Device [10de:2203] (rev a1) (prog-if 00 [VGA controller])</span><br><span class="line">        Kernel modules: nvidiafb, nouveau, nvidia_drm, nvidia</span><br><span class="line">05:00.1 Audio device [0403]: NVIDIA Corporation GA102 High Definition Audio Controller [10de:1aef] (rev a1)</span><br></pre></td></tr></table></figure>
可以看到输出分成两部分，编号加设备描述。01:00.0和01:00.1是编号通过冒号 “:” 又分成了三部分，第一个部分是PCIe的 domain ID，第二个部分是 bus ID，第三个部分是 device id.function id。PCI设备的组织形式是一个树形，这表示一个domain可以包含多个bus，一个bus又包含了多个device，一个device又包含多个function。<br>0300 是一个用来区分不同设备的编号，网络设备、存储设备、多媒体设备、显卡都有自己的编号。<br>10de:2203 这是一个厂商特有的编号，10de是 Nvidia的编号（Vendor ID），Nvidia所有的设备都是使用这一编号，2203 表示这是一个3090Ti显卡。<br>接下来我们需要找出我们的设备所在的iommu group：  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo dmesg | grep iommu | grep 01:00.0</span><br></pre></td></tr></table></figure>
输出如下：  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[    0.536462] pci 0000:01:00.0: Adding to iommu group 17</span><br><span class="line">$ sudo dmesg | grep iommu | grep 05:00.0</span><br><span class="line">[    0.536491] pci 0000:05:00.0: Adding to iommu group 20</span><br></pre></td></tr></table></figure>
确认iommu group中的所有设备：  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo dmesg | grep &quot;iommu group 17&quot;</span><br></pre></td></tr></table></figure>
输出如下：  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[    0.536462] pci 0000:01:00.0: Adding to iommu group 17</span><br><span class="line">[    0.536467] pci 0000:01:00.1: Adding to iommu group 17</span><br></pre></td></tr></table></figure></li>
<li>屏蔽显卡</li>
</ol>
<ul>
<li>型号屏蔽法：<br>如果只有一张显卡，或者两张显卡的ID不同，可以直接用pci-stub或者vfio-pci的方法来屏蔽即可，修改&#x2F;etc&#x2F;default&#x2F;grub：  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">GRUB_CMDLINE_LINUX_DEFAULT=&quot;quiet splash intel_iommu=on pci-stub.ids=10de:2203,10de:1aef&quot;</span><br><span class="line">或者</span><br><span class="line">GRUB_CMDLINE_LINUX_DEFAULT=&quot;quiet splash intel_iommu=on vfio-pci.ids=10de:2203,10de:1aef&quot;</span><br></pre></td></tr></table></figure>
更新内核，并重启：  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo grub-mkconfig -o /boot/grub/grub.cfg # Arch Linux</span><br><span class="line">sudo update-grub -u # Ubuntu</span><br></pre></td></tr></table></figure>
如果屏蔽成功，内核驱动就会显示如下：  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lspci -nnv | grep -E &quot;(^\S|Kernel driver in use)&quot; | grep 01:00 -A 1</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">01:00.0 VGA compatible controller [0300]: NVIDIA Corporation Device [10de:2203] (rev a1) (prog-if 00 [VGA controller])</span><br><span class="line">        Kernel driver in use: vfio-pci</span><br><span class="line">01:00.1 Audio device [0403]: NVIDIA Corporation GA102 High Definition Audio Controller [10de:1aef] (rev a1)</span><br><span class="line">        Kernel driver in use: vfio-pci</span><br></pre></td></tr></table></figure>
否则下面还是驱动被nvidia接管的状态（其实nvidia-smi就能看了）：  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lspci -nnv | grep -E &quot;(^\S|Kernel driver in use)&quot; | grep 01:00 -A 1</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">01:00.0 VGA compatible controller [0300]: NVIDIA Corporation Device [10de:2203] (rev a1) (prog-if 00 [VGA controller])</span><br><span class="line">        Kernel driver in use: nvidia</span><br><span class="line">01:00.1 Audio device [0403]: NVIDIA Corporation GA102 High Definition Audio Controller [10de:1aef] (rev a1)</span><br><span class="line">        Kernel driver in use: snd_hda_intel</span><br></pre></td></tr></table></figure></li>
<li>脚本屏蔽法<br>当然如果两张显卡都是同一个型号，是不能用上面的方法屏蔽的。这个时候我们要为显卡指定驱动：  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/initramfs-tools/scripts/init-top/vfio.sh</span><br></pre></td></tr></table></figure>
脚本内容为：  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/sh</span><br><span class="line">echo &quot;vfio-pci&quot; &gt; /sys/bus/pci/devices/0000:01:00.0/driver_override</span><br><span class="line">echo &quot;vfio-pci&quot; &gt; /sys/bus/pci/devices/0000:01:00.1/driver_override</span><br><span class="line">#echo &quot;0000:01:00.0&quot; &gt; /sys/bus/pci/drivers/vfio-pci/bind # 这里我没有加这个绑定，有人加了这两句，但我注释了，因为本地找不到这个文件夹</span><br><span class="line">#echo &quot;0000:01:00.1&quot; &gt; /sys/bus/pci/drivers/vfio-pci/bind # 需要modprobe -i vfio-pci之后才有这个文件夹，但不加仍然可用</span><br><span class="line">exit 0</span><br></pre></td></tr></table></figure>
给脚本增加权限，否则无法执行：  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo chmod 744 /etc/initramfs-tools/scripts/init-top/vfio.sh</span><br></pre></td></tr></table></figure>
完成后刷新initramfs，这个命令会执行上面的脚本：  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo update-initramfs -u -k all</span><br></pre></td></tr></table></figure>
输出下面的结果，重启就可以正常屏蔽了。  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">update-initramfs: Generating /boot/initrd.img-6.2.0-31-generic</span><br><span class="line">update-initramfs: Generating /boot/initrd.img-6.2.0-26-generic</span><br></pre></td></tr></table></figure>
重启配置成功后按照上一节的命令就能看到显卡的驱动被vfio-pci接管了，nvidia-smi也能发现显卡已经无法识别了。<br>如果想恢复显卡的挂载，就把脚本中的两行echo…注释掉，并刷新initramfs，重启机器即可。</li>
</ul>
<ol start="5">
<li>打开kvm，加入该显卡即可</li>
</ol>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/ahmclishihao/article/details/132679686">https://blog.csdn.net/ahmclishihao/article/details/132679686</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://abelxiaoxing.github.io/2024/10/24/rdp%E8%BF%9C%E7%A8%8B%E6%A1%8C%E9%9D%A2samba%E6%96%87%E4%BB%B6%E4%BC%A0%E8%BE%93%E9%85%8D%E7%BD%AE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="abelxiaoxing">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="abel的小天地">
      <meta itemprop="description" content="一个个人资料记录的小地方">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | abel的小天地">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/10/24/rdp%E8%BF%9C%E7%A8%8B%E6%A1%8C%E9%9D%A2samba%E6%96%87%E4%BB%B6%E4%BC%A0%E8%BE%93%E9%85%8D%E7%BD%AE/" class="post-title-link" itemprop="url">rdp远程桌面samba文件传输配置</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-10-24 14:19:42" itemprop="dateCreated datePublished" datetime="2024-10-24T14:19:42+08:00">2024-10-24</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-01-09 15:38:54" itemprop="dateModified" datetime="2025-01-09T15:38:54+08:00">2025-01-09</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>向日葵需要通过登陆才能使用，且免费用户操作卡顿延迟较高，因此采用云服务器通过frp映射到公网IP</p>
<h2 id="rdp远程桌面配置"><a href="#rdp远程桌面配置" class="headerlink" title="rdp远程桌面配置"></a>rdp远程桌面配置</h2><ol>
<li>需要远程的服务器端上配置frp服务（略）</li>
<li>点击系统属性-远程，在该界面点击允许远程连接到此计算机。此时windows的rdp服务已开启，端口号为3389</li>
<li>将本地3389映射到公网ip上，在frpc.ini新增以下内容<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[win_rdp]</span><br><span class="line">type = tcp</span><br><span class="line">local_ip = 127.0.0.1</span><br><span class="line">local_port = 3389</span><br><span class="line">remote_port = 13389(可以为任意数，自行定义)</span><br></pre></td></tr></table></figure></li>
<li>远程连接<ul>
<li>linux：使用krdc，勾选rdp协议，通过xxx.xxx.xxx.xxx:13389进行远程访问</li>
<li>windows：打开远程桌面，通过xxx.xxx.xxx.xxx:13389进行远程访问</li>
</ul>
</li>
</ol>
<h2 id="samba公网文件传输配置"><a href="#samba公网文件传输配置" class="headerlink" title="samba公网文件传输配置"></a>samba公网文件传输配置</h2><ol>
<li>服务端和客户端都需开启samba服务，并完成服务器端samba服务配置（略，linux见我博客，win创建共享文件夹并设置权限即可）</li>
<li>将samba服务的默认端口445映射到公网ip上，在frpc.ini新增以下内容<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[win_samba]</span><br><span class="line">type = tcp</span><br><span class="line">local_ip = 127.0.0.1</span><br><span class="line">local_port = 3389</span><br><span class="line">remote_port = 10445(可以为任意数，自行定义)</span><br></pre></td></tr></table></figure>
服务端配置完毕</li>
</ol>
<h3 id="linux客户端"><a href="#linux客户端" class="headerlink" title="linux客户端"></a>linux客户端</h3><p>使用dolphin文件管理器，输入以下内容（xxx.xxx.xxx.xxx为的公网ip）：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">smb://用户名@xxx.xxx.xxx.xxx:10445/</span><br></pre></td></tr></table></figure>
<h3 id="windows客户端"><a href="#windows客户端" class="headerlink" title="windows客户端"></a>windows客户端</h3><p>cmd用管理员模式打开输入以下内容（xxx.xxx.xxx.xxx为的公网ip）：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netsh interface portproxy add v4tov4 listenport=445 listenaddress=127.0.0.1 connectport=10455 connectaddress= xxx.xxx.xxx.xxx</span><br></pre></td></tr></table></figure>
<p>效果就是本机访问127.0.0.1的445端口时，会转发到远程IP地址(117.73.12.12)的30445端口</p>
<p>查看端口转发配置列表，可以看到已经成功转发</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netsh interface portproxy show all</span><br></pre></td></tr></table></figure>
<p>打开系统服务管理器，找到server，右键属性–&gt; 启动类型改为禁用，然后重启电脑，再次查看服务状态，没有正在运行就是成功了。<br>在windows资源管理器中输入<code>\\127.0.0.1\</code>访问远程文件夹</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_43514847/article/details/133009479">https://blog.csdn.net/qq_43514847/article/details/133009479</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://abelxiaoxing.github.io/2024/10/23/arm%E8%AE%BE%E5%A4%87%E9%85%8D%E7%BD%AElunarvim/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="abelxiaoxing">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="abel的小天地">
      <meta itemprop="description" content="一个个人资料记录的小地方">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | abel的小天地">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/10/23/arm%E8%AE%BE%E5%A4%87%E9%85%8D%E7%BD%AElunarvim/" class="post-title-link" itemprop="url">arm设备配置lunarvim</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-10-23 13:37:05" itemprop="dateCreated datePublished" datetime="2024-10-23T13:37:05+08:00">2024-10-23</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-01-09 15:38:54" itemprop="dateModified" datetime="2025-01-09T15:38:54+08:00">2025-01-09</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="Neovim-amp-LunarVim"><a href="#Neovim-amp-LunarVim" class="headerlink" title="Neovim&amp;LunarVim"></a>Neovim&amp;LunarVim</h2><p>Neovim最近几年的热度十分高，相比之前使用Vim，Neovim明显更快。同时Neovim使用Lua脚本化语言进行配置，确实更加方便。<br>但是手动配置Neovim，总归有点麻烦。尤其是刚转向Neovim，对Lua的语法还不是很熟悉的情况下，怎么才能快速配置，让它先跑起来呢？</p>
<p>答案很简单，就是用别人整合好的配置。网上有非常多别人整合好的GitHub仓库包，这里介绍一个特殊的项目：<a target="_blank" rel="noopener" href="https://www.lunarvim.org/">LunarVim</a></p>
<p>通过LunarVim的配置，可以让你的Neovim瞬间在Linux服务器上变身成为IDE。</p>
<h2 id="Neovim安装"><a href="#Neovim安装" class="headerlink" title="Neovim安装"></a>Neovim安装</h2><p>首先我们需要安装Neovim，安装的方法很多：</p>
<ol>
<li>软件包管理器安装</li>
<li>软件包安装</li>
<li>编译安装<br>没有说那种方法就最好，但是如果说麻烦…… 还是编译安装麻烦点，但是目前arm架构的Linux，目前只能用编译安装。</li>
</ol>
<p>好在，编译安装的Neovim兼容性最好。</p>
<h2 id="软件包管理器"><a href="#软件包管理器" class="headerlink" title="软件包管理器"></a>软件包管理器</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Debian(Ubuntu)</span></span><br><span class="line"><span class="built_in">sudo</span> apt install neovim</span><br><span class="line"><span class="comment"># Archlinux</span></span><br><span class="line"><span class="built_in">sudo</span> pacman -S neovim</span><br><span class="line"><span class="comment"># macOS(需要Homebrew支持)</span></span><br><span class="line">brew install neovim</span><br></pre></td></tr></table></figure>
<p>但是，有时候，软件包管理器若安装的Neovim版本过低，就需要下载软件包安装或者手动编译安装了。</p>
<h2 id="软件包"><a href="#软件包" class="headerlink" title="软件包"></a>软件包</h2><p>当然，有时候软件包管理器安装的Neovim过低，我们可以下载软件包安装。<a target="_blank" rel="noopener" href="https://github.com/neovim/neovim/releases">Neovim发布地址</a>有提供Debian、macos、windows的软件包<br>举个例子，在Debian\Ubuntu发行版上进行安装</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 下载发行版本</span></span><br><span class="line">wget https://github.com/neovim/neovim/releases/download/stable/nvim-linux64.deb</span><br><span class="line"><span class="comment"># 使用dpkg包管理器安装</span></span><br><span class="line">dpkg -i nvim-linux64.deb</span><br></pre></td></tr></table></figure>
<p>当然，不支持Arm架构，所以在aidlux和树莓派上安装是不行的</p>
<h2 id="编译安装"><a href="#编译安装" class="headerlink" title="编译安装"></a>编译安装</h2><p>在2.0.0Aidlux的20.04lts版本的ubuntu（arm）上进行安装</p>
<p>首先，克隆项目，通常我们使用稳定版本：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 克隆项目</span></span><br><span class="line">git <span class="built_in">clone</span> https://github.com/neovim/neovim</span><br><span class="line"><span class="comment"># 进入项目内</span></span><br><span class="line"><span class="built_in">cd</span> neovim</span><br><span class="line"><span class="comment"># 切换分支为稳定版本</span></span><br><span class="line">git checkout stable</span><br></pre></td></tr></table></figure>
<p>之后，使用cmake进行编译：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make CMAKE_BUILD_TYPE=RelWithDebInfo</span><br></pre></td></tr></table></figure>
<p>之后，使用命令进行安装：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> make install</span><br></pre></td></tr></table></figure>
<p>如果你想卸载neovim，可以在当前目录下执行：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> cmake --build build/ --target uninstall</span><br></pre></td></tr></table></figure>
<h2 id="LunarVim配置位置"><a href="#LunarVim配置位置" class="headerlink" title="LunarVim配置位置"></a>LunarVim配置位置</h2><p>LunarVim安装不需要root权限，并且是对原有的neovim进行封装，所以只是会有一些仓库文件。最棒的是，它的安装非常合规：</p>
<ul>
<li>$HOME&#x2F;.config&#x2F;lvim：lvim的个性化配置文件；</li>
<li>$HOME&#x2F;.local&#x2F;bin&#x2F;lvim：lvim的执行文件；</li>
<li>$HOME&#x2F;.cache&#x2F;lvim：lvim的缓存目录；</li>
<li>$HOME&#x2F;.config&#x2F;lvim.old：可能存在的lvim个性化文件备份</li>
</ul>
<p>如果需要卸载LunarVim：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">rm</span> -rf ~/.config/lvim ~/.local/share/lunarvim ~/.local/bin/lvim ~/.config/lvim.old</span><br></pre></td></tr></table></figure>
<h2 id="LunarVim安装"><a href="#LunarVim安装" class="headerlink" title="LunarVim安装"></a>LunarVim安装</h2><p>需要使用科学上网</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LV_BRANCH=<span class="string">&#x27;release-1.2/neovim-0.8&#x27;</span> bash &lt;(curl -s https://raw.githubusercontent.com/lunarvim/lunarvim/master/utils/installer/install.sh)</span><br></pre></td></tr></table></figure>
<p>添加到环境变量</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;export PATH=\$PATH:\$HOME.local/bin&quot;</span> &gt;&gt; ~/.zshrc</span><br></pre></td></tr></table></figure>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ol>
<li><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1hR4y1Y7CS">https://www.bilibili.com/video/BV1hR4y1Y7CS</a></li>
<li><a target="_blank" rel="noopener" href="https://www.mintimate.cn/2023/01/10/guideForLunarvim">https://www.mintimate.cn/2023/01/10/guideForLunarvim</a></li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://abelxiaoxing.github.io/2024/10/12/%E5%A6%82%E4%BD%95%E5%AE%89%E8%A3%85Shizuku%E5%92%8CLSPatch%E5%B9%B6%E5%AE%89%E8%A3%85%E6%A8%A1%E5%9D%97(%E4%B8%8D%E9%9C%80%E8%A6%81Root%EF%BC%8C%E9%9D%9EMagisk)/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="abelxiaoxing">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="abel的小天地">
      <meta itemprop="description" content="一个个人资料记录的小地方">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | abel的小天地">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/10/12/%E5%A6%82%E4%BD%95%E5%AE%89%E8%A3%85Shizuku%E5%92%8CLSPatch%E5%B9%B6%E5%AE%89%E8%A3%85%E6%A8%A1%E5%9D%97(%E4%B8%8D%E9%9C%80%E8%A6%81Root%EF%BC%8C%E9%9D%9EMagisk)/" class="post-title-link" itemprop="url">如何安装Shizuku和LSPatch并安装模块（不需要Root，非Magisk）</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-10-12 17:13:00" itemprop="dateCreated datePublished" datetime="2024-10-12T17:13:00+08:00">2024-10-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-01-09 15:38:54" itemprop="dateModified" datetime="2025-01-09T15:38:54+08:00">2025-01-09</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="安装-Shizuku"><a href="#安装-Shizuku" class="headerlink" title="安装 Shizuku"></a>安装 Shizuku</h2><p><a target="_blank" rel="noopener" href="https://shizuku.rikka.app/zh-hans">官网</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/RikkaApps/Shizuku/releases/latest">下载</a></p>
<p><a target="_blank" rel="noopener" href="https://shizuku.rikka.app/zh-hans/guide/setup/#%E9%80%9A%E8%BF%87%E6%97%A0%E7%BA%BF%E8%B0%83%E8%AF%95%E5%90%AF%E5%8A%A8">官方手册</a></p>
<ol>
<li>打开开发者模式</li>
<li>返回设置 -&gt; 其他设置 -&gt; 开发者选项 -&gt; 打开无线调试，ColorOS还需要打开禁止权限监控和usb调试</li>
<li>启动 Shizuku，点击配对，在无线调试中使用配对码配对设备，并在通知栏输入配对码</li>
<li>配对成功，启动shizuku</li>
</ol>
<h2 id="安装LSPatch"><a href="#安装LSPatch" class="headerlink" title="安装LSPatch"></a>安装LSPatch</h2><p><a target="_blank" rel="noopener" href="https://github.com/LSPosed/LSPatch/releases/download/v0.6/manager-v0.6-398-release.apk">下载</a></p>
<p>在 Shizuku 授权应用管理中把 LSPatch 打开，打开 LSPatch</p>
<p><img src="/../images/%E5%A6%82%E4%BD%95%E5%AE%89%E8%A3%85Shizuku%E5%92%8CLSPatch%E5%B9%B6%E5%AE%89%E8%A3%85%E6%A8%A1%E5%9D%97%EF%BC%88%E4%B8%8D%E9%9C%80%E8%A6%81Root%EF%BC%8C%E9%9D%9EMagisk%EF%BC%89/image.png" alt="image.png"></p>
<p><img src="/../images/%E5%A6%82%E4%BD%95%E5%AE%89%E8%A3%85Shizuku%E5%92%8CLSPatch%E5%B9%B6%E5%AE%89%E8%A3%85%E6%A8%A1%E5%9D%97%EF%BC%88%E4%B8%8D%E9%9C%80%E8%A6%81Root%EF%BC%8C%E9%9D%9EMagisk%EF%BC%89/image%201.png" alt="image.png"></p>
<h2 id="安装模块"><a href="#安装模块" class="headerlink" title="安装模块"></a>安装模块</h2><p><a target="_blank" rel="noopener" href="https://github.com/orgs/Xposed-Modules-Repo/repositories">下载</a></p>
<p>本地模式可以灵活修改插件，但是必须要LSPatch后端运行。集成模式分享给别的用户也可正常使用对应模块，但是每次安装模块时必须重新修补。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://abelxiaoxing.github.io/2024/08/09/%E6%98%87%E8%85%BECANN%E6%A8%A1%E5%9E%8B%E8%BD%AC%E6%8D%A2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="abelxiaoxing">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="abel的小天地">
      <meta itemprop="description" content="一个个人资料记录的小地方">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | abel的小天地">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/08/09/%E6%98%87%E8%85%BECANN%E6%A8%A1%E5%9E%8B%E8%BD%AC%E6%8D%A2/" class="post-title-link" itemprop="url">昇腾CANN模型转换实践指南</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-08-09 14:20:26" itemprop="dateCreated datePublished" datetime="2024-08-09T14:20:26+08:00">2024-08-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-03-18 17:25:07" itemprop="dateModified" datetime="2025-03-18T17:25:07+08:00">2025-03-18</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="一、开发环境配置"><a href="#一、开发环境配置" class="headerlink" title="一、开发环境配置"></a>一、开发环境配置</h2><h3 id="1-系统准备"><a href="#1-系统准备" class="headerlink" title="1. 系统准备"></a>1. 系统准备</h3><ul>
<li><strong>推荐系统</strong>: Ubuntu 20.04 LTS</li>
<li><strong>换源配置</strong>:<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/apt/sources.list</span><br></pre></td></tr></table></figure>
替换为阿里云镜像源：<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">deb http://mirrors.aliyun.com/ubuntu/ bionic main restricted universe multiverse</span><br><span class="line">deb-src http://mirrors.aliyun.com/ubuntu/ bionic main restricted universe multiverse</span><br><span class="line"></span><br><span class="line">deb http://mirrors.aliyun.com/ubuntu/ bionic-security main restricted universe multiverse</span><br><span class="line">deb-src http://mirrors.aliyun.com/ubuntu/ bionic-security main restricted universe multiverse</span><br><span class="line"></span><br><span class="line">deb http://mirrors.aliyun.com/ubuntu/ bionic-updates main restricted universe multiverse</span><br><span class="line">deb-src http://mirrors.aliyun.com/ubuntu/ bionic-updates main restricted universe multiverse</span><br><span class="line"></span><br><span class="line">deb http://mirrors.aliyun.com/ubuntu/ bionic-proposed main restricted universe multiverse</span><br><span class="line">deb-src http://mirrors.aliyun.com/ubuntu/ bionic-proposed main restricted universe multiverse</span><br><span class="line"></span><br><span class="line">deb http://mirrors.aliyun.com/ubuntu/ bionic-backports main restricted universe multiverse</span><br><span class="line">deb-src http://mirrors.aliyun.com/ubuntu/ bionic-backports main restricted universe multiverse</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="2-安装基础依赖"><a href="#2-安装基础依赖" class="headerlink" title="2. 安装基础依赖"></a>2. 安装基础依赖</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo apt update &amp;&amp; sudo apt upgrade -y</span><br><span class="line">sudo apt-get install -y gcc g++ make cmake zlib1g zlib1g-dev openssl libsqlite3-dev libssl-dev libffi-dev </span><br><span class="line">sudo apt-get install -y unzip pciutils net-tools libblas-dev gfortran libblas3 libopenblas-dev libncursesw5-dev</span><br></pre></td></tr></table></figure>

<h3 id="3-Python环境配置"><a href="#3-Python环境配置" class="headerlink" title="3. Python环境配置"></a>3. Python环境配置</h3><ul>
<li><strong>安装Miniconda</strong>:<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh</span><br><span class="line">bash Miniconda3-latest-Linux-x86_64.sh -b -u -p $HOME/miniconda3</span><br></pre></td></tr></table></figure></li>
<li><strong>创建专用环境</strong>:<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">conda create -n cann python=3.9</span><br><span class="line">conda activate cann</span><br><span class="line">pip3 install --upgrade pip</span><br><span class="line">pip install attrs numpy==1.17.2 decorator sympy cffi pyyaml pathlib2 psutil protobuf scipy requests onnx</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="二、CANN-Toolkit安装"><a href="#二、CANN-Toolkit安装" class="headerlink" title="二、CANN Toolkit安装"></a>二、CANN Toolkit安装</h2><h3 id="1-工具包获取"><a href="#1-工具包获取" class="headerlink" title="1. 工具包获取"></a>1. 工具包获取</h3><ul>
<li>官方渠道：<a target="_blank" rel="noopener" href="https://www.hiascend.com/zh/developer/download/community/result?module=cann">华为昇腾社区</a></li>
<li>备用资源（x86架构）：<br>链接: <a target="_blank" rel="noopener" href="https://pan.baidu.com/s/1XcSjmIDuwMz7I_bx2E4-uA?pwd=abel">Ascend-cann-toolkit_8.0.RC3.alpha001_linux-x86_64.run</a><br>提取码: abel  </li>
<li>备用资源（aarch64架构）：<br>链接: <a target="_blank" rel="noopener" href="https://pan.baidu.com/s/1IG0vPiG9uhqPV_S110hdFA?pwd=abel">Ascend-cann-toolkit_8.0.RC3.alpha001_linux-aarch64.run</a><br>提取码: abel</li>
</ul>
<h3 id="2-安装步骤"><a href="#2-安装步骤" class="headerlink" title="2. 安装步骤"></a>2. 安装步骤</h3><p>在终端输入以下命令</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chmod +x Ascend-cann-toolkit_8.0.RC3.alpha001_linux-x86_64.run</span><br><span class="line">./Ascend-cann-toolkit_8.0.RC3.alpha001_linux-x86_64.run --install</span><br></pre></td></tr></table></figure>

<h3 id="3-环境配置"><a href="#3-环境配置" class="headerlink" title="3. 环境配置"></a>3. 环境配置</h3><p>对于Atlas 200 AI加速模块 （RC场景）和Atlas 500 小站(运行环境aarch64架构)来说，当开发环境是一台X86 PC进行环境搭建时，需要在开发环境中安装交叉编译工具 </p>
<ul>
<li><p><strong>安装交叉编译工具</strong>:</p>
 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install g++-aarch64-linux-gnu</span><br></pre></td></tr></table></figure></li>
<li><p><strong>解决共享库问题</strong>:<br>上述安装过程中若出现报错：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">libascend_hal.so: cannot open shared object file: No such……</span><br></pre></td></tr></table></figure>
<p>进入到Ascend目录下输入</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo find ./ -name libascend_hal.so  # 查找库路径</span><br><span class="line">sudo cp &#123;找到的路径&#125; /usr/local/lib/  # 拷贝库到共享库目录</span><br></pre></td></tr></table></figure>
<p>进入“&#x2F;etc&#x2F;ld.so.conf”,并将<code>include /usr/local/lib</code>添加至文件最后一行后，终端输入以下命令</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ldconfig # 更新共享库缓存</span><br><span class="line">sudo ldconfig # 更新系统缓存</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>添加环境变量</strong>:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;source ~/Ascend/ascend-toolkit/set_env.sh&quot; &gt;&gt; ~/.zshrc</span><br><span class="line">source ~/.zshrc</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="三、模型转换流程"><a href="#三、模型转换流程" class="headerlink" title="三、模型转换流程"></a>三、模型转换流程</h2><h3 id="1-ONNX模型验证"><a href="#1-ONNX模型验证" class="headerlink" title="1. ONNX模型验证"></a>1. ONNX模型验证</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> onnx</span><br><span class="line">model = onnx.load(<span class="string">&#x27;model.onnx&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;输入节点:&quot;</span>, [<span class="built_in">input</span>.name <span class="keyword">for</span> <span class="built_in">input</span> <span class="keyword">in</span> model.graph.<span class="built_in">input</span>])</span><br></pre></td></tr></table></figure>
<p>若此处输出”inputxxxx”，因此于–input_shape中，填入的模型名称为”inputxxxx”</p>
<h3 id="2-atc本地转换（开发环境）"><a href="#2-atc本地转换（开发环境）" class="headerlink" title="2. atc本地转换（开发环境）"></a>2. atc本地转换（开发环境）</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">atc --model=model.onnx \</span><br><span class="line">    --framework=5 \</span><br><span class="line">    --output=model \</span><br><span class="line">    --soc_version=Ascend310B1 \</span><br><span class="line">    --input_shape=&quot;inputxxxx:1,3,224,224&quot;</span><br></pre></td></tr></table></figure>

<h2 id="四、昇腾开发板部署"><a href="#四、昇腾开发板部署" class="headerlink" title="四、昇腾开发板部署"></a>四、昇腾开发板部署</h2><h3 id="1-文件传输"><a href="#1-文件传输" class="headerlink" title="1. 文件传输"></a>1. 文件传输</h3><p>将onnx文件传输到昇腾开发板上  </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scp ./model.onnx root@10.0.0.1:/pytroch</span><br></pre></td></tr></table></figure>

<h3 id="2-板端模型转换"><a href="#2-板端模型转换" class="headerlink" title="2. 板端模型转换"></a>2. 板端模型转换</h3><p>使用ATC工具将onnx转化为om，我这里的昇腾型号是Ascend310B1  </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">atc --model=./model.onnx --framework=5 --output=/root --soc_version=Ascend310B1</span><br></pre></td></tr></table></figure>

<h3 id="3-转换验证"><a href="#3-转换验证" class="headerlink" title="3. 转换验证"></a>3. 转换验证</h3><p>成功输出示例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ATC run success</span><br></pre></td></tr></table></figure>

<h2 id="常见问题排查"><a href="#常见问题排查" class="headerlink" title="常见问题排查"></a>常见问题排查</h2><ol>
<li><p><strong>库文件缺失</strong>:</p>
<ul>
<li>现象：<code>libascend_hal.so: cannot open shared object file:No such……</code></li>
<li>解决：检查环境变量配置，确认<code>LD_LIBRARY_PATH</code>包含库路径</li>
</ul>
</li>
<li><p><strong>输入形状不匹配</strong>:</p>
<ul>
<li>现象：<code>Input shape mismatch</code></li>
<li>解决：使用Netron工具可视化模型，确认输入节点名称和维度</li>
</ul>
</li>
<li><p><strong>算子不支持</strong>:</p>
<ul>
<li>现象：<code>Unsupported op type: XXX</code></li>
<li>解决：查阅<a target="_blank" rel="noopener" href="https://www.hiascend.com/document/detail/zh/CANNCommunityEdition">CANN算子清单</a>，考虑自定义算子或模型结构调整</li>
</ul>
</li>
</ol>
<h2 id="附录：参考资源"><a href="#附录：参考资源" class="headerlink" title="附录：参考资源"></a>附录：参考资源</h2><ol>
<li><a target="_blank" rel="noopener" href="https://www.hiascend.com/document/detail/zh/CANNCommunityEdition">CANN官方文档</a></li>
<li><a target="_blank" rel="noopener" href="https://www.hiascend.com/document/detail/zh/CANNCommunityEdition/700alpha003/infacldevg/atctool/atlasatc_16_0039.html">ATC工具参数详解</a></li>
<li><a target="_blank" rel="noopener" href="https://bbs.huaweicloud.com/forum/forum-726-1.html">昇腾开发者论坛</a></li>
</ol>
<pre><code>
</code></pre>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://abelxiaoxing.github.io/2024/07/23/Unet%E5%8F%91%E5%B1%95%E5%8E%86%E7%A8%8B%E5%92%8C%E6%80%9D%E8%B7%AF/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="abelxiaoxing">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="abel的小天地">
      <meta itemprop="description" content="一个个人资料记录的小地方">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | abel的小天地">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/07/23/Unet%E5%8F%91%E5%B1%95%E5%8E%86%E7%A8%8B%E5%92%8C%E6%80%9D%E8%B7%AF/" class="post-title-link" itemprop="url">Unet发展历程和思路</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-07-23 03:24:49" itemprop="dateCreated datePublished" datetime="2024-07-23T03:24:49+08:00">2024-07-23</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-01-09 15:38:54" itemprop="dateModified" datetime="2025-01-09T15:38:54+08:00">2025-01-09</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="1-铺垫"><a href="#1-铺垫" class="headerlink" title="1. 铺垫"></a>1. 铺垫</h2><p>在计算机视觉领域，全卷积网络（FCN）是比较有名的图像分割网络，医学图像处理方向，U-Net可以说是一个更加炙手可热的网络，基本上所有的分割问题，我们都会拿U-Net先看一下基本的结果，然后进行“魔改”。<br><img src="/../images/Unet%E5%8F%91%E5%B1%95%E5%8E%86%E7%A8%8B%E5%92%8C%E6%80%9D%E8%B7%AF/Untitled.png" alt="Untitled"><br>U-Net和FCN非常的相似，U-Net比FCN稍晚提出来，但都发表在2015年，和FCN相比，U-Net的第一个特点是完全对称，也就是左边和右边是很类似的，而FCN的decoder相对简单，只用了一个deconvolution的操作，之后并没有跟上卷积结构。第二个区别就是skip connection，FCN用的是加操作（summation），U-Net用的是叠操作（concatenation）。这些都是细节，重点是它们的结构用了一个比较经典的思路，也就是编码和解码（encoder-decoder），早在2006年就被Hinton大神提出来发表在了nature上。<br>当时这个结构提出的主要作用并不是分割，而是压缩图像和去噪声。输入是一幅图，经过下采样的编码，得到一串比原先图像更小的特征，相当于压缩，然后再经过一个解码，理想状况就是能还原到原来的图像。这样的话我们存一幅图的时候就只需要存一个特征和一个解码器即可。这个想法我个人认为是很漂亮了。同理，这个思路也可以用在原图像去噪，做法就是在训练的阶段在原图人为的加上噪声，然后放到这个编码解码器中，目标是可以还原得到原图。<br>后来把这个思路被用在了图像分割的问题上，也就是现在我们看到的U-Net结构，在它被提出的三年中，有很多很多的论文去讲如何改进U-Net或者FCN，不过这个分割网络的本质的拓扑结构是没有改动的。举例来说，去年ICCV上凯明大神提出的Mask RCNN. 相当于一个检测，分类，分割的集大成者，我们仔细去看它的分割部分，其实使用的也就是这个简单的FCN结构。说明了这种“U形”的编码解码结构确实非常的简洁，并且最关键的一点是好用。<br>简单的过一下这个网红结构，我们先提取出它的拓扑结构，这样会比较容易分析它的实质，排除很多细节的干扰。<br>输入是一幅图，输出是目标的分割结果。继续简化就是，一幅图，编码，或者说降采样，然后解码，也就是升采样，然后输出一个分割结果。根据结果和真实分割的差异，反向传播来训练这个分割网络。我们可以说，U-Net里面最精彩的部分就是这三部分：</p>
<ul>
<li>下采样</li>
<li>上采样</li>
<li>skip connection<br>这就是在我眼中的大部分分割网络的拓扑结构。<br><img src="/../images/Unet%E5%8F%91%E5%B1%95%E5%8E%86%E7%A8%8B%E5%92%8C%E6%80%9D%E8%B7%AF/Untitled%201.png" alt="Untitled"></li>
</ul>
<h2 id="2-展开"><a href="#2-展开" class="headerlink" title="2. 展开"></a>2. 展开</h2><p>基本的铺垫都已经完成了，看着这个拓扑结构，一个非常广义的问题就是：<br><span style="color:red;"><strong>这个三年不动的拓扑结构真的一点儿毛病都没有吗？</strong></span><br>在这三年中，U-Net得到的超过2500次的引用，FCN接近6000次的引用，大家都在做什么样的改进呢？如果让你在这个经典的结构基础上改进，你会去关注哪些点呢？<br>首先一个问题是：<span style="color:red;"><strong>要多深合适？</strong> </span><br>这里我想强调的一点是，很多论文给出了他们建议的网络结构，其中包括非常多的细节，比如用什么卷积，用几层，怎么降采样，学习率多少，优化器用什么，这些都是比较直观的参数，其实这些在论文中给出参数并不见得是最好的，所以关注这些的意义不大，一个网络结构，我们真正值得关注的是它的设计传达了什么信息。就拿U-Net来说，原论文给出的结构是原图经过四次降采样，四次上采样，得到分割结果，实际呢，为什么四次？就是作者喜欢呗，或者说当时作者使用的数据集，四次降采样的效果好，我们也可以更再专业一点，四次降采样的接受域或者感受野大小正合适处理图像。或者四次降采样比较适合输入图像的尺寸等等，理由一堆，但是你们真的相信吗？不见得吧。<br>我先给一个2017年在CVPR上发表的一个名叫<a href="https://link.zhihu.com/?target=https://arxiv.org/abs/1612.01105">PSPNet</a>的分割网络，你会发现，好像整体的架构和U-Net还是像的，只是降采样的数目减小了，当然，他们也针对性的增强了中间的特征抓取环节的复杂性。<br><img src="/../images/Unet%E5%8F%91%E5%B1%95%E5%8E%86%E7%A8%8B%E5%92%8C%E6%80%9D%E8%B7%AF/Untitled%202.png" alt="Untitled"><br>要是你觉得这个工作还不够说明4次降采样不是必须的话，我们再来看看Yoshua Bengio组最近的关于图像分割的论文，这是他们提出的结构，名叫<a href="https://link.zhihu.com/?target=https://arxiv.org/abs/1611.09326">提拉米苏</a>。<br><img src="/../images/Unet%E5%8F%91%E5%B1%95%E5%8E%86%E7%A8%8B%E5%92%8C%E6%80%9D%E8%B7%AF/Untitled%203.png" alt="Untitled"><br>也是U形结构，但你会发现，他们就只用了三次降采样。所以到底要多深，是不是越深越好？还是一个open quesion。<br>我想分享的第一个信息就是：关注论文所传递的大方向，不要被论文中的细节局限了创造力。像这种细节参数的调整是属于比较朴素的深度学习方法论，很容易花费你很多时间，而最终并没有自身科研水平的提升。<br>好，我们回来继续讨论到底需要多深的问题。其实这个是非常灵活的，涉及到的一个点就是特征提取器，U-Net和FCN为什么成功，因为它相当于给了一个网络的框架，具体用什么特征提取器，随便。这个时候，高引就出现了，各种在encoder上的微创新络绎不绝，最直接的就是用ImageNet里面的明星结构来套嘛，前几年的BottleNeck，Residual，还有去年的DenseNet，就比谁出文章快。这一类的论文就相当于从1到10的递进，而U-Net这个低层结构的提出却是从0到1。说句题外话，像这种从1到10的论文，引用往往不会比从0到1的论文高，因为它不自觉的局限了自己的扩展空间，比如我说，我写一篇论文，说特征提取器就必须是dense block，或者必须是residual block效果好，然后名字也就是DenseUNet或者ResUNet，就这样结束了。所以关于backbone到底用什么的问题，并不是我这次要讲的重点。<br><img src="/../images/Unet%E5%8F%91%E5%B1%95%E5%8E%86%E7%A8%8B%E5%92%8C%E6%80%9D%E8%B7%AF/Untitled%204.png" alt="Untitled"><br>关于到底要多深这个问题，还有一个引申的问题就是，<span style="color:red;"><strong>降采样对于分割网络到底是不是必须的？</strong> </span>问这个问题的原因就是，既然输入和输出都是相同大小的图，为什么要折腾去降采样一下再升采样呢？<br>比较直接的回答当然是降采样的理论意义，我简单朗读一下，它可以增加对输入图像的一些小扰动的鲁棒性，比如图像平移，旋转等，减少过拟合的风险，降低运算量，和增加感受野的大小。升采样的最大的作用其实就是把抽象的特征再还原解码到原图的尺寸，最终得到分割结果。<br><img src="/../images/Unet%E5%8F%91%E5%B1%95%E5%8E%86%E7%A8%8B%E5%92%8C%E6%80%9D%E8%B7%AF/Untitled%205.png" alt="Untitled"><br><img src="/../images/Unet%E5%8F%91%E5%B1%95%E5%8E%86%E7%A8%8B%E5%92%8C%E6%80%9D%E8%B7%AF/Untitled%206.png" alt="Untitled"><br>这些理论的解释都是有道理的，在我的理解中，对于特征提取阶段，浅层结构可以抓取图像的一些简单的特征，比如边界，颜色，而深层结构因为感受野大了，而且经过的卷积操作多了，能抓取到图像的一些说不清道不明的抽象特征，讲的越来越玄学了，总之，浅有浅的侧重，深有深的优势。那我就要问一个比较犀利的问题了，既然浅层特征和深层特征都很重要，U-Net为什么只在4层以后才返回去，也就是只去抓深层特征。我不知道有没有说明白这个问题本身。问题实际是这样的，看这个图，既然 $X^{1,0}$, $X^{2,0}$, $X^{3,0}$, $X^{4,0}$ 所抓取的特征都很重要，为什么我非要降到 $X^{4,0}$ 层了才开始上采样回去呢？<br>这是因为在 U-Net 结构中，降采样操作可以帮助网络抓取更高级别的特征信息。随着网络的层数增加，感受野的大小也随之增加，网络能够捕捉到更广阔的上下文信息。因此，下采样过程中的每一层都可以提供不同层次的特征表示。但是，上采样过程中，只有在到达最深层 $X^{4,0}$ 后，才能开始逐层恢复图像的分辨率，然后将这些特征与对应的上采样层进行融合。这样的设计可以确保网络能够逐步还原图像细节，并更好地进行分割任务。<br><img src="/../images/Unet%E5%8F%91%E5%B1%95%E5%8E%86%E7%A8%8B%E5%92%8C%E6%80%9D%E8%B7%AF/Untitled%207.png" alt="Untitled"></p>
<h2 id="3-主体"><a href="#3-主体" class="headerlink" title="3. 主体"></a>3. 主体</h2><p>沿着这个逻辑往下捋，不知道大家能否猜到我的下一步是什么？此处可以暂停。有没有呼之欲出了？如果排除一切其他干扰，既然我们不知道需要多深，是不是会衍生出一系列像这样子的U-Net，它们的深度不一。这个不难理解吧。为了搞清楚是不是越深越好，我们应该对它们做一下实验，看看它们各自的分割表现：  <img src="/../images/Unet%E5%8F%91%E5%B1%95%E5%8E%86%E7%A8%8B%E5%92%8C%E6%80%9D%E8%B7%AF/Untitled%208.png" alt="Untitled"><br>先不要看后两个UNet++，就看这个不同深度的U-Net的表现，我们可以看出，不是越深越好吧，它背后的传达的信息就是，不同层次特征的重要性对于不同的数据集是不一样的，并不是说我设计一个4层的U-Net，就像原论文给出的那个结构，就一定对所有数据集的分割问题都最优。<br>那么接下来是关键，我们心中的目标很明确了，<span style="color:red;"><strong>就是使用浅层和深层的特征!</strong></span>但是总不能训练这些个U-Net吧，未免也太多了。好，这里可以暂停一下，想一想，要你来，你怎么来利用这些不同深度的，各自能抓取不同层次的特征的U-Net。<br><img src="/../images/Unet%E5%8F%91%E5%B1%95%E5%8E%86%E7%A8%8B%E5%92%8C%E6%80%9D%E8%B7%AF/Untitled%209.png" alt="Untitled"><br>我把图打出来就很简单了。<br><img src="/../images/Unet%E5%8F%91%E5%B1%95%E5%8E%86%E7%A8%8B%E5%92%8C%E6%80%9D%E8%B7%AF/Untitled%2010.png" alt="Untitled"><br>我们来看一看，这样是不是把1～4层的U-Net全给连一起了。我们来看它们的子集，包含1层U-Net，2层U-Net，以此类推。这个结构的好处就是我不管你哪个深度的特征有效，我干脆都给你用上，让网络自己去学习不同深度的特征的重要性。第二个好处是它共享了一个特征提取器，也就是你不需要训练一堆U-Net，而是只训练一个encoder，它的不同层次的特征由不同的decoder路径来还原。这个encoder依旧可以灵活的用各种不同的backbone来代替。<br>可惜的是，这个网络结构是不能被训练的，原因在于，不会由任何梯度会经过这个红色区域，因为它和算loss function的地方是在反向传播时是断开的。我停顿一下，大家想一想是不是这么回事。<br><img src="/../images/Unet%E5%8F%91%E5%B1%95%E5%8E%86%E7%A8%8B%E5%92%8C%E6%80%9D%E8%B7%AF/Untitled%2011.png" alt="Untitled"><br><span style="color:red;"><strong>请问，如果是你，如何去解决这个问题？</strong></span><br>其实既然已经把结构盘成这样了，还是很自然能想到的吧，我这里提供有两个候选的解决方案。  </p>
<ul>
<li>第一个是用deep supervision，强行加梯度是吧，关于这个，我待会儿展开来说。  </li>
<li>第二个解决方案是把结构改成这样子：</li>
</ul>
<p><img src="/../images/Unet%E5%8F%91%E5%B1%95%E5%8E%86%E7%A8%8B%E5%92%8C%E6%80%9D%E8%B7%AF/Untitled%2012.png" alt="Untitled"><br>如果没有我上面说的那一堆话来盘逻辑，这个结构可能不那么容易想到，但是如果顺着思路一步一步的走，这个结构虽然不能说是显而易见，也算是顺理成章的。我的故事还没有讲完，但是我提一句，这个结构由UC Berkeley的团队提出，发表在2018年的CVPR上，是一个oral的论文，题目是”<a href="https://link.zhihu.com/?target=http://openaccess.thecvf.com/content_cvpr_2018/papers/Yu_Deep_Layer_Aggregation_CVPR_2018_paper.pdf">Deep Layer Aggregation</a>“。<br>可能就有小伙伴惊呆了，就这样吗，就发了CVPR！？是，也不是。。。这只是他们在论文中给出的关于分割网络结构的改进，他们还做了其他的工作，包括分类，和边缘检测。但是主要的思路就是刚刚盘的那些，目标就是取整合各个不同层次的特征。<br>这只是一个题外话哦，我们继续来看这个结构，<span style="color:red;"><strong>请问，你觉得有什么问题？</strong></span><br>为了回答这个问题，现在我们和上面那个结构对比一下，不难发现这个结构强行去掉了U-Net本身自带的长连接。取而代之的是一系列的短连接。那么我们来看看U-Net引以为傲的长连接到底有什么优点。<br><img src="/../images/Unet%E5%8F%91%E5%B1%95%E5%8E%86%E7%A8%8B%E5%92%8C%E6%80%9D%E8%B7%AF/Untitled%2013.png" alt="Untitled"><br>我们认为，U-Net中的长连接是有必要的，它联系了输入图像的很多信息，有助于还原降采样所带来的信息损失，在一定程度上，我觉得它和残差的操作非常类似，也就是residual操作，x+f(x)。我不知道大家是否同意这一个观点。因此，我的建议是最好给出一个综合长连接和短连接的方案。请问，这个方案在你的脑海中是什么样的呢？此处可停顿。<br><img src="/../images/Unet%E5%8F%91%E5%B1%95%E5%8E%86%E7%A8%8B%E5%92%8C%E6%80%9D%E8%B7%AF/Untitled%2014.png" alt="Untitled"><br>基本上就是这样一个结构没跑了是么。我们来对比一下一开始的U-Net，它其实是这个结构的一个子集。这个结构，就是我们在MICCAI中发表的UNet++。热心的网友可能会问哦，你的UNet++和刚刚说的那个CVPR的论文结构也太像了吧，我说一下这个工作和UC Berkeley的研究是完全两个独立的工作，也算是一个美丽的巧合。UNet++在今年年初时思路就已经成型了，CVPR那篇是我们今年七月份开会的时候看到的，当时UNet++已经被录用了，所以相当于同时提出。另外，和CVPR的那篇论文相比，我还有一个更精彩的点埋在后面说，刚刚也留了一个伏笔。<br>好，当你现在盯着UNet++的时候，不知道会不会冷不丁会冒出来一个问题：<br><span style="color:red;"><strong>这个网络比U-Net效果好，但是这个网络增加了多少的参数，加粗的参数可都是比U-Net多出来的啊？</strong></span><br>这个问题非常的尖锐，实际上是需要设计实验来回答的，如何设计这个实验呢？我们的做法是强行增加U-Net里面的参数量，让它变宽，也就是增加它每个层的卷积核个数。由此，我们设计了一个叫wide U-Net的参考结构，先来看看UNet++的参数数量是9.04M，而U-Net是7.76M，多了差不多16%的参数，所以wide U-Net我们在设计时就让它的参数比UNet++差不多，并且还稍微多一点点，来证明并不是无脑增加参数量，模型效果就会好。<br><img src="/../images/Unet%E5%8F%91%E5%B1%95%E5%8E%86%E7%A8%8B%E5%92%8C%E6%80%9D%E8%B7%AF/Untitled%2015.png" alt="Untitled"><br>我本人是认为这个回击力度并不大，因为这样增加参数说心里话有点敷衍，应该能找到更好的对比方法。尽管有不足，我们先来看看结果。<br><img src="/../images/Unet%E5%8F%91%E5%B1%95%E5%8E%86%E7%A8%8B%E5%92%8C%E6%80%9D%E8%B7%AF/Untitled%2016.png" alt="Untitled"><br>根据现有的结果，我的总结是，单纯的把网络变宽，把参数提上去对效果的提升并不大，如何能把参数用在刀刃上是很重要的。那么UNet++这种设计就是将参数用在刀刃上的一个方案。<br><img src="/../images/Unet%E5%8F%91%E5%B1%95%E5%8E%86%E7%A8%8B%E5%92%8C%E6%80%9D%E8%B7%AF/Untitled%2017.png" alt="Untitled"><br>我们在回来看这个UNet++，对于这个主体结构，我给出了一些点评，说白了就是把原来空心的U-Net填满了，优势是可以抓取不同层次的特征，将它们通过特征叠加的方式整合，不同层次的特征，或者说不同大小的感受野，对于大小不一的目标对象的敏感度是不同的，比如，感受野大的特征，可以很容易的识别出大物体的，但是在实际分割中，大物体边缘信息和小物体本身是很容易被深层网络一次次的降采样和一次次升采样给弄丢的，这个时候就可能需要感受野小的特征来帮助。另一个解读就是如果你横着看其中一层的特征叠加过程，就像一个去年很火的DenseNet的结构，非常的巧合，原先的U-Net，横着看就很像是Residual的结构，这个就很有意思了，UNet++对于U-Net分割效果提升可能和DenseNet对于ResNet分类效果的提升，原因如出一辙，因此，在解读中我们也参考了Dense Connection的一些优势，比方说特征的再利用等等。<br>这些解读都是很直观的认识，其实在深度学习里面，某某结构效果优于某某结构的理由，或者你加这个操作比不加操作要好，很多时候是有玄学的味道在里头，也有大量的工作也在探索深度网络的可解释性。关于UNet++的主体结构，我不想花时间赘述了。  </p>
<h2 id="4-高潮"><a href="#4-高潮" class="headerlink" title="4. 高潮"></a>4. 高潮</h2><p>接下来我要说的这部分，非常的有意思。刚刚在讲这里的时候留了一个伏笔，说这个结构在反向传播的时候中间部分会收不到过来的梯度，如果只用最右边的一个loss来做的话。<br>刚才说了，一个非常直接的解决方案就是深监督，也就是deep supervision。这个概念不是新的，有很多对U-Net对改进论文中也有用到，具体的实现操作就是在图中 $X^{1.0}$, $X^{2.0}$ , $X^{3.0}$ , $X^{4.0}$ 后面加一个1x1的卷积核，相当于去监督每个level，或者每个分支的U-Net的输出。<br>我给大家提供三个用Deep Supervision的结构来比较，一个就是这个，第二个是加在UC Berkeley提出的结构上，最后一个是加在UNet++上，<span style="color:red;"><strong>请问是你认为哪个会更棒？</strong></span>这是一个开放问题，我这里不做展开讨论，我一般使用的是最后一个。<br>因为deep supervision具体应该套在哪个结构上面不是我想说的重点，deep supervision的优点也在很多论文中有讲解，我这里想着重讨论的是当它配合上这样一个填满的U-Net结构时，带来其中一个非常棒的优势。此处强烈建议停顿，想一想，<span style="color:red;"><strong>如果我在训练过程中在各个level的子网络中加了这种深监督，可以带来怎样的好处呢？</strong></span><br><img src="/../images/Unet%E5%8F%91%E5%B1%95%E5%8E%86%E7%A8%8B%E5%92%8C%E6%80%9D%E8%B7%AF/Untitled%2018.png" alt="Untitled"><br><span style="color:red;"><strong>两个字：剪枝。</strong></span><br>同时引出三个问题：  </p>
<ul>
<li><strong>为什么UNet++可以被剪枝</strong></li>
<li><strong>如何剪枝</strong></li>
<li><strong>好处在哪里</strong></li>
</ul>
<p><img src="/../images/Unet%E5%8F%91%E5%B1%95%E5%8E%86%E7%A8%8B%E5%92%8C%E6%80%9D%E8%B7%AF/Untitled%2019.png" alt="Untitled"><br>我们来看看为什么可以剪枝，这张图特别的精彩。关注被剪掉的这部分，你会发现，在测试的阶段，由于输入的图像只会前向传播，扔掉这部分对前面的输出完全没有影响的，而在训练阶段，因为既有前向，又有反向传播，被剪掉的部分是会帮助其他部分做权重更新的。这两句话同样重要，我再重复一遍，测试时，剪掉部分对剩余结构不做影响，训练时，剪掉部分对剩余部分有影响。这意味什么？<br>因为在深监督的过程中，每个子网络的输出都其实已经是图像的分割结果了，所以如果小的子网络的输出结果已经足够好了，我们可以随意的剪掉那些多余的部分了。<br>来看一下这个动图，为了定义的方便起见，我们把每个剪完剩下的子网络根据它们的深度命名为UNet++ L1，L2，L3，L4，后面会简称为L1～L4。最理想的状态是什么？当然是L1喽，如果L1的输出结果足够好，剪完以后的分割网络会变得非常的小。<br>这里我想问两个问题：</p>
<ul>
<li><strong>为什么要在测试的时候剪枝，而不是直接拿剪完的L1，L2，L3训练？</strong></li>
<li><strong>怎么去决定剪多少？</strong></li>
</ul>
<p>对于为什么要在测试的时候剪枝，而不是直接拿剪完的L1，L2，L3训练，我们的解释其实上一页ppt上面写了，剪掉的部分在训练时的反向传播中是有贡献的，如果直接拿L1，L2，L3训练，就相当于只训练了不同深度的U-Net，最后的结果会很差。<br>第二个问题，如何去决定剪多少，还是比较好回答的。因为在训练模型的时候会把数据分为训练集，验证集和测试集，训练集上是一定拟合的很好的，测试集是我们不能碰的，所以我们会根据子网络在验证集的结果来决定剪多少。所谓的验证集就是一开始从训练集中分出来的数据，用来监测训练过程用的。<br>好，讲完了思路，我们来看结果。<br><img src="/../images/Unet%E5%8F%91%E5%B1%95%E5%8E%86%E7%A8%8B%E5%92%8C%E6%80%9D%E8%B7%AF/Untitled%2020.png" alt="Untitled"><br>先看看L1～L4的网络参数量，差了好多，L1只有0.1M，而L4有9M，也就是理论上如果L1的结果我是满意的，那么模型可以被剪掉的参数达到98.8%。不过根据我们的四个数据集，L1的效果并不会那么好，因为太浅了嘛。但是其中有三个数据集显示L2的结果和L4已经非常接近了，也就是说对于这三个数据集，在测试阶段，我们不需要用9M的网络，用半M的网络足够了。<br>回想一下一开始我提出的问题，网络需要多深合适，这幅图是不是就一目了然。网络的深度和数据集的难度是有关系的，这四个数据集当中，第二个，也就是息肉分割是最难的，大家可以看到纵坐标，它代表分割的评价指标，越大越好，其他都能达到挺高的，但是唯独息肉分割只有在30左右，对于比较难的数据集，可以看到网络越深，它的分割结果是在不断上升的。对于大多数比较简单的分割问题，其实并不需要非常深，非常大的网络就可以达到很不错的精度了。<br>横坐标代表的是在测试阶段，单显卡12G的TITAN X (Pascal)下，分割一万张图需要的时间。我们可以看到不同的模型大小，测试的时间差好多。如果比较L2和L4的话，就差了三倍之多。<br><img src="/../images/Unet%E5%8F%91%E5%B1%95%E5%8E%86%E7%A8%8B%E5%92%8C%E6%80%9D%E8%B7%AF/Untitled%2021.png" alt="Untitled"><br>对于测试的速度，用这一幅图会更清晰。我们统计了用不同的模型，1秒钟可以分割多少的图。如果用L2来代替L4的话，速度确实能提升三倍。<br>剪枝应用最多的就是在移动手机端了，根据模型的参数量，如果L2得到的效果和L4相近，模型的内存可以省18倍。还是非常可观的数目。<br>关于剪枝的这部分我认为是对原先的U-Net的一个很大的改观，原来的结构过于刻板，并且没有很好的利用不用层级的特征。<br>简单的总结一下，UNet++的第一个优势就是精度的提升，这个应该它整合了不同层次的特征所带来的，第二个是灵活的网络结构配合深监督，让参数量巨大的深度网络在可接受的精度范围内大幅度的缩减参数量。  </p>
<h2 id="5-说在后面"><a href="#5-说在后面" class="headerlink" title="5. 说在后面"></a>5. 说在后面</h2><p>再次放上UNet++结构<br><img src="/../images/Unet%E5%8F%91%E5%B1%95%E5%8E%86%E7%A8%8B%E5%92%8C%E6%80%9D%E8%B7%AF/Untitled%2022.png" alt="Untitled"><br>回顾一下这次分享，就这么个分割网络，都能说这么久，要我说就放个结构图，说这个网络很牛逼，再告知一下代码在哪儿，谢谢大家就完事儿了。<br>其实搞学术做研究不是这样子的，UNet++肯定马上就会被更强的结构所代替，但是要设计出更强的结构，你得首先明白这个结构，甚至它的原型U-Net设计背后的心路历程。与其和大家分享一个苍白的分割网络，我更愿意分享的是这个项目背后从开始认识U-Net，到分析它的组成，到批判性的解读，再到改进思路的形成，实验设计，像刚刚分享过程中一次次尴尬的自问自答，中间那些非常饱满的心路历程。这也是我自己在学术生涯中学到的做研究的范式。<br>说句题外话，就跟玩狼人杀一样，你一上来就说自己预言家，验了谁谁谁，那没人信的呀，你得说清楚为什么要验他，警徽怎么留，把这些心路历程都盘盘清楚，身份才能做实。<br>其实网络结构怎么样真的不重要，重要的是你怎么能把故事给讲清楚，要是讲完以后还能够引起更多的思考和讨论那就更好了。  </p>
<h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><p><a target="_blank" rel="noopener" href="https://github.com/mrgloom/awesome-semantic-segmentation">语义分割网络代码汇总</a><br><a target="_blank" rel="noopener" href="https://github.com/handong1587/handong1587.github.io/blob/master/_posts/deep_learning/2015-10-09-segmentation.md">语义分割论文汇总</a><br><a target="_blank" rel="noopener" href="https://medium.com/@mikeliao/deep-layer-aggregation-combining-layers-in-nn-architectures-2744d29cab8">深层聚合思想</a><br><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/44958351">研习U-Net</a>  </p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/aaa/page/2/">2</a><a class="page-number" href="/aaa/page/3/">3</a><a class="extend next" rel="next" title="下一页" aria-label="下一页" href="/aaa/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">abelxiaoxing</span>
  </div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script>

  






  





</body>
</html>
