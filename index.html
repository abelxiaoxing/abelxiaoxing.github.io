<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.2">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha256-XOqroi11tY4EFQMR9ZYwZWKj5ZXiftSx36RRuC3anlA=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"abelxiaoxing.github.io","root":"/","images":"/images","scheme":"Muse","darkmode":false,"version":"8.20.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="一个个人资料记录的小地方">
<meta property="og:type" content="website">
<meta property="og:title" content="abel的小天地">
<meta property="og:url" content="https://abelxiaoxing.github.io/index.html">
<meta property="og:site_name" content="abel的小天地">
<meta property="og:description" content="一个个人资料记录的小地方">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="abelxiaoxing">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://abelxiaoxing.github.io/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>abel的小天地</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">abel的小天地</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
    </div>
  </div>
</div>







</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">abelxiaoxing</p>
  <div class="site-description" itemprop="description">一个个人资料记录的小地方</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">28</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">10</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">50</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://abelxiaoxing.github.io/2025/03/14/%E7%BB%93%E6%9E%84%E5%9B%BE%E6%B5%81%E7%A8%8B%E5%9B%BE%E5%BF%AB%E9%80%9F%E7%BB%98%E5%88%B6%E6%96%B9%E6%B3%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="abelxiaoxing">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="abel的小天地">
      <meta itemprop="description" content="一个个人资料记录的小地方">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | abel的小天地">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/03/14/%E7%BB%93%E6%9E%84%E5%9B%BE%E6%B5%81%E7%A8%8B%E5%9B%BE%E5%BF%AB%E9%80%9F%E7%BB%98%E5%88%B6%E6%96%B9%E6%B3%95/" class="post-title-link" itemprop="url">结构图/流程图快速绘制方法（Trae+Claude+DrawIO工作流）</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2025-03-14 17:04:34" itemprop="dateCreated datePublished" datetime="2025-03-14T17:04:34+08:00">2025-03-14</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-03-21 15:07:05" itemprop="dateModified" datetime="2025-03-21T15:07:05+08:00">2025-03-21</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/AI/" itemprop="url" rel="index"><span itemprop="name">AI</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/AI/%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/" itemprop="url" rel="index"><span itemprop="name">软件工具</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="🌐-工具准备清单"><a href="#🌐-工具准备清单" class="headerlink" title="🌐 工具准备清单"></a>🌐 工具准备清单</h2><ol>
<li>科学上网工具（必备）</li>
<li><a target="_blank" rel="noopener" href="https://www.trae.ai/">Trae.ai 官网</a></li>
<li><a target="_blank" rel="noopener" href="https://www.diagrams.net/">DrawIO 下载</a></li>
<li>Claude Sonnet 3.7 (可选，如果有api，则无需trae工具)</li>
</ol>
<h2 id="📌-四步高效绘制流程"><a href="#📌-四步高效绘制流程" class="headerlink" title="📌 四步高效绘制流程"></a>📌 四步高效绘制流程</h2><h3 id="步骤-1：环境准备"><a href="#步骤-1：环境准备" class="headerlink" title="步骤 1：环境准备"></a>步骤 1：环境准备</h3><ol>
<li>连接科学上网</li>
<li>访问 trae.ai 下载最新客户端</li>
<li>安装后启动软件 &gt; 点击”检查更新”获取最新版本</li>
</ol>
<h3 id="步骤-2：AI-转换处理"><a href="#步骤-2：AI-转换处理" class="headerlink" title="步骤 2：AI 转换处理"></a>步骤 2：AI 转换处理</h3><ol>
<li>将待转换内容（图片&#x2F;文字）发送至 trae build模式下，模型选择Claude sonnet 3.7</li>
<li>使用固定prompt模板：<br>请用 drawio 的 mxGraph XML 格式清晰地复刻该____流程示意图，生成后缀为drawio文件，确保:  <ul>
<li>层级结构准确</li>
<li>图形元素完整</li>
<li>连线关系明确</li>
</ul>
</li>
<li>等待生成规范的XML代码</li>
</ol>
<h3 id="步骤-3：文件创建规范"><a href="#步骤-3：文件创建规范" class="headerlink" title="步骤 3：文件创建规范"></a>步骤 3：文件创建规范</h3><ol>
<li>新建txt文本文件 &gt; 重命名为”流程图.drawio”</li>
<li>用记事本打开该文件，粘贴生成的XML代码</li>
<li>保存时选择编码格式为 UTF-8</li>
</ol>
<h3 id="步骤-4：可视化编辑"><a href="#步骤-4：可视化编辑" class="headerlink" title="步骤 4：可视化编辑"></a>步骤 4：可视化编辑</h3><ol>
<li>右键文件 &gt; 选择”Open with drawio”</li>
<li>进入图形化编辑界面后：<ul>
<li>按 Ctrl+Shift+F 格式化排版</li>
<li>使用F6快捷键调出样式面板</li>
<li>通过左侧工具栏添加新元素</li>
</ul>
</li>
</ol>
<h2 id="💡-进阶技巧"><a href="#💡-进阶技巧" class="headerlink" title="💡 进阶技巧"></a>💡 进阶技巧</h2><ul>
<li><strong>批量处理</strong>：可同时转换多个流程图组件后合并</li>
<li><strong>版本控制</strong>：建议使用Git管理.drawio文件</li>
<li><strong>云端协同</strong>：导出为XML后可直接导入GitHub&#x2F;GitLab</li>
<li><strong>样式优化</strong>：在Claude prompt中添加特定样式要求<blockquote>
<p>示例：”使用material design风格，配色方案#2E86C1&#x2F;#F4D03F”</p>
</blockquote>
</li>
</ul>
<h2 id="⚠️-常见问题排查"><a href="#⚠️-常见问题排查" class="headerlink" title="⚠️ 常见问题排查"></a>⚠️ 常见问题排查</h2><table>
<thead>
<tr>
<th>问题现象</th>
<th>解决方案</th>
</tr>
</thead>
<tbody><tr>
<td>文件打开乱码</td>
<td>检查编码格式是否为UTF-8</td>
</tr>
<tr>
<td>图形显示异常</td>
<td>验证XML头信息是否完整</td>
</tr>
<tr>
<td>连线错位</td>
<td>添加<code>&lt;mxGeometry as=&quot;geometry&quot;/&gt;</code>节点</td>
</tr>
<tr>
<td>样式丢失</td>
<td>确保<code>&lt;mxStylesheet&gt;</code>标签存在</td>
</tr>
</tbody></table>
<h2 id="🛠️-效率工具链"><a href="#🛠️-效率工具链" class="headerlink" title="🛠️ 效率工具链"></a>🛠️ 效率工具链</h2><ul>
<li><strong>Snipaste</strong>：快速截图转文字</li>
<li><strong>PowerToys</strong>：即时OCR识别</li>
<li><strong>VS Code</strong>：安装DrawIO插件实时预览</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://abelxiaoxing.github.io/2025/02/19/Linux%E5%BA%94%E7%94%A8%E4%BB%A3%E7%90%86%E8%AE%BE%E7%BD%AE%E6%8C%87%E5%8D%97/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="abelxiaoxing">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="abel的小天地">
      <meta itemprop="description" content="一个个人资料记录的小地方">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | abel的小天地">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/02/19/Linux%E5%BA%94%E7%94%A8%E4%BB%A3%E7%90%86%E8%AE%BE%E7%BD%AE%E6%8C%87%E5%8D%97/" class="post-title-link" itemprop="url">Linux应用代理设置指南</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2025-02-19 11:32:10" itemprop="dateCreated datePublished" datetime="2025-02-19T11:32:10+08:00">2025-02-19</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-03-21 15:13:45" itemprop="dateModified" datetime="2025-03-21T15:13:45+08:00">2025-03-21</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%BD%91%E7%BB%9C/" itemprop="url" rel="index"><span itemprop="name">网络</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>在使用Linux系统时，我们经常会遇到一些应用需要访问国际网络资源的情况。由于网络环境的限制，这些应用可能无法正常访问所需的资源，导致功能受限或无法启动。虽然我们可以在终端中通过设置代理环境变量来解决这个问题，但每次都需要手动设置非常繁琐。本文将介绍如何通过配置应用的启动文件来永久设置代理，使应用能够自动使用代理服务。</p>
<h2 id="配置方法"><a href="#配置方法" class="headerlink" title="配置方法"></a>配置方法</h2><h3 id="1-定位-desktop文件"><a href="#1-定位-desktop文件" class="headerlink" title="1. 定位.desktop文件"></a>1. 定位.desktop文件</h3><p>在Linux系统中，应用程序的启动配置通常存储在<code>.desktop</code>文件中。这些文件包含了应用的基本信息和启动命令。以Discord为例，其启动文件通常位于：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/share/applications/discord.desktop</span><br></pre></td></tr></table></figure>

<p>你也可以通过以下命令查找特定应用的.desktop文件：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find /usr/share/applications -name <span class="string">&quot;*.desktop&quot;</span> | grep -i <span class="string">&quot;应用名称&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="2-修改启动命令"><a href="#2-修改启动命令" class="headerlink" title="2. 修改启动命令"></a>2. 修改启动命令</h3><p>使用文本编辑器（需要root权限）打开.desktop文件：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> nvim /usr/share/applications/discord.desktop</span><br></pre></td></tr></table></figure>

<p>找到以<code>Exec=</code>开头的行，在原有命令前添加代理环境变量：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Exec=<span class="built_in">env</span> HTTP_PROXY=http://127.0.0.1:7890 HTTPS_PROXY=http://127.0.0.1:7890 /usr/bin/discord</span><br></pre></td></tr></table></figure>

<h3 id="3-常见应用示例"><a href="#3-常见应用示例" class="headerlink" title="3. 常见应用示例"></a>3. 常见应用示例</h3><p>除了Discord外，以下是一些常见应用的代理设置示例：</p>
<h4 id="Telegram"><a href="#Telegram" class="headerlink" title="Telegram"></a>Telegram</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Exec=<span class="built_in">env</span> HTTP_PROXY=http://127.0.0.1:7890 HTTPS_PROXY=http://127.0.0.1:7890 /usr/bin/telegram-desktop -- %u</span><br></pre></td></tr></table></figure>

<h2 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h2><ol>
<li>确保代理服务器地址和端口号正确，上述示例中使用的是<code>127.0.0.1:7890</code>，请根据实际情况修改</li>
<li>某些应用可能需要额外的代理设置，如<code>ALL_PROXY</code>或<code>SOCKS_PROXY</code></li>
<li>修改.desktop文件后，可能需要刷新应用程序菜单或重启系统才能生效</li>
<li>建议在修改前备份原始的.desktop文件</li>
</ol>
<h2 id="故障排除"><a href="#故障排除" class="headerlink" title="故障排除"></a>故障排除</h2><p>如果设置后应用仍然无法正常访问网络，可以尝试：</p>
<ol>
<li>验证代理服务器是否正常运行</li>
<li>检查代理地址和端口是否正确</li>
<li>尝试使用不同的代理协议（HTTP&#x2F;HTTPS&#x2F;SOCKS）</li>
<li>查看应用的日志输出，寻找可能的错误信息</li>
</ol>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul>
<li><a target="_blank" rel="noopener" href="https://wiki.archlinux.org/title/Environment_variables">Linux环境变量配置指南</a></li>
<li><a target="_blank" rel="noopener" href="https://wiki.archlinux.org/title/Proxy_server">Linux代理设置最佳实践</a></li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://abelxiaoxing.github.io/2024/12/03/Firefox%E5%9E%82%E7%9B%B4%E4%BE%A7%E8%BE%B9%E6%A0%8F%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="abelxiaoxing">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="abel的小天地">
      <meta itemprop="description" content="一个个人资料记录的小地方">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | abel的小天地">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/12/03/Firefox%E5%9E%82%E7%9B%B4%E4%BE%A7%E8%BE%B9%E6%A0%8F%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/" class="post-title-link" itemprop="url">Firefox垂直侧边栏配置指南</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-12-03 16:07:12" itemprop="dateCreated datePublished" datetime="2024-12-03T16:07:12+08:00">2024-12-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-03-21 15:09:19" itemprop="dateModified" datetime="2025-03-21T15:09:19+08:00">2025-03-21</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7/" itemprop="url" rel="index"><span itemprop="name">软件工具</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Firefox垂直侧边栏配置指南"><a href="#Firefox垂直侧边栏配置指南" class="headerlink" title="Firefox垂直侧边栏配置指南"></a>Firefox垂直侧边栏配置指南</h1><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>Firefox浏览器默认使用水平标签栏布局，而Microsoft Edge的垂直侧边栏设计因其在信息密度上的优势而广受欢迎。本文将详细介绍如何在Firefox中实现类似的垂直侧边栏效果，提升您的浏览体验。</p>
<h2 id="实现原理"><a href="#实现原理" class="headerlink" title="实现原理"></a>实现原理</h2><p>通过结合使用Sidebery扩展和自定义CSS，我们可以隐藏默认的水平标签栏，并创建一个可展开的垂直侧边栏，实现更高效的标签页管理。</p>
<h2 id="详细步骤"><a href="#详细步骤" class="headerlink" title="详细步骤"></a>详细步骤</h2><h3 id="1-安装Sidebery扩展"><a href="#1-安装Sidebery扩展" class="headerlink" title="1. 安装Sidebery扩展"></a>1. 安装Sidebery扩展</h3><p>首先，打开Firefox浏览器，访问<a target="_blank" rel="noopener" href="https://addons.mozilla.org/zh-CN/firefox/addon/sidebery">Sidebery插件页面</a>并安装该扩展。</p>
<h3 id="2-启用自定义CSS支持"><a href="#2-启用自定义CSS支持" class="headerlink" title="2. 启用自定义CSS支持"></a>2. 启用自定义CSS支持</h3><ol>
<li>在地址栏中输入<code>about:config</code></li>
<li>点击”接受风险并继续”</li>
<li>搜索以下选项并确保其值为<code>true</code>：<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">toolkit.legacyUserProfileCustomizations.stylesheets</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="3-创建并配置userChrome-css文件"><a href="#3-创建并配置userChrome-css文件" class="headerlink" title="3. 创建并配置userChrome.css文件"></a>3. 创建并配置userChrome.css文件</h3><ol>
<li>打开Firefox设置 → 浏览器帮助 → 更多排障信息 → 配置文件夹 → 打开目录</li>
<li>在打开的目录中创建<code>chrome</code>文件夹（如果不存在）</li>
<li>在<code>chrome</code>文件夹中创建<code>userChrome.css</code>文件</li>
<li>将以下代码复制到该文件中：</li>
</ol>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* #tabbrowser-tabs[orient=&quot;horizontal&quot;] &#123;</span></span><br><span class="line"><span class="comment">    visibility: collapse !important;</span></span><br><span class="line"><span class="comment">&#125; */</span></span><br><span class="line"></span><br><span class="line"><span class="selector-pseudo">:root</span> &#123;</span><br><span class="line">    <span class="comment">/* Delay before expanding tabs */</span></span><br><span class="line">    <span class="attr">--delay</span>: <span class="number">0s</span>;</span><br><span class="line">    <span class="comment">/* Time it takes for sidebar to expand. */</span></span><br><span class="line">    <span class="attr">--transition-time</span>: <span class="number">0.2s</span>;</span><br><span class="line">    <span class="comment">/* Width of expanded sidebar */</span></span><br><span class="line">    <span class="attr">--expanded-width</span>: <span class="number">250px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#TabsToolbar</span><span class="selector-pseudo">:not</span>(<span class="selector-attr">[customizing=<span class="string">&quot;true&quot;</span>]</span>) &#123;</span><br><span class="line">    <span class="attribute">visibility</span>: collapse <span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@media</span> (<span class="attribute">-moz-platform</span>: macos) &#123;</span><br><span class="line">    <span class="selector-pseudo">:root</span><span class="selector-pseudo">:not</span>(<span class="selector-attr">[customizing=<span class="string">&quot;true&quot;</span>]</span>) <span class="selector-id">#nav-bar</span><span class="selector-pseudo">:not</span>(<span class="selector-attr">[inFullscreen]</span>) &#123;</span><br><span class="line">        <span class="attribute">padding-left</span>: <span class="number">80px</span> <span class="meta">!important</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="selector-pseudo">:root</span><span class="selector-pseudo">:not</span>(<span class="selector-attr">[customizing=<span class="string">&quot;true&quot;</span>]</span>) <span class="selector-id">#TabsToolbar</span> <span class="selector-class">.titlebar-buttonbox-container</span> &#123;</span><br><span class="line">        <span class="attribute">visibility</span>: visible <span class="meta">!important</span>;</span><br><span class="line">        <span class="attribute">position</span>: absolute;</span><br><span class="line">        <span class="attribute">top</span>: <span class="number">12px</span>;</span><br><span class="line">        <span class="attribute">left</span>: <span class="number">0px</span>;</span><br><span class="line">        <span class="attribute">display</span>: block;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Linux/GTK specific styles */</span></span><br><span class="line"><span class="keyword">@media</span> (-moz-gtk-csd-available),</span><br><span class="line">(<span class="attribute">-moz-platform</span>: linux) &#123;</span><br><span class="line">    <span class="selector-class">.browser-toolbar</span><span class="selector-pseudo">:not</span>(<span class="selector-class">.titlebar-color</span>) &#123;</span><br><span class="line">        <span class="comment">/* Fixes wrong coloring applied with --toolbar-bgcolor by Firefox (#101) */</span></span><br><span class="line">        <span class="attribute">background-color</span>: transparent <span class="meta">!important</span>;</span><br><span class="line">        <span class="attribute">box-shadow</span>: none <span class="meta">!important</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="selector-id">#TabsToolbar</span><span class="selector-pseudo">:not</span>(<span class="selector-attr">[customizing=<span class="string">&quot;true&quot;</span>]</span>) &#123;</span><br><span class="line">        <span class="attribute">visibility</span>: collapse <span class="meta">!important</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="selector-id">#toolbar-menubar</span> &#123;</span><br><span class="line">        <span class="attribute">padding-top</span>: <span class="number">0px</span> <span class="meta">!important</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Fixes issue in FF 123 where minimize, close, and maximize buttons no longer work. */</span></span><br><span class="line">    <span class="selector-pseudo">:root</span><span class="selector-attr">[tabsintitlebar]</span> <span class="selector-id">#titlebar</span> &#123;</span><br><span class="line">        <span class="attribute">will-change</span>: auto <span class="meta">!important</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="selector-pseudo">:root</span><span class="selector-pseudo">:not</span>(<span class="selector-attr">[customizing=<span class="string">&quot;true&quot;</span>]</span>) <span class="selector-id">#toolbar-menubar</span><span class="selector-attr">[inactive]</span>+<span class="selector-id">#TabsToolbar</span> <span class="selector-class">.titlebar-buttonbox-container</span> &#123;</span><br><span class="line">        <span class="attribute">visibility</span>: visible <span class="meta">!important</span>;</span><br><span class="line">        <span class="attribute">position</span>: absolute;</span><br><span class="line">        <span class="attribute">top</span>: <span class="built_in">var</span>(--uc-win-ctrl-vertical-offset);</span><br><span class="line">        <span class="attribute">display</span>: block;</span><br><span class="line">        <span class="attribute">z-index</span>: <span class="number">101</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* enable rounded top corners */</span></span><br><span class="line">    <span class="selector-pseudo">:root</span><span class="selector-attr">[tabsintitlebar]</span><span class="selector-attr">[sizemode=<span class="string">&quot;normal&quot;</span>]</span><span class="selector-pseudo">:not</span>(<span class="selector-attr">[gtktiledwindow=<span class="string">&quot;true&quot;</span>]</span>)<span class="selector-pseudo">:not</span>(<span class="selector-attr">[customizing=<span class="string">&quot;true&quot;</span>]</span>) <span class="selector-id">#nav-bar</span> &#123;</span><br><span class="line">        <span class="attribute">border-top-left-radius</span>: <span class="built_in">env</span>(-moz-gtk-csd-titlebar-radius);</span><br><span class="line">        <span class="attribute">border-top-right-radius</span>: <span class="built_in">env</span>(-moz-gtk-csd-titlebar-radius);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* window control padding values (these don&#x27;t change the size of the actual buttons, only the padding for the navbar) */</span></span><br><span class="line">    <span class="selector-pseudo">:root</span><span class="selector-attr">[tabsintitlebar]</span><span class="selector-pseudo">:not</span>(<span class="selector-attr">[customizing=<span class="string">&quot;true&quot;</span>]</span>) &#123;</span><br><span class="line">        <span class="comment">/* default button/padding size based on adw-gtk3 theme */</span></span><br><span class="line">        <span class="attr">--uc-win-ctrl-btn-width</span>: <span class="number">38px</span>;</span><br><span class="line">        <span class="attr">--uc-win-ctrl-padding</span>: <span class="number">12px</span>;</span><br><span class="line">        <span class="comment">/* vertical offset from the top of the window, calculation: (1/2 * (NAVBAR_HEIGHT - BUTTON_HEIGHT)) */</span></span><br><span class="line">        <span class="attr">--uc-win-ctrl-vertical-offset</span>: <span class="number">8px</span>;</span><br><span class="line">        <span class="comment">/* extra window drag space */</span></span><br><span class="line">        <span class="attr">--uc-win-ctrl-drag-space</span>: <span class="number">20px</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="selector-pseudo">:root</span><span class="selector-attr">[tabsintitlebar]</span><span class="selector-attr">[lwtheme]</span><span class="selector-pseudo">:not</span>(<span class="selector-attr">[customizing=<span class="string">&quot;true&quot;</span>]</span>) &#123;</span><br><span class="line">        <span class="comment">/* seperate values for when using a theme, based on the Firefox defaults */</span></span><br><span class="line">        <span class="attr">--uc-win-ctrl-btn-width</span>: <span class="number">30px</span>;</span><br><span class="line">        <span class="attr">--uc-win-ctrl-padding</span>: <span class="number">12px</span>;</span><br><span class="line">        <span class="comment">/* vertical offset from the top of the window, calculation: (1/2 * (NAVBAR_HEIGHT - BUTTON_HEIGHT)) */</span></span><br><span class="line">        <span class="attr">--uc-win-ctrl-vertical-offset</span>: <span class="number">5px</span>;</span><br><span class="line">        <span class="comment">/* extra window drag space */</span></span><br><span class="line">        <span class="attr">--uc-win-ctrl-drag-space</span>: <span class="number">20px</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* setting the padding value for all button combinations */</span></span><br><span class="line">    <span class="keyword">@media</span> (-moz-gtk-csd-minimize-button),</span><br><span class="line">    (-moz-gtk-csd-maximize-button),</span><br><span class="line">    (-moz-gtk-csd-close-button) &#123;</span><br><span class="line">        <span class="selector-id">#nav-bar</span> &#123;</span><br><span class="line">            <span class="attr">--uc-navbar-padding</span>: <span class="built_in">calc</span>(<span class="built_in">var</span>(--uc-win-ctrl-btn-width) * <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">@media</span> (-moz-gtk-csd-minimize-button) <span class="keyword">and</span> (-moz-gtk-csd-maximize-button),</span><br><span class="line">    (-moz-gtk-csd-minimize-button) <span class="keyword">and</span> (-moz-gtk-csd-close-button),</span><br><span class="line">    (-moz-gtk-csd-maximize-button) <span class="keyword">and</span> (-moz-gtk-csd-close-button) &#123;</span><br><span class="line">        <span class="selector-id">#nav-bar</span> &#123;</span><br><span class="line">            <span class="attr">--uc-navbar-padding</span>: <span class="built_in">calc</span>(<span class="built_in">var</span>(--uc-win-ctrl-btn-width) * <span class="number">2</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">@media</span> (-moz-gtk-csd-minimize-button) <span class="keyword">and</span> (-moz-gtk-csd-maximize-button) <span class="keyword">and</span> (-moz-gtk-csd-close-button) &#123;</span><br><span class="line">        <span class="selector-id">#nav-bar</span> &#123;</span><br><span class="line">            <span class="attr">--uc-navbar-padding</span>: <span class="built_in">calc</span>(<span class="built_in">var</span>(--uc-win-ctrl-btn-width) * <span class="number">3</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* only applies padding/positioning if there is 1 or more buttons */</span></span><br><span class="line">    <span class="keyword">@media</span> (-moz-gtk-csd-minimize-button),</span><br><span class="line">    (-moz-gtk-csd-maximize-button),</span><br><span class="line">    (-moz-gtk-csd-close-button) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* window controls on the right */</span></span><br><span class="line">        <span class="keyword">@media</span> <span class="keyword">not</span> (-moz-gtk-csd-reversed-placement) &#123;</span><br><span class="line">            <span class="selector-id">#nav-bar</span> &#123;</span><br><span class="line">                <span class="attribute">padding-inline</span>: <span class="number">0</span> <span class="built_in">calc</span>(<span class="built_in">var</span>(--uc-navbar-padding, <span class="number">0</span>) + <span class="built_in">var</span>(--uc-win-ctrl-padding) + <span class="built_in">var</span>(--uc-win-ctrl-drag-space)) <span class="meta">!important</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="selector-class">.titlebar-buttonbox-container</span> &#123;</span><br><span class="line">                <span class="attribute">right</span>: <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* window controls on the left */</span></span><br><span class="line">        <span class="keyword">@media</span> (-moz-gtk-csd-reversed-placement) &#123;</span><br><span class="line">            <span class="selector-id">#nav-bar</span> &#123;</span><br><span class="line">                <span class="attribute">padding-inline</span>: <span class="built_in">calc</span>(<span class="built_in">var</span>(--uc-navbar-padding, <span class="number">0</span>) + <span class="built_in">var</span>(--uc-win-ctrl-padding) + <span class="built_in">var</span>(--uc-win-ctrl-drag-space)) <span class="number">0</span> <span class="meta">!important</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="selector-class">.titlebar-buttonbox-container</span> &#123;</span><br><span class="line">                <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Hide window buttons in fullscreen */</span></span><br><span class="line">    <span class="selector-id">#navigator-toolbox</span><span class="selector-attr">[style*=<span class="string">&quot;margin-top: -&quot;</span>]</span> <span class="selector-class">.titlebar-buttonbox-container</span>,</span><br><span class="line">    <span class="selector-attr">[inDOMFullscreen=<span class="string">&quot;true&quot;</span>]</span> <span class="selector-class">.titlebar-buttonbox-container</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">translateY</span>(-<span class="number">100px</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Windows specific styles */</span></span><br><span class="line"><span class="keyword">@media</span> (<span class="attribute">-moz-platform</span>: windows),</span><br><span class="line">(<span class="attribute">-moz-platform</span>: windows-win10) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Hide main tabs toolbar */</span></span><br><span class="line">    <span class="selector-pseudo">:root</span><span class="selector-attr">[tabsintitlebar]</span> &#123;</span><br><span class="line">        <span class="attr">--uc-window-control-width</span>: <span class="number">137px</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="selector-id">#nav-bar</span> &#123;</span><br><span class="line">        <span class="attribute">border-inline</span>: <span class="built_in">var</span>(--uc-window-drag-space-width, <span class="number">80px</span>) solid <span class="built_in">var</span>(--toolbar-bgcolor);</span><br><span class="line">        <span class="attribute">border-inline-style</span>: solid <span class="meta">!important</span>;</span><br><span class="line">        <span class="attribute">border-right-width</span>: <span class="built_in">calc</span>(<span class="built_in">var</span>(--uc-window-control-width, <span class="number">0px</span>) + <span class="built_in">var</span>(--uc-window-drag-space-width, <span class="number">0px</span>));</span><br><span class="line">        <span class="comment">/* This makes it possible to drag the maximized window. */</span></span><br><span class="line">        <span class="attribute">padding-top</span>: .<span class="number">5px</span> <span class="meta">!important</span>;</span><br><span class="line">        <span class="comment">/* Removes the space left when hiding .titlebar-buttonbox-container */</span></span><br><span class="line">        <span class="attribute">margin-left</span>: -<span class="number">80px</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="selector-id">#back-button</span> &#123;</span><br><span class="line">        <span class="attribute">margin-top</span>: -.<span class="number">5px</span> <span class="meta">!important</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="selector-id">#forward-button</span> &#123;</span><br><span class="line">        <span class="attribute">margin-top</span>: -.<span class="number">5px</span> <span class="meta">!important</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="selector-id">#reload-button</span> &#123;</span><br><span class="line">        <span class="attribute">margin-top</span>: -.<span class="number">5px</span> <span class="meta">!important</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="selector-id">#PanelUI-button</span> &#123;</span><br><span class="line">        <span class="attribute">margin-top</span>: -.<span class="number">5px</span> <span class="meta">!important</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="selector-id">#nav-bar-overflow-button</span> &#123;</span><br><span class="line">        <span class="attribute">margin-top</span>: -.<span class="number">5px</span> <span class="meta">!important</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="selector-pseudo">:root</span> &#123;</span><br><span class="line">        <span class="attr">--uc-toolbar-height</span>: <span class="number">32px</span>;</span><br><span class="line">        <span class="attr">--chrome-content-separator-color</span>: none <span class="meta">!important</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="selector-pseudo">:root</span><span class="selector-pseudo">:not</span>(<span class="selector-attr">[uidensity=<span class="string">&quot;compact&quot;</span>]</span>) &#123;</span><br><span class="line">        <span class="attr">--uc-toolbar-height</span>: <span class="number">38px</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="selector-id">#TabsToolbar</span> &#123;</span><br><span class="line">        <span class="attribute">visibility</span>: collapse <span class="meta">!important</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Hide the Windows controls on the left side. */</span></span><br><span class="line">    <span class="selector-id">#TabsToolbar</span> <span class="selector-class">.titlebar-buttonbox-container</span> &#123;</span><br><span class="line">        <span class="attribute">visibility</span>: hidden <span class="meta">!important</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Line up the Windows controls with the rest of the icons in the toolbar. */</span></span><br><span class="line">    <span class="selector-pseudo">:root</span><span class="selector-pseudo">:not</span>(<span class="selector-attr">[sizemode=<span class="string">&quot;maximized&quot;</span>]</span>) <span class="selector-class">.titlebar-buttonbox-container</span> &#123;</span><br><span class="line">        <span class="attribute">margin-top</span>: <span class="number">3px</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="selector-pseudo">:root</span><span class="selector-pseudo">:not</span>(<span class="selector-attr">[inFullscreen]</span>) <span class="selector-id">#nav-bar</span> &#123;</span><br><span class="line">        <span class="attribute">margin-top</span>: <span class="built_in">calc</span>(<span class="number">0px</span> - <span class="built_in">var</span>(--uc-toolbar-height));</span><br><span class="line">        <span class="attribute">z-index</span>: <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="selector-id">#toolbar-menubar</span> &#123;</span><br><span class="line">        <span class="attribute">min-height</span>: unset <span class="meta">!important</span>;</span><br><span class="line">        <span class="attribute">height</span>: <span class="built_in">var</span>(--uc-toolbar-height) <span class="meta">!important</span>;</span><br><span class="line">        <span class="attribute">position</span>: relative;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="selector-class">.titlebar-buttonbox</span> &#123;</span><br><span class="line">        <span class="attribute">z-index</span>: <span class="number">3</span> <span class="meta">!important</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="selector-class">.titlebar-buttonbox</span> * &#123;</span><br><span class="line">        <span class="attribute">width</span>: <span class="number">35px</span>;</span><br><span class="line">        <span class="attribute">height</span>: <span class="number">38px</span>;</span><br><span class="line">        <span class="attribute">pointer-events</span>: auto;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="selector-id">#titlebar</span> &#123;</span><br><span class="line">        <span class="attribute">z-index</span>: <span class="number">3</span>;</span><br><span class="line">        <span class="attribute">pointer-events</span>: none;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="selector-id">#main-menubar</span> &#123;</span><br><span class="line">        -moz-box-<span class="attribute">flex</span>: <span class="number">1</span>;</span><br><span class="line">        <span class="attribute">background-color</span>: <span class="built_in">var</span>(--toolbar-bgcolor, --toolbar-non-lwt-bgcolor);</span><br><span class="line">        <span class="attribute">background-clip</span>: padding-box;</span><br><span class="line">        <span class="attribute">border-right</span>: <span class="number">30px</span> solid transparent;</span><br><span class="line">        <span class="attribute">border-image</span>: <span class="built_in">linear-gradient</span>(to left, transparent, <span class="built_in">var</span>(--toolbar-bgcolor, --toolbar-non-lwt-bgcolor) <span class="number">30px</span>) <span class="number">20</span> / <span class="number">30px</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="selector-id">#toolbar-menubar</span><span class="selector-pseudo">:not</span>(<span class="selector-attr">[inactive]</span>) &#123;</span><br><span class="line">        <span class="attribute">z-index</span>: <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="selector-id">#toolbar-menubar</span><span class="selector-attr">[inactive]</span>&gt;<span class="selector-id">#menubar-items</span> &#123;</span><br><span class="line">        <span class="attribute">opacity</span>: <span class="number">0</span>;</span><br><span class="line">        <span class="attribute">pointer-events</span>: none;</span><br><span class="line">        <span class="attribute">margin-left</span>: <span class="built_in">var</span>(--uc-window-drag-space-width, <span class="number">0px</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="selector-pseudo">:root</span><span class="selector-attr">[inFullscreen]</span> <span class="selector-id">#nav-bar</span> &#123;</span><br><span class="line">        <span class="attribute">border-right</span>: none <span class="meta">!important</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#sidebar-box</span><span class="selector-attr">[sidebarcommand=<span class="string">&quot;_3c078156-979c-498b-8990-85f7987dd929_-sidebar-action&quot;</span>]</span> <span class="selector-id">#sidebar-header</span> &#123;</span><br><span class="line">    <span class="attribute">visibility</span>: collapse;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#sidebar-box</span><span class="selector-attr">[sidebarcommand=<span class="string">&quot;_3c078156-979c-498b-8990-85f7987dd929_-sidebar-action&quot;</span>]</span> &#123;</span><br><span class="line">    <span class="attribute">position</span>: relative;</span><br><span class="line">    <span class="attribute">min-width</span>: <span class="number">48px</span> <span class="meta">!important</span>;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">48px</span> <span class="meta">!important</span>;</span><br><span class="line">    <span class="attribute">max-width</span>: <span class="number">48px</span> <span class="meta">!important</span>;</span><br><span class="line">    <span class="attribute">z-index</span>: <span class="number">1</span>;</span><br><span class="line">    <span class="attribute">margin-top</span>: -<span class="number">1px</span>;</span><br><span class="line">    <span class="attribute">transition</span>: min-width <span class="built_in">var</span>(--transition-time) linear <span class="meta">!important</span>;</span><br><span class="line">    <span class="attribute">will-change</span>: min-width;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* positioned=true means sidebar docked to the right */</span></span><br><span class="line"><span class="selector-id">#sidebar-box</span><span class="selector-attr">[sidebarcommand=<span class="string">&quot;_3c078156-979c-498b-8990-85f7987dd929_-sidebar-action&quot;</span>]</span><span class="selector-attr">[positionend=<span class="string">&quot;true&quot;</span>]</span> &#123;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">bottom</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">right</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#browser</span><span class="selector-pseudo">:has</span>(<span class="selector-id">#sidebar-box</span><span class="selector-attr">[sidebarcommand=<span class="string">&quot;_3c078156-979c-498b-8990-85f7987dd929_-sidebar-action&quot;</span>]</span><span class="selector-attr">[positionend=<span class="string">&quot;true&quot;</span>]</span>)&gt;<span class="selector-id">#appcontent</span> &#123;</span><br><span class="line">    <span class="attribute">margin-right</span>: <span class="number">50px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#sidebar-box</span><span class="selector-attr">[sidebarcommand=<span class="string">&quot;_3c078156-979c-498b-8990-85f7987dd929_-sidebar-action&quot;</span>]</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">    <span class="attribute">min-width</span>: <span class="built_in">var</span>(--expanded-width) <span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#sidebar-box</span><span class="selector-attr">[sidebarcommand=<span class="string">&quot;_3c078156-979c-498b-8990-85f7987dd929_-sidebar-action&quot;</span>]</span>&gt;<span class="selector-id">#sidebar</span> &#123;</span><br><span class="line">    <span class="attribute">transition</span>: min-width <span class="built_in">var</span>(--transition-time) linear <span class="built_in">var</span>(--delay) <span class="meta">!important</span>;</span><br><span class="line">    <span class="attribute">will-change</span>: min-width;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#sidebar-box</span><span class="selector-attr">[sidebarcommand=<span class="string">&quot;_3c078156-979c-498b-8990-85f7987dd929_-sidebar-action&quot;</span>]</span><span class="selector-pseudo">:hover</span>&gt;<span class="selector-id">#sidebar</span> &#123;</span><br><span class="line">    <span class="attribute">min-width</span>: <span class="built_in">var</span>(--expanded-width) <span class="meta">!important</span>;</span><br><span class="line">    <span class="attribute">transition</span>: min-width <span class="built_in">var</span>(--transition-time) linear <span class="built_in">var</span>(--delay);</span><br><span class="line">    <span class="attribute">clip-path</span>: <span class="built_in">inset</span>(<span class="number">0px</span> -<span class="number">15px</span> <span class="number">0px</span> -<span class="number">15px</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#sidebar</span>,</span><br><span class="line"><span class="selector-id">#sidebar-header</span> &#123;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="built_in">var</span>(--toolbar-bgcolor) <span class="meta">!important</span>;</span><br><span class="line">    <span class="attribute">border-inline</span>: <span class="number">1px</span> solid <span class="built_in">var</span>(--chrome-content-separator-color) <span class="meta">!important</span>;</span><br><span class="line">    <span class="attribute">border-inline-width</span>: <span class="number">0px</span> <span class="number">1px</span> <span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#sidebar-box</span><span class="selector-attr">[sidebarcommand=<span class="string">&quot;_3c078156-979c-498b-8990-85f7987dd929_-sidebar-action&quot;</span>]</span><span class="selector-pseudo">:not</span>(<span class="selector-attr">[positionend]</span>)<span class="selector-pseudo">:hover</span>~<span class="selector-id">#appcontent</span> <span class="selector-id">#statuspanel</span> &#123;</span><br><span class="line">    <span class="attribute">inset-inline</span>: auto <span class="number">0px</span> <span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#sidebar-box</span><span class="selector-attr">[sidebarcommand=<span class="string">&quot;_3c078156-979c-498b-8990-85f7987dd929_-sidebar-action&quot;</span>]</span><span class="selector-pseudo">:not</span>(<span class="selector-attr">[positionend]</span>)<span class="selector-pseudo">:hover</span>~<span class="selector-id">#appcontent</span> <span class="selector-id">#statuspanel-label</span> &#123;</span><br><span class="line">    <span class="attribute">margin-inline</span>: <span class="number">0px</span> <span class="meta">!important</span>;</span><br><span class="line">    <span class="attribute">border-left-style</span>: solid <span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="4-配置sidebery拓展配置"><a href="#4-配置sidebery拓展配置" class="headerlink" title="4. 配置sidebery拓展配置"></a>4. 配置sidebery拓展配置</h3><ul>
<li>打开sidebery的设置 → 点击样式编辑器,复制以下代码：<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line"> <span class="selector-id">#root</span><span class="selector-class">.root</span> &#123;</span><br><span class="line">    <span class="attr">--tabs-font</span>: <span class="number">10pt</span> sans-serif;</span><br><span class="line">    <span class="attr">--tabs-count-font</span>: .<span class="number">625rem</span> Segoe UI;</span><br><span class="line">    <span class="attr">--bookmarks-bookmark-font</span>: .<span class="number">875rem</span> Segoe UI;</span><br><span class="line">    <span class="attr">--bookmarks-folder-font</span>: <span class="number">9pt</span> Segoe UI;</span><br><span class="line">    <span class="attr">--nav-btn-width</span>: <span class="number">42px</span>;</span><br><span class="line">    <span class="attr">--nav-btn-height</span>: <span class="number">42px</span>;</span><br><span class="line">    <span class="attr">--tabs-height</span>: <span class="number">40px</span>;</span><br><span class="line">    <span class="attr">--tabs-inner-gap</span>: <span class="number">11px</span>;</span><br><span class="line">    <span class="attr">--tabs-pinned-width</span>: <span class="number">42px</span>;</span><br><span class="line">    <span class="attr">--tabs-pinned-height</span>: <span class="number">42px</span>;</span><br><span class="line">    <span class="attr">--search-height</span>: <span class="number">36px</span>;</span><br><span class="line">    <span class="attr">--search-icon-width</span>: <span class="number">42px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@media</span> (<span class="attribute">prefers-color-scheme</span>:light) &#123;</span><br><span class="line">    <span class="selector-id">#root</span> &#123;</span><br><span class="line">        <span class="attr">--tabs-activated-bg</span>: white <span class="meta">!important</span>;</span><br><span class="line">        <span class="attr">--tabs-bg-active</span>: <span class="built_in">var</span>(--tabs-activated-bg) <span class="meta">!important</span>;</span><br><span class="line">        <span class="attr">--tabs-selected-fg</span>: <span class="built_in">var</span>(--tabs-activated-fg) <span class="meta">!important</span>;</span><br><span class="line">        <span class="attr">--tabs-selected-bg</span>: <span class="built_in">var</span>(--tabs-activated-bg) <span class="meta">!important</span>;</span><br><span class="line">        <span class="attr">--bg</span>: <span class="number">#f9f9fb</span> <span class="meta">!important</span>;</span><br><span class="line">        <span class="attr">--badge-bg</span>: <span class="built_in">rgb</span>(<span class="number">255</span> <span class="number">255</span> <span class="number">255</span> / <span class="number">0.85</span>);</span><br><span class="line">        <span class="attr">--border</span>: <span class="number">#606060</span> <span class="meta">!important</span>;</span><br><span class="line">        <span class="attr">--ctx-menu-separator</span>: <span class="built_in">rgb</span>(<span class="number">204</span> <span class="number">204</span> <span class="number">204</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">@media</span> (<span class="attribute">prefers-color-scheme</span>:dark) &#123;</span><br><span class="line">    <span class="selector-id">#root</span> &#123;</span><br><span class="line">        <span class="attr">--tabs-activated-bg</span>: <span class="number">#42414d</span> <span class="meta">!important</span>;</span><br><span class="line">        <span class="attr">--tabs-bg-active</span>: <span class="built_in">var</span>(--tabs-activated-bg) <span class="meta">!important</span>;</span><br><span class="line">        <span class="attr">--tabs-selected-fg</span>: <span class="built_in">var</span>(--tabs-activated-fg) <span class="meta">!important</span>;</span><br><span class="line">        <span class="attr">--tabs-selected-bg</span>: <span class="built_in">var</span>(--tabs-activated-bg) <span class="meta">!important</span>;</span><br><span class="line">        <span class="attr">--bg</span>: <span class="number">#2b2a33</span> <span class="meta">!important</span>;</span><br><span class="line">        <span class="attr">--badge-bg</span>: <span class="built_in">rgb</span>(<span class="number">30</span> <span class="number">30</span> <span class="number">30</span> / <span class="number">0.85</span>);</span><br><span class="line">        <span class="attr">--border</span>: <span class="number">#c0c0c0</span> <span class="meta">!important</span>;</span><br><span class="line">        <span class="attr">--ctx-menu-separator</span>: <span class="built_in">rgb</span>(<span class="number">51</span> <span class="number">51</span> <span class="number">62</span>);</span><br><span class="line">        <span class="attr">--tabs-bg-hover</span>: <span class="built_in">rgb</span>(<span class="number">51</span> <span class="number">51</span> <span class="number">62</span>) <span class="meta">!important</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.NavigationBar</span> &#123;</span><br><span class="line">    <span class="attribute">background</span>: transparent;</span><br><span class="line">    <span class="attribute">border-bottom</span>: <span class="number">1px</span> solid <span class="built_in">var</span>(--ctx-menu-separator);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.NavigationBar</span><span class="selector-attr">[data-layout=<span class="string">&quot;wrap&quot;</span>]</span> <span class="selector-class">.main-items</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    <span class="attribute">justify-content</span>: center;</span><br><span class="line">    <span class="attribute">border</span>: <span class="number">1px</span> solid red;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.NavigationBar</span><span class="selector-attr">[data-layout=<span class="string">&quot;inline&quot;</span>]</span> <span class="selector-class">.main-items</span> <span class="selector-class">.nav-item</span><span class="selector-attr">[data-index=<span class="string">&quot;-1&quot;</span>]</span><span class="selector-attr">[data-active=<span class="string">&quot;true&quot;</span>]</span> &#123;</span><br><span class="line">    <span class="attribute">opacity</span>: <span class="number">1</span>;</span><br><span class="line">    <span class="attribute">z-index</span>: <span class="number">100</span>;</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">scale</span>(<span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.NavigationBar</span> <span class="selector-class">.static-btns</span> &#123;</span><br><span class="line">    <span class="attribute">transition</span>: opacity <span class="number">0.5s</span> linear;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#root</span><span class="selector-pseudo">:not</span>(<span class="selector-pseudo">:hover</span>) <span class="selector-class">.NavigationBar</span><span class="selector-attr">[data-layout=<span class="string">&quot;inline&quot;</span>]</span> <span class="selector-class">.static-btns</span> &#123;</span><br><span class="line">    <span class="attribute">opacity</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">z-index</span>: -<span class="number">1</span>;</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">scale</span>(<span class="number">0</span>, <span class="number">0</span>);;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#root</span><span class="selector-pseudo">:not</span>(<span class="selector-pseudo">:hover</span>) <span class="selector-class">.TabsPanel</span> &#123;</span><br><span class="line">    <span class="attr">--tabs-indent</span>: <span class="number">0px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#root</span><span class="selector-pseudo">:not</span>(<span class="selector-pseudo">:hover</span>)<span class="selector-attr">[data-tabs-tree-lvl-marks=<span class="string">&quot;true&quot;</span>]</span> <span class="selector-class">.Tab</span><span class="selector-attr">[data-pin=<span class="string">&quot;false&quot;</span>]</span><span class="selector-pseudo">:not</span>(<span class="selector-attr">[data-lvl=<span class="string">&quot;0&quot;</span>]</span>) <span class="selector-class">.body</span><span class="selector-pseudo">:after</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: none;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.Tab</span> <span class="selector-class">.close</span> &#123;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">0</span> <span class="number">5px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.Tab</span> <span class="selector-class">.audio</span> &#123;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">top</span>: unset <span class="meta">!important</span>;</span><br><span class="line">    <span class="attribute">bottom</span>: -<span class="number">2px</span>;</span><br><span class="line">    <span class="attribute">right</span>: -<span class="number">2px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">16px</span> <span class="meta">!important</span>;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">16px</span> <span class="meta">!important</span>;</span><br><span class="line">    <span class="attribute">background</span>: <span class="built_in">var</span>(--badge-bg);</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">3px</span>;</span><br><span class="line">    <span class="attribute">box-shadow</span>: <span class="built_in">var</span>(--nav-btn-active-shadow);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.Tab</span> <span class="selector-class">.t-box</span> &#123;</span><br><span class="line">    <span class="attr">--audio-btn-offset</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#root</span><span class="selector-pseudo">:not</span>(<span class="selector-pseudo">:hover</span>) <span class="selector-class">.SearchBar</span><span class="selector-pseudo">::before</span> &#123;</span><br><span class="line">    <span class="attribute">background</span>: transparent;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#root</span><span class="selector-pseudo">:not</span>(<span class="selector-pseudo">:hover</span>) <span class="selector-class">.SearchBar</span> <span class="selector-class">.placeholder</span>,</span><br><span class="line"><span class="selector-id">#root</span><span class="selector-pseudo">:not</span>(<span class="selector-pseudo">:hover</span>) <span class="selector-class">.SearchBar</span> <span class="selector-class">.input</span> &#123;</span><br><span class="line">    <span class="attribute">opacity</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#root</span><span class="selector-pseudo">:not</span>(<span class="selector-pseudo">:hover</span>) <span class="selector-class">.SearchBar</span> <span class="selector-class">.clear-btn</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: none;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#root</span><span class="selector-pseudo">:not</span>(<span class="selector-pseudo">:hover</span>) <span class="selector-class">.PanelPlaceholder</span> &#123;</span><br><span class="line">    <span class="attribute">writing-mode</span>: vertical-rl;</span><br><span class="line">    <span class="attribute">text-orientation</span>: mixed;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.BottomBar</span> <span class="selector-class">.tool-btn</span> &#123;</span><br><span class="line">    <span class="attribute">min-width</span>: <span class="built_in">var</span>(--tabs-pinned-width);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="5-重启浏览器"><a href="#5-重启浏览器" class="headerlink" title="5. 重启浏览器"></a>5. 重启浏览器</h3><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ol>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_55349490/article/details/140774366">火狐浏览器firefox垂直标签页</a></li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://abelxiaoxing.github.io/2024/11/15/KVM%E5%A4%9A%E6%98%BE%E5%8D%A1%E7%9B%B4%E9%80%9A%E6%8C%87%E5%8D%97/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="abelxiaoxing">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="abel的小天地">
      <meta itemprop="description" content="一个个人资料记录的小地方">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | abel的小天地">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/11/15/KVM%E5%A4%9A%E6%98%BE%E5%8D%A1%E7%9B%B4%E9%80%9A%E6%8C%87%E5%8D%97/" class="post-title-link" itemprop="url">KVM多显卡直通指南</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-11-15 21:31:22" itemprop="dateCreated datePublished" datetime="2024-11-15T21:31:22+08:00">2024-11-15</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-03-21 15:11:58" itemprop="dateModified" datetime="2025-03-21T15:11:58+08:00">2025-03-21</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="KVM多显卡直通完全指南"><a href="#KVM多显卡直通完全指南" class="headerlink" title="KVM多显卡直通完全指南"></a>KVM多显卡直通完全指南</h1><p>在虚拟化环境中，将物理显卡直接分配给虚拟机（即显卡直通）是提升虚拟机图形性能的重要手段。本文将详细介绍如何在Linux系统中实现KVM多显卡直通，特别适用于需要在虚拟机中获得接近原生性能的用户。</p>
<h2 id="前提条件"><a href="#前提条件" class="headerlink" title="前提条件"></a>前提条件</h2><ul>
<li>支持虚拟化的CPU（大多数现代CPU都支持）</li>
<li>支持IOMMU的主板（Intel VT-d或AMD-Vi）</li>
<li>至少一张可用于直通的独立显卡</li>
<li>运行Linux的宿主机系统</li>
</ul>
<h2 id="详细步骤"><a href="#详细步骤" class="headerlink" title="详细步骤"></a>详细步骤</h2><h3 id="1-启用BIOS中的虚拟化功能"><a href="#1-启用BIOS中的虚拟化功能" class="headerlink" title="1. 启用BIOS中的虚拟化功能"></a>1. 启用BIOS中的虚拟化功能</h3><p>首先需要在主板BIOS中启用虚拟化功能。根据不同的主板和CPU，这个选项可能被称为：</p>
<ul>
<li>Intel系统：VT-x和VT-d</li>
<li>AMD系统：AMD-V和AMD-Vi</li>
</ul>
<blockquote>
<p>注意：部分老旧CPU可能不支持这些功能</p>
</blockquote>
<h3 id="2-在宿主机系统中启用IOMMU组"><a href="#2-在宿主机系统中启用IOMMU组" class="headerlink" title="2. 在宿主机系统中启用IOMMU组"></a>2. 在宿主机系统中启用IOMMU组</h3><p>IOMMU（Input&#x2F;Output Memory Management Unit）是实现设备直通的关键技术。我们需要在Linux系统中启用它：</p>
<ol>
<li>打开GRUB配置文件：</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> nano /etc/default/grub</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>找到<code>GRUB_CMDLINE_LINUX_DEFAULT</code>行，修改为：</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GRUB_CMDLINE_LINUX_DEFAULT=&quot;quiet splash intel_iommu=on&quot;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意：如果使用AMD处理器，请使用<code>amd_iommu=on</code>替代<code>intel_iommu=on</code></p>
</blockquote>
<ol start="3">
<li>更新GRUB配置：</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Arch Linux</span></span><br><span class="line"><span class="built_in">sudo</span> grub-mkconfig -o /boot/grub/grub.cfg</span><br><span class="line"></span><br><span class="line"><span class="comment"># Ubuntu</span></span><br><span class="line"><span class="built_in">sudo</span> update-grub</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>重启系统后，验证IOMMU是否正确启用：</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dmesg | grep -i iommu</span><br></pre></td></tr></table></figure>

<p>如果看到类似<code>pci xxxx:xx:xx.x: Adding to iommu group xx</code>的输出，说明IOMMU已成功启用。</p>
<blockquote>
<p><strong>重要说明</strong>：系统中的所有设备只能按照IOMMU组为单位分配给宿主机或虚拟机。如果两个不相关的设备在同一个组内，它们必须一起分配。Linux系统不支持预留IOMMU组，因此我们需要阻止Linux内核在启动时初始化特定组内的硬件。</p>
</blockquote>
<h3 id="3-寻找需要预留的IOMMU组"><a href="#3-寻找需要预留的IOMMU组" class="headerlink" title="3. 寻找需要预留的IOMMU组"></a>3. 寻找需要预留的IOMMU组</h3><ol>
<li>首先确认显卡所在的PCIe总线和产品型号：</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lspci -nnv | grep -i nvidia</span><br></pre></td></tr></table></figure>

<p>输出示例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">01:00.0 VGA compatible controller [0300]: NVIDIA Corporation Device [10de:2203] (rev a1) (prog-if 00 [VGA controller])</span><br><span class="line">        Kernel driver in use: nvidia</span><br><span class="line">        Kernel modules: nvidiafb, nouveau, nvidia_drm, nvidia</span><br><span class="line">01:00.1 Audio device [0403]: NVIDIA Corporation GA102 High Definition Audio Controller [10de:1aef] (rev a1)</span><br><span class="line">05:00.0 VGA compatible controller [0300]: NVIDIA Corporation Device [10de:2203] (rev a1) (prog-if 00 [VGA controller])</span><br><span class="line">        Kernel modules: nvidiafb, nouveau, nvidia_drm, nvidia</span><br><span class="line">05:00.1 Audio device [0403]: NVIDIA Corporation GA102 High Definition Audio Controller [10de:1aef] (rev a1)</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>解读PCI设备信息</strong>：</p>
<ul>
<li><code>01:00.0</code>和<code>01:00.1</code>等编号通过冒号分为三部分：PCIe的domain ID、bus ID和device id.function id</li>
<li><code>[0300]</code>是设备类型编号，不同类型设备（网络、存储、显卡等）有不同编号</li>
<li><code>[10de:2203]</code>中，<code>10de</code>是NVIDIA的厂商ID，<code>2203</code>表示这是一个3090Ti显卡</li>
</ul>
</blockquote>
<ol start="2">
<li>找出设备所在的IOMMU组：</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> dmesg | grep iommu | grep 01:00.0</span><br><span class="line"><span class="built_in">sudo</span> dmesg | grep iommu | grep 05:00.0</span><br></pre></td></tr></table></figure>

<p>输出示例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[    0.536462] pci 0000:01:00.0: Adding to iommu group 17</span><br><span class="line">[    0.536491] pci 0000:05:00.0: Adding to iommu group 20</span><br></pre></td></tr></table></figure>


<ol start="3">
<li>确认IOMMU组中的所有设备：</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> dmesg | grep <span class="string">&quot;iommu group 17&quot;</span></span><br></pre></td></tr></table></figure>

<p>输出示例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[    0.536462] pci 0000:01:00.0: Adding to iommu group 17</span><br><span class="line">[    0.536467] pci 0000:01:00.1: Adding to iommu group 17</span><br></pre></td></tr></table></figure>

<h3 id="4-屏蔽显卡驱动"><a href="#4-屏蔽显卡驱动" class="headerlink" title="4. 屏蔽显卡驱动"></a>4. 屏蔽显卡驱动</h3><p>有两种方法可以屏蔽显卡，使其不被宿主机系统使用：</p>
<h4 id="方法一：型号屏蔽法"><a href="#方法一：型号屏蔽法" class="headerlink" title="方法一：型号屏蔽法"></a>方法一：型号屏蔽法</h4><p>适用于只有一张显卡或多张显卡ID不同的情况：</p>
<ol>
<li>修改GRUB配置：</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> nvim /etc/default/grub</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>在<code>GRUB_CMDLINE_LINUX_DEFAULT</code>中添加设备ID：</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 使用pci-stub方法</span><br><span class="line">GRUB_CMDLINE_LINUX_DEFAULT=&quot;quiet splash intel_iommu=on pci-stub.ids=10de:2203,10de:1aef&quot;</span><br><span class="line"></span><br><span class="line"># 或使用vfio-pci方法</span><br><span class="line">GRUB_CMDLINE_LINUX_DEFAULT=&quot;quiet splash intel_iommu=on vfio-pci.ids=10de:2203,10de:1aef&quot;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>更新GRUB并重启：</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Arch Linux</span></span><br><span class="line"><span class="built_in">sudo</span> grub-mkconfig -o /boot/grub/grub.cfg</span><br><span class="line"></span><br><span class="line"><span class="comment"># Ubuntu</span></span><br><span class="line"><span class="built_in">sudo</span> update-grub</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>验证屏蔽是否成功：</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lspci -nnv | grep -E <span class="string">&quot;(^\S|Kernel driver in use)&quot;</span> | grep 01:00 -A 1</span><br></pre></td></tr></table></figure>

<p>成功屏蔽后的输出：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">01:00.0 VGA compatible controller [0300]: NVIDIA Corporation Device [10de:2203] (rev a1) (prog-if 00 [VGA controller])</span><br><span class="line">        Kernel driver in use: vfio-pci</span><br><span class="line">01:00.1 Audio device [0403]: NVIDIA Corporation GA102 High Definition Audio Controller [10de:1aef] (rev a1)</span><br><span class="line">        Kernel driver in use: vfio-pci</span><br></pre></td></tr></table></figure>

<h4 id="方法二：脚本屏蔽法"><a href="#方法二：脚本屏蔽法" class="headerlink" title="方法二：脚本屏蔽法"></a>方法二：脚本屏蔽法</h4><p>适用于多张相同型号显卡的情况：</p>
<ol>
<li>创建VFIO脚本：</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> nano /etc/initramfs-tools/scripts/init-top/vfio.sh</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>添加以下内容：</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;vfio-pci&quot;</span> &gt; /sys/bus/pci/devices/0000:01:00.0/driver_override</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;vfio-pci&quot;</span> &gt; /sys/bus/pci/devices/0000:01:00.1/driver_override</span><br><span class="line"><span class="comment">#echo &quot;0000:01:00.0&quot; &gt; /sys/bus/pci/drivers/vfio-pci/bind # 这里我没有加这个绑定，有人加了这两句，但我注释了，因为本地找不到这个文件夹</span></span><br><span class="line"><span class="comment">#echo &quot;0000:01:00.1&quot; &gt; /sys/bus/pci/drivers/vfio-pci/bind # 可选，需要modprobe -i vfio-pci后才有此文件夹，但不加也能正常工作</span></span><br><span class="line"><span class="built_in">exit</span> 0</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>给脚本添加执行权限：</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> <span class="built_in">chmod</span> 744 /etc/initramfs-tools/scripts/init-top/vfio.sh</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>更新initramfs：</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> update-initramfs -u -k all</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>重启系统后验证显卡驱动是否被vfio-pci接管</li>
</ol>
<blockquote>
<p><strong>恢复显卡挂载</strong>：如需恢复显卡使用，只需注释掉脚本中的两行echo命令，刷新initramfs并重启即可。</p>
</blockquote>
<h3 id="5-在KVM中使用直通显卡"><a href="#5-在KVM中使用直通显卡" class="headerlink" title="5. 在KVM中使用直通显卡"></a>5. 在KVM中使用直通显卡</h3><p>完成以上步骤后，您可以在KVM虚拟机配置中添加PCI设备，选择已屏蔽的显卡，即可实现显卡直通。</p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul>
<li><a target="_blank" rel="noopener" href="https://wiki.archlinux.org/title/PCI_passthrough_via_OVMF">KVM PCI passthrough on Arch Linux Wiki</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/ahmclishihao/article/details/132679686">NVIDIA显卡直通详解</a></li>
<li><a target="_blank" rel="noopener" href="https://www.kernel.org/doc/Documentation/vfio.txt">VFIO驱动官方文档</a></li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://abelxiaoxing.github.io/2024/10/24/%E8%BF%9C%E7%A8%8B%E6%A1%8C%E9%9D%A2%E4%B8%8ESamba%E6%96%87%E4%BB%B6%E4%BC%A0%E8%BE%93%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="abelxiaoxing">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="abel的小天地">
      <meta itemprop="description" content="一个个人资料记录的小地方">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | abel的小天地">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/10/24/%E8%BF%9C%E7%A8%8B%E6%A1%8C%E9%9D%A2%E4%B8%8ESamba%E6%96%87%E4%BB%B6%E4%BC%A0%E8%BE%93%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/" class="post-title-link" itemprop="url">远程桌面与Samba文件传输配置指南</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-10-24 14:19:42" itemprop="dateCreated datePublished" datetime="2024-10-24T14:19:42+08:00">2024-10-24</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-03-21 15:06:07" itemprop="dateModified" datetime="2025-03-21T15:06:07+08:00">2025-03-21</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%BD%91%E7%BB%9C/" itemprop="url" rel="index"><span itemprop="name">网络</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="远程桌面与Samba文件传输配置指南"><a href="#远程桌面与Samba文件传输配置指南" class="headerlink" title="远程桌面与Samba文件传输配置指南"></a>远程桌面与Samba文件传输配置指南</h1><p>本文介绍如何通过RDP远程桌面和Samba文件共享服务实现远程控制和文件传输，特别适用于需要通过公网访问内网设备的场景。</p>
<h2 id="一、RDP远程桌面配置"><a href="#一、RDP远程桌面配置" class="headerlink" title="一、RDP远程桌面配置"></a>一、RDP远程桌面配置</h2><h3 id="1-服务器端配置"><a href="#1-服务器端配置" class="headerlink" title="1. 服务器端配置"></a>1. 服务器端配置</h3><ol>
<li><p><strong>配置frp服务</strong>：在需要远程的服务器端配置frp服务，将内网服务映射到公网IP（具体frp服务器配置略）</p>
</li>
<li><p><strong>开启Windows远程桌面</strong>：</p>
<ul>
<li>点击系统属性 → 远程</li>
<li>勾选「允许远程连接到此计算机」</li>
<li>此时Windows的RDP服务已开启，默认端口号为3389</li>
</ul>
</li>
<li><p><strong>配置frpc客户端</strong>：在frpc.ini中新增以下内容，将本地3389端口映射到公网IP</p>
</li>
</ol>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[win_rdp]</span></span><br><span class="line"><span class="attr">type</span> = tcp</span><br><span class="line"><span class="attr">local_ip</span> = <span class="number">127.0</span>.<span class="number">0.1</span></span><br><span class="line"><span class="attr">local_port</span> = <span class="number">3389</span></span><br><span class="line"><span class="attr">remote_port</span> = <span class="number">13389</span>  <span class="comment"># 可以为任意端口号，自行定义</span></span><br></pre></td></tr></table></figure>

<h3 id="2-客户端连接"><a href="#2-客户端连接" class="headerlink" title="2. 客户端连接"></a>2. 客户端连接</h3><ul>
<li><strong>Linux客户端</strong>：使用krdc，勾选RDP协议，通过<code>xxx.xxx.xxx.xxx:13389</code>进行远程访问</li>
<li><strong>Windows客户端</strong>：打开远程桌面连接，通过<code>xxx.xxx.xxx.xxx:13389</code>进行远程访问</li>
</ul>
<h2 id="二、Samba文件传输配置"><a href="#二、Samba文件传输配置" class="headerlink" title="二、Samba文件传输配置"></a>二、Samba文件传输配置</h2><h3 id="1-服务器端配置-1"><a href="#1-服务器端配置-1" class="headerlink" title="1. 服务器端配置"></a>1. 服务器端配置</h3><h4 id="Windows服务器"><a href="#Windows服务器" class="headerlink" title="Windows服务器"></a>Windows服务器</h4><ol>
<li><p><strong>创建共享文件夹</strong>：</p>
<ul>
<li>在需要共享的文件夹上右键 → 属性 → 共享</li>
<li>点击「高级共享」，勾选「共享此文件夹」</li>
<li>设置「共享名」（建议使用简短易记的名称）</li>
<li>点击「权限」设置访问权限</li>
</ul>
</li>
<li><p><strong>设置访问权限</strong>：</p>
<ul>
<li>在「权限」对话框中，可以添加或删除用户&#x2F;组</li>
<li>为每个用户&#x2F;组设置适当的权限（完全控制、修改、读取等）</li>
<li>如需允许匿名访问，添加「Everyone」组并设置相应权限</li>
<li>点击「应用」和「确定」保存设置</li>
</ul>
</li>
<li><p><strong>配置网络发现和文件共享</strong>：</p>
<ul>
<li>打开「控制面板」→「网络和共享中心」</li>
<li>点击左侧的「更改高级共享设置」</li>
<li>确保以下选项已启用：<ul>
<li>网络发现</li>
<li>文件和打印机共享</li>
<li>密码保护共享（根据需求开启或关闭）</li>
</ul>
</li>
<li>点击「保存更改」</li>
</ul>
</li>
<li><p><strong>配置Windows防火墙</strong>：</p>
<ul>
<li>打开「控制面板」→「Windows Defender 防火墙」</li>
<li>点击左侧的「允许应用或功能通过Windows Defender 防火墙」</li>
<li>确保「文件和打印机共享」已勾选（私有网络和公用网络根据需求选择）</li>
<li>点击「确定」保存设置</li>
</ul>
</li>
<li><p><strong>创建共享用户（可选）</strong>：</p>
<ul>
<li>打开「计算机管理」（右键「此电脑」→「管理」）</li>
<li>展开「系统工具」→「本地用户和组」→「用户」</li>
<li>右键空白处 → 「新用户」</li>
<li>填写用户名、密码等信息，根据需求设置密码永不过期</li>
<li>创建用户后，将其添加到相应的用户组（如「Users」组）</li>
</ul>
</li>
<li><p><strong>将Samba服务的默认端口445映射到公网IP</strong>：在frpc.ini中新增：</p>
</li>
</ol>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[win_samba]</span></span><br><span class="line"><span class="attr">type</span> = tcp</span><br><span class="line"><span class="attr">local_ip</span> = <span class="number">127.0</span>.<span class="number">0.1</span></span><br><span class="line"><span class="attr">local_port</span> = <span class="number">445</span>  <span class="comment"># Samba默认端口</span></span><br><span class="line"><span class="attr">remote_port</span> = <span class="number">10445</span>  <span class="comment"># 可以为任意端口号，自行定义</span></span><br></pre></td></tr></table></figure>

<h4 id="Linux服务器-Arch-Linux"><a href="#Linux服务器-Arch-Linux" class="headerlink" title="Linux服务器 (Arch Linux)"></a>Linux服务器 (Arch Linux)</h4><ol>
<li><p><strong>安装Samba</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">paru -S samba</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>创建配置文件</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> nvim /etc/samba/smb.conf</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>配置共享文件夹</strong>：</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[homes]</span>  <span class="comment"># 文件夹名称</span></span><br><span class="line">   <span class="attr">comment</span> = Home Directories  <span class="comment"># 注释</span></span><br><span class="line">   <span class="attr">path</span> = /home/smb_user/  <span class="comment"># 共享的路径</span></span><br><span class="line">   <span class="attr">browseable</span> = <span class="literal">yes</span>  <span class="comment"># 是否显示文件夹</span></span><br><span class="line">   <span class="attr">writable</span> = <span class="literal">yes</span>  <span class="comment"># 是否可写</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>创建Samba日志文件夹</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> <span class="built_in">mkdir</span> -p /usr/local/samba/var/</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>添加Samba访问用户并设置密码</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> smbpasswd -a smb_user  <span class="comment"># smb_user为你自己设置的用户名</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>启动服务</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> systemctl <span class="built_in">enable</span> --now smb.service nmb.service</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>配置frpc客户端</strong>：将本地445端口映射到公网IP，在frpc.ini中新增：</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[linux_samba]</span></span><br><span class="line"><span class="attr">type</span> = tcp</span><br><span class="line"><span class="attr">local_ip</span> = <span class="number">127.0</span>.<span class="number">0.1</span></span><br><span class="line"><span class="attr">local_port</span> = <span class="number">445</span></span><br><span class="line"><span class="attr">remote_port</span> = <span class="number">10445</span>  <span class="comment"># 可以为任意端口号，自行定义</span></span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="2-客户端访问配置"><a href="#2-客户端访问配置" class="headerlink" title="2. 客户端访问配置"></a>2. 客户端访问配置</h3><h4 id="Linux客户端"><a href="#Linux客户端" class="headerlink" title="Linux客户端"></a>Linux客户端</h4><p>使用dolphin文件管理器，在地址栏输入以下内容（xxx.xxx.xxx.xxx为服务器公网IP）：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">smb://用户名@xxx.xxx.xxx.xxx:10445/</span><br></pre></td></tr></table></figure>

<h4 id="Windows客户端"><a href="#Windows客户端" class="headerlink" title="Windows客户端"></a>Windows客户端</h4><ol>
<li><p><strong>配置端口转发</strong>：以管理员身份打开CMD，输入以下命令（xxx.xxx.xxx.xxx为服务器公网IP）：</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netsh interface portproxy add v4tov4 listenport=<span class="number">445</span> listenaddress=<span class="number">127</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">1</span> connectport=<span class="number">10445</span> connectaddress=xxx.xxx.xxx.xxx</span><br></pre></td></tr></table></figure>
<p>此命令的效果是：本机访问127.0.0.1的445端口时，会转发到远程IP地址的10445端口</p>
</li>
<li><p><strong>查看端口转发配置</strong>：</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netsh interface portproxy show all</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>禁用Server服务</strong>：</p>
<ul>
<li>打开系统服务管理器</li>
<li>找到「Server」服务</li>
<li>右键属性 → 启动类型改为「禁用」</li>
<li>重启电脑</li>
<li>再次查看服务状态，确认服务未运行</li>
</ul>
</li>
<li><p><strong>访问远程共享</strong>：在Windows资源管理器地址栏中输入：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">\\127.0.0.1\</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="3-Windows-10客户端额外配置"><a href="#3-Windows-10客户端额外配置" class="headerlink" title="3. Windows 10客户端额外配置"></a>3. Windows 10客户端额外配置</h3><p>在Windows 11系统中，微软加强了网络安全策略，导致文件共享可能无法正常工作。以下是解决方案：</p>
<ol>
<li><p><strong>启用必要的Windows功能</strong>：</p>
<ul>
<li>打开「启用或关闭Windows功能」</li>
<li>勾选「NFS服务」和「SMB1.0&#x2F;CIFS文件支持」</li>
<li>重启电脑</li>
</ul>
</li>
<li><p><strong>修改组策略安全设置</strong>：</p>
<ul>
<li>按Windows+R组合键，输入「gpedit.msc」打开组策略编辑器</li>
<li>导航至「计算机配置」→「Windows设置」→「安全设置」→「本地策略」→「安全选项」</li>
<li>找到「Microsoft网络客户端：对通讯进行数字签名（始终）」，设置为「已禁用」</li>
<li>如需将本机作为共享服务器，还需将「Microsoft网络服务器：对通讯进行数字签名（始终）」设置为「已禁用」</li>
</ul>
</li>
<li><p><strong>启用不安全的来宾登录</strong>：</p>
<ul>
<li>导航至「计算机配置」→「管理模板」→「网络」→「Lanman工作站」</li>
<li>找到「启用不安全的来宾登录」，设置为「已启用」</li>
<li>完成设置后建议重启电脑并重新设置共享文件夹</li>
</ul>
</li>
</ol>
<h4 id="家庭版用户配置"><a href="#家庭版用户配置" class="headerlink" title="家庭版用户配置"></a>家庭版用户配置</h4><p>由于Windows 11家庭版没有组策略编辑器，可通过以下方法添加此功能：<br><strong>安装组策略编辑器</strong>：</p>
<ul>
<li>在桌面新建文本文档，粘贴以下内容：   <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">@echo off</span><br><span class="line">pushd &quot;%~dp0&quot;</span><br><span class="line">dir /b C:\Windows\servicing\Packages\Microsoft-Windows-GroupPolicy-ClientExtensions-Package~3*.mum &gt;List.txt</span><br><span class="line">dir /b C:\Windows\servicing\Packages\Microsoft-Windows-GroupPolicy-ClientTools-Package~3*.mum &gt;&gt;List.txt</span><br><span class="line">for /f %%i in (&#x27;findstr /i . List.txt 2^&gt;nul&#x27;) do dism /online /norestart /add-package:&quot;C:\Windows\servicing\Packages\%%i&quot;</span><br><span class="line">pause</span><br></pre></td></tr></table></figure></li>
<li>将文件后缀名从.txt改为.bat</li>
<li>右键选择「以管理员身份运行」</li>
<li>运行完成后重启电脑（系统会显示正在更新）</li>
</ul>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ol>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_43514847/article/details/133009479">CSDN - 远程桌面和Samba配置</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_36953067/article/details/136443544">CSDN - 解决共享文件夹访问权限问题</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/m0_61434477/article/details/120106909">已解决：Win10无法访问Samba共享文件夹</a></li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://abelxiaoxing.github.io/2024/10/23/ARM%E8%AE%BE%E5%A4%87%E9%85%8D%E7%BD%AELunarVim%E5%AE%8C%E5%85%A8%E6%8C%87%E5%8D%97/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="abelxiaoxing">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="abel的小天地">
      <meta itemprop="description" content="一个个人资料记录的小地方">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | abel的小天地">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/10/23/ARM%E8%AE%BE%E5%A4%87%E9%85%8D%E7%BD%AELunarVim%E5%AE%8C%E5%85%A8%E6%8C%87%E5%8D%97/" class="post-title-link" itemprop="url">ARM设备配置LunarVim完全指南</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-10-23 13:37:05" itemprop="dateCreated datePublished" datetime="2024-10-23T13:37:05+08:00">2024-10-23</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-03-21 15:08:26" itemprop="dateModified" datetime="2025-03-21T15:08:26+08:00">2025-03-21</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="ARM设备配置LunarVim完全指南"><a href="#ARM设备配置LunarVim完全指南" class="headerlink" title="ARM设备配置LunarVim完全指南"></a>ARM设备配置LunarVim完全指南</h1><h2 id="为什么选择Neovim和LunarVim？"><a href="#为什么选择Neovim和LunarVim？" class="headerlink" title="为什么选择Neovim和LunarVim？"></a>为什么选择Neovim和LunarVim？</h2><p>Neovim作为Vim的现代化分支，近年来在开发者社区中备受关注。相比传统的Vim，Neovim不仅性能更优，而且通过Lua脚本语言的配置方式，为用户提供了更灵活、更强大的定制能力。</p>
<p>然而，对于Neovim新手来说，从零开始配置可能会面临以下挑战：</p>
<ul>
<li>需要了解Lua语法</li>
<li>配置过程繁琐耗时</li>
<li>插件选择和配置复杂</li>
</ul>
<p>这时，用别人整合好的配置就成为了一个理想的选择。<a target="_blank" rel="noopener" href="https://www.lunarvim.org/">LunarVim</a>它是一个精心打造的Neovim配置框架，能让你的编辑器立即具备IDE级别的功能，特别适合在Linux服务器环境中使用。</p>
<h2 id="Neovim的安装方式"><a href="#Neovim的安装方式" class="headerlink" title="Neovim的安装方式"></a>Neovim的安装方式</h2><p>在ARM架构的设备上安装Neovim，我们有以下几种方式可选：</p>
<h3 id="1-包管理器安装（适用于x86架构）"><a href="#1-包管理器安装（适用于x86架构）" class="headerlink" title="1. 包管理器安装（适用于x86架构）"></a>1. 包管理器安装（适用于x86架构）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Debian/Ubuntu系统</span></span><br><span class="line"><span class="built_in">sudo</span> apt install neovim</span><br><span class="line"></span><br><span class="line"><span class="comment"># Arch Linux系统</span></span><br><span class="line"><span class="built_in">sudo</span> pacman -S neovim</span><br><span class="line"></span><br><span class="line"><span class="comment"># macOS（需要Homebrew）</span></span><br><span class="line">brew install neovim</span><br></pre></td></tr></table></figure>

<p>注意：通过包管理器安装的版本可能较旧，就需要下载软件包安装或者手动编译安装了。</p>
<h3 id="2-预编译包安装（不支持ARM架构）"><a href="#2-预编译包安装（不支持ARM架构）" class="headerlink" title="2. 预编译包安装（不支持ARM架构）"></a>2. 预编译包安装（不支持ARM架构）</h3><p>对于x86架构的设备，可以直接下载官方预编译包：<br><a target="_blank" rel="noopener" href="https://github.com/neovim/neovim/releases">Neovim发布地址</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> dpkg -i nvim-linux64.deb</span><br></pre></td></tr></table></figure>

<h3 id="3-源码编译安装（推荐ARM设备使用）"><a href="#3-源码编译安装（推荐ARM设备使用）" class="headerlink" title="3. 源码编译安装（推荐ARM设备使用）"></a>3. 源码编译安装（推荐ARM设备使用）</h3><p>在ARM架构设备（如树莓派、AidLux等）上，编译安装是最可靠的方式：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. 克隆源码</span></span><br><span class="line">git <span class="built_in">clone</span> https://github.com/neovim/neovim</span><br><span class="line"><span class="built_in">cd</span> neovim</span><br><span class="line">git checkout stable</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 编译</span></span><br><span class="line">make CMAKE_BUILD_TYPE=RelWithDebInfo</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 安装</span></span><br><span class="line"><span class="built_in">sudo</span> make install</span><br></pre></td></tr></table></figure>

<p>如需卸载，可在源码目录执行：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> cmake --build build/ --target uninstall</span><br></pre></td></tr></table></figure>

<h2 id="LunarVim的安装与配置"><a href="#LunarVim的安装与配置" class="headerlink" title="LunarVim的安装与配置"></a>LunarVim的安装与配置</h2><h3 id="文件结构"><a href="#文件结构" class="headerlink" title="文件结构"></a>文件结构</h3><p>LunarVim采用模块化的配置结构，主要文件位置如下：</p>
<ul>
<li><code>$HOME/.config/lvim</code>：个性化配置文件</li>
<li><code>$HOME/.local/bin/lvim</code>：可执行文件</li>
<li><code>$HOME/.cache/lvim</code>：缓存目录</li>
<li><code>$HOME/.config/lvim.old</code>：配置备份（如有）</li>
</ul>
<h3 id="安装步骤"><a href="#安装步骤" class="headerlink" title="安装步骤"></a>安装步骤</h3><ol>
<li><p>安装LunarVim（需要科学上网）：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LV_BRANCH=<span class="string">&#x27;release-1.2/neovim-0.8&#x27;</span> bash &lt;(curl -s https://raw.githubusercontent.com/lunarvim/lunarvim/master/utils/installer/install.sh)</span><br></pre></td></tr></table></figure>
</li>
<li><p>配置环境变量：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;export PATH=\$PATH:\$HOME/.local/bin&quot;</span> &gt;&gt; ~/.zshrc</span><br><span class="line"><span class="built_in">source</span> ~/.zshrc</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="卸载方法"><a href="#卸载方法" class="headerlink" title="卸载方法"></a>卸载方法</h3><p>如需完全卸载LunarVim：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">rm</span> -rf ~/.config/lvim ~/.local/share/lunarvim ~/.local/bin/lvim ~/.config/lvim.old</span><br></pre></td></tr></table></figure>

<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ol>
<li><a target="_blank" rel="noopener" href="https://www.lunarvim.org/docs/installation">LunarVim官方文档</a></li>
<li><a target="_blank" rel="noopener" href="https://neovim.io/doc/">Neovim官方文档</a></li>
<li><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1hR4y1Y7CS">Bilibili教程视频</a></li>
<li><a target="_blank" rel="noopener" href="https://www.mintimate.cn/2023/01/10/guideForLunarvim">Mintimate的LunarVim教程</a></li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://abelxiaoxing.github.io/2024/10/12/Shizuku%E5%92%8CLSPatch%E9%85%8D%E7%BD%AE%E6%95%99%E7%A8%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="abelxiaoxing">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="abel的小天地">
      <meta itemprop="description" content="一个个人资料记录的小地方">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | abel的小天地">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/10/12/Shizuku%E5%92%8CLSPatch%E9%85%8D%E7%BD%AE%E6%95%99%E7%A8%8B/" class="post-title-link" itemprop="url">Shizuku和LSPatch配置教程</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-10-12 17:13:00" itemprop="dateCreated datePublished" datetime="2024-10-12T17:13:00+08:00">2024-10-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-03-21 15:14:59" itemprop="dateModified" datetime="2025-03-21T15:14:59+08:00">2025-03-21</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Android/" itemprop="url" rel="index"><span itemprop="name">Android</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>本教程将指导您如何在不需要Root权限和Magisk的情况下，通过Shizuku和LSPatch来安装和使用Xposed模块。这种方法适用于大多数Android设备，无需复杂的系统修改。</p>
<h2 id="一、安装-Shizuku"><a href="#一、安装-Shizuku" class="headerlink" title="一、安装 Shizuku"></a>一、安装 Shizuku</h2><p>Shizuku是一个为应用提供系统API调用能力的工具，它可以在免Root环境下运行。</p>
<h3 id="资源链接"><a href="#资源链接" class="headerlink" title="资源链接"></a>资源链接</h3><ul>
<li><strong>官方网站</strong>：<a target="_blank" rel="noopener" href="https://shizuku.rikka.app/zh-hans">Shizuku官网</a></li>
<li><strong>下载地址</strong>：<a target="_blank" rel="noopener" href="https://github.com/RikkaApps/Shizuku/releases/latest">GitHub最新版本</a></li>
<li><strong>官方使用手册</strong>：<a target="_blank" rel="noopener" href="https://shizuku.rikka.app/zh-hans/guide/setup/#%E9%80%9A%E8%BF%87%E6%97%A0%E7%BA%BF%E8%B0%83%E8%AF%95%E5%90%AF%E5%8A%A8">设置指南</a></li>
</ul>
<h3 id="安装步骤"><a href="#安装步骤" class="headerlink" title="安装步骤"></a>安装步骤</h3><ol>
<li><p><strong>开启开发者模式</strong></p>
<ul>
<li>进入设置 → 关于手机 → 连续点击「版本号」7次以上，直到提示已开启开发者模式</li>
</ul>
</li>
<li><p><strong>配置开发者选项</strong></p>
<ul>
<li>返回设置 → 其他设置 → 开发者选项</li>
<li>打开「无线调试」选项</li>
<li>如果使用ColorOS系统，还需要额外打开「禁止权限监控」和「USB调试」选项</li>
</ul>
</li>
<li><p><strong>配对设备</strong></p>
<ul>
<li>启动Shizuku应用</li>
<li>点击应用中的「配对」按钮</li>
<li>在系统的「无线调试」设置中使用配对码配对设备</li>
<li>在通知栏中输入配对码完成配对</li>
</ul>
</li>
<li><p><strong>启动Shizuku服务</strong></p>
<ul>
<li>配对成功后，Shizuku会自动启动</li>
<li>确认Shizuku状态显示为「已启动」</li>
</ul>
</li>
</ol>
<blockquote>
<p><strong>注意</strong>：每次重启设备后，需要重新启动Shizuku服务。</p>
</blockquote>
<h2 id="二、安装LSPatch"><a href="#二、安装LSPatch" class="headerlink" title="二、安装LSPatch"></a>二、安装LSPatch</h2><p>LSPatch是一个可以在免Root环境下使用Xposed模块的工具，它通过修补应用实现功能注入。</p>
<h3 id="资源链接-1"><a href="#资源链接-1" class="headerlink" title="资源链接"></a>资源链接</h3><ul>
<li><strong>下载地址</strong>：<a target="_blank" rel="noopener" href="https://github.com/LSPosed/LSPatch/releases/download/v0.6/manager-v0.6-398-release.apk">LSPatch最新版本</a></li>
</ul>
<h3 id="安装步骤-1"><a href="#安装步骤-1" class="headerlink" title="安装步骤"></a>安装步骤</h3><ol>
<li><p><strong>下载并安装LSPatch应用</strong></p>
</li>
<li><p><strong>授权LSPatch使用Shizuku</strong></p>
<ul>
<li>打开Shizuku应用</li>
<li>进入「授权应用管理」</li>
<li>找到LSPatch并开启其权限<br> <img src="/../images/Shizuku%E5%92%8CLSPatch%E9%85%8D%E7%BD%AE%E6%95%99%E7%A8%8B/%E5%BA%94%E7%94%A8%E7%AE%A1%E7%90%86.png" alt="应用管理"></li>
</ul>
</li>
<li><p><strong>启动LSPatch</strong></p>
<ul>
<li>确保Shizuku服务正在运行</li>
<li>打开LSPatch应用，此时应该能够正常使用<br> <img src="/../images/Shizuku%E5%92%8CLSPatch%E9%85%8D%E7%BD%AE%E6%95%99%E7%A8%8B/LSPatch.png" alt="LSPatch.png"><blockquote>
<p><strong>提示</strong>：如果LSPatch无法正常启动，请检查Shizuku服务状态和授权设置。</p>
</blockquote>
</li>
</ul>
</li>
</ol>
<h2 id="三、安装Xposed模块"><a href="#三、安装Xposed模块" class="headerlink" title="三、安装Xposed模块"></a>三、安装Xposed模块</h2><p>通过LSPatch，您可以安装和使用各种Xposed模块，而无需Root权限。</p>
<h3 id="资源链接-2"><a href="#资源链接-2" class="headerlink" title="资源链接"></a>资源链接</h3><ul>
<li><strong>模块下载</strong>：<a target="_blank" rel="noopener" href="https://github.com/orgs/Xposed-Modules-Repo/repositories">Xposed模块仓库</a></li>
</ul>
<h3 id="安装方式"><a href="#安装方式" class="headerlink" title="安装方式"></a>安装方式</h3><p>LSPatch提供两种模式来安装模块：</p>
<ol>
<li><p><strong>本地模式</strong></p>
<ul>
<li><strong>优点</strong>：可以灵活修改插件配置</li>
<li><strong>缺点</strong>：必须要LSPatch后端运行才能使用</li>
<li><strong>适用场景</strong>：个人使用，需要频繁调整模块设置</li>
</ul>
</li>
<li><p><strong>集成模式</strong></p>
<ul>
<li><strong>优点</strong>：修补后的应用可以分享给其他用户使用，无需对方安装LSPatch</li>
<li><strong>缺点</strong>：每次安装新模块时必须重新修补应用</li>
<li><strong>适用场景</strong>：分享给他人使用，或在不方便运行LSPatch的环境中使用</li>
</ul>
</li>
</ol>
<h3 id="使用步骤"><a href="#使用步骤" class="headerlink" title="使用步骤"></a>使用步骤</h3><ol>
<li><p><strong>下载所需的Xposed模块APK文件</strong></p>
</li>
<li><p><strong>在LSPatch中选择修补模式</strong></p>
<ul>
<li>打开LSPatch应用</li>
<li>选择「修补新应用」</li>
<li>选择要修补的应用</li>
<li>选择修补模式（本地或集成）</li>
<li>选择要应用的Xposed模块</li>
<li>开始修补过程</li>
</ul>
</li>
<li><p><strong>安装修补后的应用</strong></p>
<ul>
<li>修补完成后，安装生成的新APK文件</li>
<li>卸载原应用（如果有）</li>
<li>启动修补后的应用</li>
</ul>
</li>
</ol>
<blockquote>
<p><strong>注意</strong>：某些应用可能无法成功修补，或修补后功能异常，这取决于应用的保护机制和模块的兼容性。</p>
</blockquote>
<h2 id="常见问题解答"><a href="#常见问题解答" class="headerlink" title="常见问题解答"></a>常见问题解答</h2><ol>
<li><p><strong>Shizuku服务无法启动怎么办？</strong></p>
<ul>
<li>检查开发者选项是否正确开启</li>
<li>确认无线调试功能已启用</li>
<li>尝试重启设备后重新配置</li>
</ul>
</li>
<li><p><strong>LSPatch修补应用失败？</strong></p>
<ul>
<li>确保Shizuku服务正常运行</li>
<li>检查应用是否有特殊保护机制</li>
<li>尝试使用不同版本的应用</li>
</ul>
</li>
<li><p><strong>修补后的应用闪退？</strong></p>
<ul>
<li>可能是模块与应用不兼容</li>
<li>尝试不同的修补模式</li>
<li>检查是否有模块更新版本</li>
</ul>
</li>
</ol>
<hr>
<p>希望本教程能帮助您成功安装和使用Shizuku、LSPatch以及各种Xposed模块。如有任何问题，请参考各项目的官方文档或社区讨论。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://abelxiaoxing.github.io/2024/08/09/%E6%98%87%E8%85%BECANN%E6%A8%A1%E5%9E%8B%E8%BD%AC%E6%8D%A2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="abelxiaoxing">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="abel的小天地">
      <meta itemprop="description" content="一个个人资料记录的小地方">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | abel的小天地">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/08/09/%E6%98%87%E8%85%BECANN%E6%A8%A1%E5%9E%8B%E8%BD%AC%E6%8D%A2/" class="post-title-link" itemprop="url">昇腾CANN模型转换实践指南</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-08-09 14:20:26" itemprop="dateCreated datePublished" datetime="2024-08-09T14:20:26+08:00">2024-08-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-03-21 15:05:23" itemprop="dateModified" datetime="2025-03-21T15:05:23+08:00">2025-03-21</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/AI/" itemprop="url" rel="index"><span itemprop="name">AI</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="一、开发环境配置"><a href="#一、开发环境配置" class="headerlink" title="一、开发环境配置"></a>一、开发环境配置</h2><h3 id="1-系统准备"><a href="#1-系统准备" class="headerlink" title="1. 系统准备"></a>1. 系统准备</h3><ul>
<li><strong>推荐系统</strong>: Ubuntu 20.04 LTS</li>
<li><strong>换源配置</strong>:<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/apt/sources.list</span><br></pre></td></tr></table></figure>
替换为阿里云镜像源：<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">deb http://mirrors.aliyun.com/ubuntu/ bionic main restricted universe multiverse</span><br><span class="line">deb-src http://mirrors.aliyun.com/ubuntu/ bionic main restricted universe multiverse</span><br><span class="line"></span><br><span class="line">deb http://mirrors.aliyun.com/ubuntu/ bionic-security main restricted universe multiverse</span><br><span class="line">deb-src http://mirrors.aliyun.com/ubuntu/ bionic-security main restricted universe multiverse</span><br><span class="line"></span><br><span class="line">deb http://mirrors.aliyun.com/ubuntu/ bionic-updates main restricted universe multiverse</span><br><span class="line">deb-src http://mirrors.aliyun.com/ubuntu/ bionic-updates main restricted universe multiverse</span><br><span class="line"></span><br><span class="line">deb http://mirrors.aliyun.com/ubuntu/ bionic-proposed main restricted universe multiverse</span><br><span class="line">deb-src http://mirrors.aliyun.com/ubuntu/ bionic-proposed main restricted universe multiverse</span><br><span class="line"></span><br><span class="line">deb http://mirrors.aliyun.com/ubuntu/ bionic-backports main restricted universe multiverse</span><br><span class="line">deb-src http://mirrors.aliyun.com/ubuntu/ bionic-backports main restricted universe multiverse</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="2-安装基础依赖"><a href="#2-安装基础依赖" class="headerlink" title="2. 安装基础依赖"></a>2. 安装基础依赖</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo apt update &amp;&amp; sudo apt upgrade -y</span><br><span class="line">sudo apt-get install -y gcc g++ make cmake zlib1g zlib1g-dev openssl libsqlite3-dev libssl-dev libffi-dev </span><br><span class="line">sudo apt-get install -y unzip pciutils net-tools libblas-dev gfortran libblas3 libopenblas-dev libncursesw5-dev</span><br></pre></td></tr></table></figure>

<h3 id="3-Python环境配置"><a href="#3-Python环境配置" class="headerlink" title="3. Python环境配置"></a>3. Python环境配置</h3><ul>
<li><strong>安装Miniconda</strong>:<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh</span><br><span class="line">bash Miniconda3-latest-Linux-x86_64.sh -b -u -p $HOME/miniconda3</span><br></pre></td></tr></table></figure></li>
<li><strong>创建专用环境</strong>:<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">conda create -n cann python=3.9</span><br><span class="line">conda activate cann</span><br><span class="line">pip3 install --upgrade pip</span><br><span class="line">pip install attrs numpy==1.17.2 decorator sympy cffi pyyaml pathlib2 psutil protobuf scipy requests onnx</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="二、CANN-Toolkit安装"><a href="#二、CANN-Toolkit安装" class="headerlink" title="二、CANN Toolkit安装"></a>二、CANN Toolkit安装</h2><h3 id="1-工具包获取"><a href="#1-工具包获取" class="headerlink" title="1. 工具包获取"></a>1. 工具包获取</h3><ul>
<li>官方渠道：<a target="_blank" rel="noopener" href="https://www.hiascend.com/zh/developer/download/community/result?module=cann">华为昇腾社区</a></li>
<li>备用资源（x86架构）：<br>链接: <a target="_blank" rel="noopener" href="https://pan.baidu.com/s/1XcSjmIDuwMz7I_bx2E4-uA?pwd=abel">Ascend-cann-toolkit_8.0.RC3.alpha001_linux-x86_64.run</a><br>提取码: abel  </li>
<li>备用资源（aarch64架构）：<br>链接: <a target="_blank" rel="noopener" href="https://pan.baidu.com/s/1IG0vPiG9uhqPV_S110hdFA?pwd=abel">Ascend-cann-toolkit_8.0.RC3.alpha001_linux-aarch64.run</a><br>提取码: abel</li>
</ul>
<h3 id="2-安装步骤"><a href="#2-安装步骤" class="headerlink" title="2. 安装步骤"></a>2. 安装步骤</h3><p>在终端输入以下命令</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chmod +x Ascend-cann-toolkit_8.0.RC3.alpha001_linux-x86_64.run</span><br><span class="line">./Ascend-cann-toolkit_8.0.RC3.alpha001_linux-x86_64.run --install</span><br></pre></td></tr></table></figure>

<h3 id="3-环境配置"><a href="#3-环境配置" class="headerlink" title="3. 环境配置"></a>3. 环境配置</h3><p>对于Atlas 200 AI加速模块 （RC场景）和Atlas 500 小站(运行环境aarch64架构)来说，当开发环境是一台X86 PC进行环境搭建时，需要在开发环境中安装交叉编译工具 </p>
<ul>
<li><p><strong>安装交叉编译工具</strong>:</p>
 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install g++-aarch64-linux-gnu</span><br></pre></td></tr></table></figure></li>
<li><p><strong>解决共享库问题</strong>:<br>上述安装过程中若出现报错：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">libascend_hal.so: cannot open shared object file: No such……</span><br></pre></td></tr></table></figure>
<p>进入到Ascend目录下输入</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo find ./ -name libascend_hal.so  # 查找库路径</span><br><span class="line">sudo cp &#123;找到的路径&#125; /usr/local/lib/  # 拷贝库到共享库目录</span><br></pre></td></tr></table></figure>
<p>进入“&#x2F;etc&#x2F;ld.so.conf”,并将<code>include /usr/local/lib</code>添加至文件最后一行后，终端输入以下命令</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ldconfig # 更新共享库缓存</span><br><span class="line">sudo ldconfig # 更新系统缓存</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>添加环境变量</strong>:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;source ~/Ascend/ascend-toolkit/set_env.sh&quot; &gt;&gt; ~/.zshrc</span><br><span class="line">source ~/.zshrc</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="三、模型转换流程"><a href="#三、模型转换流程" class="headerlink" title="三、模型转换流程"></a>三、模型转换流程</h2><h3 id="1-ONNX模型验证"><a href="#1-ONNX模型验证" class="headerlink" title="1. ONNX模型验证"></a>1. ONNX模型验证</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> onnx</span><br><span class="line">model = onnx.load(<span class="string">&#x27;model.onnx&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;输入节点:&quot;</span>, [<span class="built_in">input</span>.name <span class="keyword">for</span> <span class="built_in">input</span> <span class="keyword">in</span> model.graph.<span class="built_in">input</span>])</span><br></pre></td></tr></table></figure>
<p>若此处输出”inputxxxx”，因此于–input_shape中，填入的模型名称为”inputxxxx”</p>
<h3 id="2-atc本地转换（开发环境）"><a href="#2-atc本地转换（开发环境）" class="headerlink" title="2. atc本地转换（开发环境）"></a>2. atc本地转换（开发环境）</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">atc --model=model.onnx \</span><br><span class="line">    --framework=5 \</span><br><span class="line">    --output=model \</span><br><span class="line">    --soc_version=Ascend310B1 \</span><br><span class="line">    --input_shape=&quot;inputxxxx:1,3,224,224&quot;</span><br></pre></td></tr></table></figure>

<h2 id="四、昇腾开发板部署"><a href="#四、昇腾开发板部署" class="headerlink" title="四、昇腾开发板部署"></a>四、昇腾开发板部署</h2><h3 id="1-文件传输"><a href="#1-文件传输" class="headerlink" title="1. 文件传输"></a>1. 文件传输</h3><p>将onnx文件传输到昇腾开发板上  </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scp ./model.onnx root@10.0.0.1:/pytroch</span><br></pre></td></tr></table></figure>

<h3 id="2-板端模型转换"><a href="#2-板端模型转换" class="headerlink" title="2. 板端模型转换"></a>2. 板端模型转换</h3><p>使用ATC工具将onnx转化为om，我这里的昇腾型号是Ascend310B1  </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">atc --model=./model.onnx --framework=5 --output=/root --soc_version=Ascend310B1</span><br></pre></td></tr></table></figure>

<h3 id="3-转换验证"><a href="#3-转换验证" class="headerlink" title="3. 转换验证"></a>3. 转换验证</h3><p>成功输出示例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ATC run success</span><br></pre></td></tr></table></figure>

<h2 id="常见问题排查"><a href="#常见问题排查" class="headerlink" title="常见问题排查"></a>常见问题排查</h2><ol>
<li><p><strong>库文件缺失</strong>:</p>
<ul>
<li>现象：<code>libascend_hal.so: cannot open shared object file:No such……</code></li>
<li>解决：检查环境变量配置，确认<code>LD_LIBRARY_PATH</code>包含库路径</li>
</ul>
</li>
<li><p><strong>输入形状不匹配</strong>:</p>
<ul>
<li>现象：<code>Input shape mismatch</code></li>
<li>解决：使用Netron工具可视化模型，确认输入节点名称和维度</li>
</ul>
</li>
<li><p><strong>算子不支持</strong>:</p>
<ul>
<li>现象：<code>Unsupported op type: XXX</code></li>
<li>解决：查阅<a target="_blank" rel="noopener" href="https://www.hiascend.com/document/detail/zh/CANNCommunityEdition">CANN算子清单</a>，考虑自定义算子或模型结构调整</li>
</ul>
</li>
</ol>
<h2 id="附录：参考资源"><a href="#附录：参考资源" class="headerlink" title="附录：参考资源"></a>附录：参考资源</h2><ol>
<li><a target="_blank" rel="noopener" href="https://www.hiascend.com/document/detail/zh/CANNCommunityEdition">CANN官方文档</a></li>
<li><a target="_blank" rel="noopener" href="https://www.hiascend.com/document/detail/zh/CANNCommunityEdition/700alpha003/infacldevg/atctool/atlasatc_16_0039.html">ATC工具参数详解</a></li>
<li><a target="_blank" rel="noopener" href="https://bbs.huaweicloud.com/forum/forum-726-1.html">昇腾开发者论坛</a></li>
</ol>
<pre><code>
</code></pre>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://abelxiaoxing.github.io/2024/07/23/Unet%E5%8F%91%E5%B1%95%E5%8E%86%E7%A8%8B%E5%92%8C%E6%80%9D%E8%B7%AF/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="abelxiaoxing">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="abel的小天地">
      <meta itemprop="description" content="一个个人资料记录的小地方">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | abel的小天地">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/07/23/Unet%E5%8F%91%E5%B1%95%E5%8E%86%E7%A8%8B%E5%92%8C%E6%80%9D%E8%B7%AF/" class="post-title-link" itemprop="url">Unet发展历程和思路</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-07-23 03:24:49" itemprop="dateCreated datePublished" datetime="2024-07-23T03:24:49+08:00">2024-07-23</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-03-21 15:15:04" itemprop="dateModified" datetime="2025-03-21T15:15:04+08:00">2025-03-21</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/AI/" itemprop="url" rel="index"><span itemprop="name">AI</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="1-铺垫"><a href="#1-铺垫" class="headerlink" title="1. 铺垫"></a>1. 铺垫</h2><p>在计算机视觉领域，全卷积网络（FCN）是比较有名的图像分割网络，医学图像处理方向，U-Net可以说是一个更加炙手可热的网络，基本上所有的分割问题，我们都会拿U-Net先看一下基本的结果，然后进行“魔改”。<br><img src="/../images/Unet%E5%8F%91%E5%B1%95%E5%8E%86%E7%A8%8B%E5%92%8C%E6%80%9D%E8%B7%AF/U-Net%E7%BB%93%E6%9E%84%E5%9B%BE.png" alt="U-Net结构图"><br>U-Net和FCN非常的相似，U-Net比FCN稍晚提出来，但都发表在2015年，和FCN相比，U-Net的第一个特点是完全对称，也就是左边和右边是很类似的，而FCN的decoder相对简单，只用了一个deconvolution的操作，之后并没有跟上卷积结构。第二个区别就是skip connection，FCN用的是加操作（summation），U-Net用的是叠操作（concatenation）。这些都是细节，重点是它们的结构用了一个比较经典的思路，也就是编码和解码（encoder-decoder），早在2006年就被Hinton大神提出来发表在了nature上。<br>当时这个结构提出的主要作用并不是分割，而是压缩图像和去噪声。输入是一幅图，经过下采样的编码，得到一串比原先图像更小的特征，相当于压缩，然后再经过一个解码，理想状况就是能还原到原来的图像。这样的话我们存一幅图的时候就只需要存一个特征和一个解码器即可。这个想法我个人认为是很漂亮了。同理，这个思路也可以用在原图像去噪，做法就是在训练的阶段在原图人为的加上噪声，然后放到这个编码解码器中，目标是可以还原得到原图。<br>后来把这个思路被用在了图像分割的问题上，也就是现在我们看到的U-Net结构，在它被提出的三年中，有很多很多的论文去讲如何改进U-Net或者FCN，不过这个分割网络的本质的拓扑结构是没有改动的。举例来说，去年ICCV上凯明大神提出的Mask RCNN. 相当于一个检测，分类，分割的集大成者，我们仔细去看它的分割部分，其实使用的也就是这个简单的FCN结构。说明了这种“U形”的编码解码结构确实非常的简洁，并且最关键的一点是好用。<br>简单的过一下这个网红结构，我们先提取出它的拓扑结构，这样会比较容易分析它的实质，排除很多细节的干扰。<br>输入是一幅图，输出是目标的分割结果。继续简化就是，一幅图，编码，或者说降采样，然后解码，也就是升采样，然后输出一个分割结果。根据结果和真实分割的差异，反向传播来训练这个分割网络。我们可以说，U-Net里面最精彩的部分就是这三部分：</p>
<ul>
<li>下采样</li>
<li>上采样</li>
<li>skip connection<br>这就是在我眼中的大部分分割网络的拓扑结构。<br><img src="/../images/Unet%E5%8F%91%E5%B1%95%E5%8E%86%E7%A8%8B%E5%92%8C%E6%80%9D%E8%B7%AF/skip%20connection.png" alt="skip connection"></li>
</ul>
<h2 id="2-展开"><a href="#2-展开" class="headerlink" title="2. 展开"></a>2. 展开</h2><p>基本的铺垫都已经完成了，看着这个拓扑结构，一个非常广义的问题就是：<br><span style="color:red;"><strong>这个三年不动的拓扑结构真的一点儿毛病都没有吗？</strong></span><br>在这三年中，U-Net得到的超过2500次的引用，FCN接近6000次的引用，大家都在做什么样的改进呢？如果让你在这个经典的结构基础上改进，你会去关注哪些点呢？<br>首先一个问题是：<span style="color:red;"><strong>要多深合适？</strong> </span><br>这里我想强调的一点是，很多论文给出了他们建议的网络结构，其中包括非常多的细节，比如用什么卷积，用几层，怎么降采样，学习率多少，优化器用什么，这些都是比较直观的参数，其实这些在论文中给出参数并不见得是最好的，所以关注这些的意义不大，一个网络结构，我们真正值得关注的是它的设计传达了什么信息。就拿U-Net来说，原论文给出的结构是原图经过四次降采样，四次上采样，得到分割结果，实际呢，为什么四次？就是作者喜欢呗，或者说当时作者使用的数据集，四次降采样的效果好，我们也可以更再专业一点，四次降采样的接受域或者感受野大小正合适处理图像。或者四次降采样比较适合输入图像的尺寸等等，理由一堆，但是你们真的相信吗？不见得吧。<br>我先给一个2017年在CVPR上发表的一个名叫<a href="https://link.zhihu.com/?target=https://arxiv.org/abs/1612.01105">PSPNet</a>的分割网络，你会发现，好像整体的架构和U-Net还是像的，只是降采样的数目减小了，当然，他们也针对性的增强了中间的特征抓取环节的复杂性。  </p>
<p><img src="/../images/Unet%E5%8F%91%E5%B1%95%E5%8E%86%E7%A8%8B%E5%92%8C%E6%80%9D%E8%B7%AF/PSPNet.png" alt="PSPNet"><br>要是你觉得这个工作还不够说明4次降采样不是必须的话，我们再来看看Yoshua Bengio组最近的关于图像分割的论文，这是他们提出的结构，名叫<a href="https://link.zhihu.com/?target=https://arxiv.org/abs/1611.09326">提拉米苏</a>。  </p>
<p><img src="/../images/Unet%E5%8F%91%E5%B1%95%E5%8E%86%E7%A8%8B%E5%92%8C%E6%80%9D%E8%B7%AF/%E6%8F%90%E6%8B%89%E7%B1%B3%E8%8B%8F.png" alt="提拉米苏"><br>也是U形结构，但你会发现，他们就只用了三次降采样。所以到底要多深，是不是越深越好？还是一个open quesion。<br>我想分享的第一个信息就是：关注论文所传递的大方向，不要被论文中的细节局限了创造力。像这种细节参数的调整是属于比较朴素的深度学习方法论，很容易花费你很多时间，而最终并没有自身科研水平的提升。<br>好，我们回来继续讨论到底需要多深的问题。其实这个是非常灵活的，涉及到的一个点就是特征提取器，U-Net和FCN为什么成功，因为它相当于给了一个网络的框架，具体用什么特征提取器，随便。这个时候，高引就出现了，各种在encoder上的微创新络绎不绝，最直接的就是用ImageNet里面的明星结构来套嘛，前几年的BottleNeck，Residual，还有去年的DenseNet，就比谁出文章快。这一类的论文就相当于从1到10的递进，而U-Net这个低层结构的提出却是从0到1。说句题外话，像这种从1到10的论文，引用往往不会比从0到1的论文高，因为它不自觉的局限了自己的扩展空间，比如我说，我写一篇论文，说特征提取器就必须是dense block，或者必须是residual block效果好，然后名字也就是DenseUNet或者ResUNet，就这样结束了。所以关于backbone到底用什么的问题，并不是我这次要讲的重点。  </p>
<p><img src="/../images/Unet%E5%8F%91%E5%B1%95%E5%8E%86%E7%A8%8B%E5%92%8C%E6%80%9D%E8%B7%AF/encoder.png" alt="encoder"><br>关于到底要多深这个问题，还有一个引申的问题就是，<span style="color:red;"><strong>降采样对于分割网络到底是不是必须的？</strong> </span>问这个问题的原因就是，既然输入和输出都是相同大小的图，为什么要折腾去降采样一下再升采样呢？<br>比较直接的回答当然是降采样的理论意义，我简单朗读一下，它可以增加对输入图像的一些小扰动的鲁棒性，比如图像平移，旋转等，减少过拟合的风险，降低运算量，和增加感受野的大小。升采样的最大的作用其实就是把抽象的特征再还原解码到原图的尺寸，最终得到分割结果。  </p>
<p><img src="/../images/Unet%E5%8F%91%E5%B1%95%E5%8E%86%E7%A8%8B%E5%92%8C%E6%80%9D%E8%B7%AF/Down-sampling.png" alt="Down-sampling"><br><img src="/../images/Unet%E5%8F%91%E5%B1%95%E5%8E%86%E7%A8%8B%E5%92%8C%E6%80%9D%E8%B7%AF/Up-sampling.png" alt="Up-sampling"><br>这些理论的解释都是有道理的，在我的理解中，对于特征提取阶段，浅层结构可以抓取图像的一些简单的特征，比如边界，颜色，而深层结构因为感受野大了，而且经过的卷积操作多了，能抓取到图像的一些说不清道不明的抽象特征，讲的越来越玄学了，总之，浅有浅的侧重，深有深的优势。那我就要问一个比较犀利的问题了，既然浅层特征和深层特征都很重要，U-Net为什么只在4层以后才返回去，也就是只去抓深层特征。我不知道有没有说明白这个问题本身。问题实际是这样的，看这个图，既然 $X^{1,0}$, $X^{2,0}$, $X^{3,0}$, $X^{4,0}$ 所抓取的特征都很重要，为什么我非要降到 $X^{4,0}$ 层了才开始上采样回去呢？<br>这是因为在 U-Net 结构中，降采样操作可以帮助网络抓取更高级别的特征信息。随着网络的层数增加，感受野的大小也随之增加，网络能够捕捉到更广阔的上下文信息。因此，下采样过程中的每一层都可以提供不同层次的特征表示。但是，上采样过程中，只有在到达最深层 $X^{4,0}$ 后，才能开始逐层恢复图像的分辨率，然后将这些特征与对应的上采样层进行融合。这样的设计可以确保网络能够逐步还原图像细节，并更好地进行分割任务。  </p>
<p><img src="/../images/Unet%E5%8F%91%E5%B1%95%E5%8E%86%E7%A8%8B%E5%92%8C%E6%80%9D%E8%B7%AF/U-Net%E7%BB%93%E6%9E%84%E5%9B%BE2.png" alt="U-Net结构图2"></p>
<h2 id="3-主体"><a href="#3-主体" class="headerlink" title="3. 主体"></a>3. 主体</h2><p>沿着这个逻辑往下捋，不知道大家能否猜到我的下一步是什么？此处可以暂停。有没有呼之欲出了？如果排除一切其他干扰，既然我们不知道需要多深，是不是会衍生出一系列像这样子的U-Net，它们的深度不一。这个不难理解吧。为了搞清楚是不是越深越好，我们应该对它们做一下实验，看看它们各自的分割表现：  <img src="/../images/Unet%E5%8F%91%E5%B1%95%E5%8E%86%E7%A8%8B%E5%92%8C%E6%80%9D%E8%B7%AF/U-Net%E6%B7%B1%E6%B5%85%E5%AF%B9%E6%AF%94%E5%9B%BE.png" alt="U-Net深浅对比图"><br>先不要看后两个UNet++，就看这个不同深度的U-Net的表现，我们可以看出，不是越深越好吧，它背后的传达的信息就是，不同层次特征的重要性对于不同的数据集是不一样的，并不是说我设计一个4层的U-Net，就像原论文给出的那个结构，就一定对所有数据集的分割问题都最优。<br>那么接下来是关键，我们心中的目标很明确了，<span style="color:red;"><strong>就是使用浅层和深层的特征!</strong></span>但是总不能训练这些个U-Net吧，未免也太多了。好，这里可以暂停一下，想一想，要你来，你怎么来利用这些不同深度的，各自能抓取不同层次的特征的U-Net。  </p>
<p><img src="/../images/Unet%E5%8F%91%E5%B1%95%E5%8E%86%E7%A8%8B%E5%92%8C%E6%80%9D%E8%B7%AF/%E5%9B%9B%E7%A7%8DU-Net%E6%B7%B1%E6%B5%85%E7%BD%91%E7%BB%9C%E7%BB%93%E6%9E%84%E5%9B%BE.png" alt="四种U-Net深浅网络结构图"><br>我把图打出来就很简单了。<br><img src="/../images/Unet%E5%8F%91%E5%B1%95%E5%8E%86%E7%A8%8B%E5%92%8C%E6%80%9D%E8%B7%AF/%E8%BF%9E%E6%8E%A5%E5%90%84%E5%B1%82U-Net.png" alt="连接各层U-Net"><br>我们来看一看，这样是不是把1～4层的U-Net全给连一起了。我们来看它们的子集，包含1层U-Net，2层U-Net，以此类推。这个结构的好处就是我不管你哪个深度的特征有效，我干脆都给你用上，让网络自己去学习不同深度的特征的重要性。第二个好处是它共享了一个特征提取器，也就是你不需要训练一堆U-Net，而是只训练一个encoder，它的不同层次的特征由不同的decoder路径来还原。这个encoder依旧可以灵活的用各种不同的backbone来代替。<br>可惜的是，这个网络结构是不能被训练的，原因在于，不会由任何梯度会经过这个红色区域，因为它和算loss function的地方是在反向传播时是断开的。我停顿一下，大家想一想是不是这么回事。<br><img src="/../images/Unet%E5%8F%91%E5%B1%95%E5%8E%86%E7%A8%8B%E5%92%8C%E6%80%9D%E8%B7%AF/%E6%97%A0%E6%B3%95%E5%8F%8D%E5%90%91%E4%BC%A0%E6%92%AD%E7%9A%84%E4%BD%8D%E7%BD%AE.png" alt="无法反向传播的位置"><br><span style="color:red;"><strong>请问，如果是你，如何去解决这个问题？</strong></span><br>其实既然已经把结构盘成这样了，还是很自然能想到的吧，我这里提供有两个候选的解决方案。  </p>
<ul>
<li>第一个是用deep supervision，强行加梯度是吧，关于这个，我待会儿展开来说。  </li>
<li>第二个解决方案是把结构改成这样子：</li>
</ul>
<p><img src="/../images/Unet%E5%8F%91%E5%B1%95%E5%8E%86%E7%A8%8B%E5%92%8C%E6%80%9D%E8%B7%AF/Deep%20Layer%20Aggregation.png" alt="Deep%20Layer%20Aggregation"><br>如果没有我上面说的那一堆话来盘逻辑，这个结构可能不那么容易想到，但是如果顺着思路一步一步的走，这个结构虽然不能说是显而易见，也算是顺理成章的。我的故事还没有讲完，但是我提一句，这个结构由UC Berkeley的团队提出，发表在2018年的CVPR上，是一个oral的论文，题目是”<a href="https://link.zhihu.com/?target=http://openaccess.thecvf.com/content_cvpr_2018/papers/Yu_Deep_Layer_Aggregation_CVPR_2018_paper.pdf">Deep Layer Aggregation</a>“。<br>可能就有小伙伴惊呆了，就这样吗，就发了CVPR！？是，也不是。。。这只是他们在论文中给出的关于分割网络结构的改进，他们还做了其他的工作，包括分类，和边缘检测。但是主要的思路就是刚刚盘的那些，目标就是取整合各个不同层次的特征。<br>这只是一个题外话哦，我们继续来看这个结构，<span style="color:red;"><strong>请问，你觉得有什么问题？</strong></span><br>为了回答这个问题，现在我们和上面那个结构对比一下，不难发现这个结构强行去掉了U-Net本身自带的长连接。取而代之的是一系列的短连接。那么我们来看看U-Net引以为傲的长连接到底有什么优点。<br><img src="/../images/Unet%E5%8F%91%E5%B1%95%E5%8E%86%E7%A8%8B%E5%92%8C%E6%80%9D%E8%B7%AF/U-Net%E9%95%BF%E8%BF%9E%E6%8E%A5.png" alt="U-Net长连接"><br>我们认为，U-Net中的长连接是有必要的，它联系了输入图像的很多信息，有助于还原降采样所带来的信息损失，在一定程度上，我觉得它和残差的操作非常类似，也就是residual操作，x+f(x)。我不知道大家是否同意这一个观点。因此，我的建议是最好给出一个综合长连接和短连接的方案。请问，这个方案在你的脑海中是什么样的呢？此处可停顿。<br><img src="/../images/Unet%E5%8F%91%E5%B1%95%E5%8E%86%E7%A8%8B%E5%92%8C%E6%80%9D%E8%B7%AF/Unet++%E7%BB%93%E6%9E%84%E5%9B%BE.png" alt="Unet++结构图"><br>基本上就是这样一个结构没跑了是么。我们来对比一下一开始的U-Net，它其实是这个结构的一个子集。这个结构，就是我们在MICCAI中发表的UNet++。热心的网友可能会问哦，你的UNet++和刚刚说的那个CVPR的论文结构也太像了吧，我说一下这个工作和UC Berkeley的研究是完全两个独立的工作，也算是一个美丽的巧合。UNet++在今年年初时思路就已经成型了，CVPR那篇是我们今年七月份开会的时候看到的，当时UNet++已经被录用了，所以相当于同时提出。另外，和CVPR的那篇论文相比，我还有一个更精彩的点埋在后面说，刚刚也留了一个伏笔。<br>好，当你现在盯着UNet++的时候，不知道会不会冷不丁会冒出来一个问题：<br><span style="color:red;"><strong>这个网络比U-Net效果好，但是这个网络增加了多少的参数，加粗的参数可都是比U-Net多出来的啊？</strong></span><br>这个问题非常的尖锐，实际上是需要设计实验来回答的，如何设计这个实验呢？我们的做法是强行增加U-Net里面的参数量，让它变宽，也就是增加它每个层的卷积核个数。由此，我们设计了一个叫wide U-Net的参考结构，先来看看UNet++的参数数量是9.04M，而U-Net是7.76M，多了差不多16%的参数，所以wide U-Net我们在设计时就让它的参数比UNet++差不多，并且还稍微多一点点，来证明并不是无脑增加参数量，模型效果就会好。  </p>
<p><img src="/../images/Unet%E5%8F%91%E5%B1%95%E5%8E%86%E7%A8%8B%E5%92%8C%E6%80%9D%E8%B7%AF/%E5%8F%82%E6%95%B0%E5%AF%B9%E6%AF%94%E5%9B%BE.png" alt="参数对比图"><br>我本人是认为这个回击力度并不大，因为这样增加参数说心里话有点敷衍，应该能找到更好的对比方法。尽管有不足，我们先来看看结果。  </p>
<p><img src="/../images/Unet%E5%8F%91%E5%B1%95%E5%8E%86%E7%A8%8B%E5%92%8C%E6%80%9D%E8%B7%AF/%E5%8F%82%E6%95%B0-mIoU%E5%AF%B9%E6%AF%94%E5%9B%BE.png" alt="参数-mIoU对比图"><br>根据现有的结果，我的总结是，单纯的把网络变宽，把参数提上去对效果的提升并不大，如何能把参数用在刀刃上是很重要的。那么UNet++这种设计就是将参数用在刀刃上的一个方案。  </p>
<p><img src="/../images/Unet%E5%8F%91%E5%B1%95%E5%8E%86%E7%A8%8B%E5%92%8C%E6%80%9D%E8%B7%AF/Unet++%E7%BB%93%E6%9E%84%E5%9B%BE.png" alt="Unet++结构图"><br>我们在回来看这个UNet++，对于这个主体结构，我给出了一些点评，说白了就是把原来空心的U-Net填满了，优势是可以抓取不同层次的特征，将它们通过特征叠加的方式整合，不同层次的特征，或者说不同大小的感受野，对于大小不一的目标对象的敏感度是不同的，比如，感受野大的特征，可以很容易的识别出大物体的，但是在实际分割中，大物体边缘信息和小物体本身是很容易被深层网络一次次的降采样和一次次升采样给弄丢的，这个时候就可能需要感受野小的特征来帮助。另一个解读就是如果你横着看其中一层的特征叠加过程，就像一个去年很火的DenseNet的结构，非常的巧合，原先的U-Net，横着看就很像是Residual的结构，这个就很有意思了，UNet++对于U-Net分割效果提升可能和DenseNet对于ResNet分类效果的提升，原因如出一辙，因此，在解读中我们也参考了Dense Connection的一些优势，比方说特征的再利用等等。<br>这些解读都是很直观的认识，其实在深度学习里面，某某结构效果优于某某结构的理由，或者你加这个操作比不加操作要好，很多时候是有玄学的味道在里头，也有大量的工作也在探索深度网络的可解释性。关于UNet++的主体结构，我不想花时间赘述了。  </p>
<h2 id="4-高潮"><a href="#4-高潮" class="headerlink" title="4. 高潮"></a>4. 高潮</h2><p>接下来我要说的这部分，非常的有意思。刚刚在讲这里的时候留了一个伏笔，说这个结构在反向传播的时候中间部分会收不到过来的梯度，如果只用最右边的一个loss来做的话。<br>刚才说了，一个非常直接的解决方案就是深监督，也就是deep supervision。这个概念不是新的，有很多对U-Net对改进论文中也有用到，具体的实现操作就是在图中 $X^{1.0}$, $X^{2.0}$ , $X^{3.0}$ , $X^{4.0}$ 后面加一个1x1的卷积核，相当于去监督每个level，或者每个分支的U-Net的输出。<br>我给大家提供三个用Deep Supervision的结构来比较，一个就是这个，第二个是加在UC Berkeley提出的结构上，最后一个是加在UNet++上，<span style="color:red;"><strong>请问是你认为哪个会更棒？</strong></span>这是一个开放问题，我这里不做展开讨论，我一般使用的是最后一个。<br>因为deep supervision具体应该套在哪个结构上面不是我想说的重点，deep supervision的优点也在很多论文中有讲解，我这里想着重讨论的是当它配合上这样一个填满的U-Net结构时，带来其中一个非常棒的优势。此处强烈建议停顿，想一想，<span style="color:red;"><strong>如果我在训练过程中在各个level的子网络中加了这种深监督，可以带来怎样的好处呢？</strong></span><br><img src="/../images/Unet%E5%8F%91%E5%B1%95%E5%8E%86%E7%A8%8B%E5%92%8C%E6%80%9D%E8%B7%AF/%E6%B7%B1%E7%9B%91%E7%9D%A3.png" alt="深监督"><br><span style="color:red;"><strong>两个字：剪枝。</strong></span><br>同时引出三个问题：  </p>
<ul>
<li><strong>为什么UNet++可以被剪枝</strong></li>
<li><strong>如何剪枝</strong></li>
<li><strong>好处在哪里</strong></li>
</ul>
<p><img src="/../images/Unet%E5%8F%91%E5%B1%95%E5%8E%86%E7%A8%8B%E5%92%8C%E6%80%9D%E8%B7%AF/%E6%B7%B1%E7%9B%91%E7%9D%A3%E4%B8%8B%E7%9A%84%E5%AD%90%E7%BD%91%E7%BB%9C.png" alt="深监督下的子网络"><br>我们来看看为什么可以剪枝，这张图特别的精彩。关注被剪掉的这部分，你会发现，在测试的阶段，由于输入的图像只会前向传播，扔掉这部分对前面的输出完全没有影响的，而在训练阶段，因为既有前向，又有反向传播，被剪掉的部分是会帮助其他部分做权重更新的。这两句话同样重要，我再重复一遍，测试时，剪掉部分对剩余结构不做影响，训练时，剪掉部分对剩余部分有影响。这意味什么？<br>因为在深监督的过程中，每个子网络的输出都其实已经是图像的分割结果了，所以如果小的子网络的输出结果已经足够好了，我们可以随意的剪掉那些多余的部分了。<br>来看一下这个动图，为了定义的方便起见，我们把每个剪完剩下的子网络根据它们的深度命名为UNet++ L1，L2，L3，L4，后面会简称为L1～L4。最理想的状态是什么？当然是L1喽，如果L1的输出结果足够好，剪完以后的分割网络会变得非常的小。<br>这里我想问两个问题：</p>
<ul>
<li><strong>为什么要在测试的时候剪枝，而不是直接拿剪完的L1，L2，L3训练？</strong></li>
<li><strong>怎么去决定剪多少？</strong></li>
</ul>
<p>对于为什么要在测试的时候剪枝，而不是直接拿剪完的L1，L2，L3训练，我们的解释其实上一页ppt上面写了，剪掉的部分在训练时的反向传播中是有贡献的，如果直接拿L1，L2，L3训练，就相当于只训练了不同深度的U-Net，最后的结果会很差。<br>第二个问题，如何去决定剪多少，还是比较好回答的。因为在训练模型的时候会把数据分为训练集，验证集和测试集，训练集上是一定拟合的很好的，测试集是我们不能碰的，所以我们会根据子网络在验证集的结果来决定剪多少。所谓的验证集就是一开始从训练集中分出来的数据，用来监测训练过程用的。<br>好，讲完了思路，我们来看结果。<br><img src="/../images/Unet%E5%8F%91%E5%B1%95%E5%8E%86%E7%A8%8B%E5%92%8C%E6%80%9D%E8%B7%AF/%E5%89%AA%E6%9E%9D%E7%BB%93%E6%9E%9C.png" alt="剪枝结果"><br>先看看L1～L4的网络参数量，差了好多，L1只有0.1M，而L4有9M，也就是理论上如果L1的结果我是满意的，那么模型可以被剪掉的参数达到98.8%。不过根据我们的四个数据集，L1的效果并不会那么好，因为太浅了嘛。但是其中有三个数据集显示L2的结果和L4已经非常接近了，也就是说对于这三个数据集，在测试阶段，我们不需要用9M的网络，用半M的网络足够了。<br>回想一下一开始我提出的问题，网络需要多深合适，这幅图是不是就一目了然。网络的深度和数据集的难度是有关系的，这四个数据集当中，第二个，也就是息肉分割是最难的，大家可以看到纵坐标，它代表分割的评价指标，越大越好，其他都能达到挺高的，但是唯独息肉分割只有在30左右，对于比较难的数据集，可以看到网络越深，它的分割结果是在不断上升的。对于大多数比较简单的分割问题，其实并不需要非常深，非常大的网络就可以达到很不错的精度了。<br>横坐标代表的是在测试阶段，单显卡12G的TITAN X (Pascal)下，分割一万张图需要的时间。我们可以看到不同的模型大小，测试的时间差好多。如果比较L2和L4的话，就差了三倍之多。<br><img src="/../images/Unet%E5%8F%91%E5%B1%95%E5%8E%86%E7%A8%8B%E5%92%8C%E6%80%9D%E8%B7%AF/%E9%80%9F%E5%BA%A6%E6%B5%8B%E8%AF%95.png" alt="速度测试"><br>对于测试的速度，用这一幅图会更清晰。我们统计了用不同的模型，1秒钟可以分割多少的图。如果用L2来代替L4的话，速度确实能提升三倍。<br>剪枝应用最多的就是在移动手机端了，根据模型的参数量，如果L2得到的效果和L4相近，模型的内存可以省18倍。还是非常可观的数目。<br>关于剪枝的这部分我认为是对原先的U-Net的一个很大的改观，原来的结构过于刻板，并且没有很好的利用不用层级的特征。<br>简单的总结一下，UNet++的第一个优势就是精度的提升，这个应该它整合了不同层次的特征所带来的，第二个是灵活的网络结构配合深监督，让参数量巨大的深度网络在可接受的精度范围内大幅度的缩减参数量。  </p>
<h2 id="5-说在后面"><a href="#5-说在后面" class="headerlink" title="5. 说在后面"></a>5. 说在后面</h2><p>再次放上UNet++结构<br><img src="/../images/Unet%E5%8F%91%E5%B1%95%E5%8E%86%E7%A8%8B%E5%92%8C%E6%80%9D%E8%B7%AF/UNet++%E7%BB%93%E6%9E%84%E5%AE%8C%E6%95%B4%E7%89%88.png" alt="UNet++结构完整版"><br>回顾一下这次分享，就这么个分割网络，都能说这么久，要我说就放个结构图，说这个网络很牛逼，再告知一下代码在哪儿，谢谢大家就完事儿了。<br>其实搞学术做研究不是这样子的，UNet++肯定马上就会被更强的结构所代替，但是要设计出更强的结构，你得首先明白这个结构，甚至它的原型U-Net设计背后的心路历程。与其和大家分享一个苍白的分割网络，我更愿意分享的是这个项目背后从开始认识U-Net，到分析它的组成，到批判性的解读，再到改进思路的形成，实验设计，像刚刚分享过程中一次次尴尬的自问自答，中间那些非常饱满的心路历程。这也是我自己在学术生涯中学到的做研究的范式。<br>说句题外话，就跟玩狼人杀一样，你一上来就说自己预言家，验了谁谁谁，那没人信的呀，你得说清楚为什么要验他，警徽怎么留，把这些心路历程都盘盘清楚，身份才能做实。<br>其实网络结构怎么样真的不重要，重要的是你怎么能把故事给讲清楚，要是讲完以后还能够引起更多的思考和讨论那就更好了。  </p>
<h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><p><a target="_blank" rel="noopener" href="https://github.com/mrgloom/awesome-semantic-segmentation">语义分割网络代码汇总</a><br><a target="_blank" rel="noopener" href="https://github.com/handong1587/handong1587.github.io/blob/master/_posts/deep_learning/2015-10-09-segmentation.md">语义分割论文汇总</a><br><a target="_blank" rel="noopener" href="https://medium.com/@mikeliao/deep-layer-aggregation-combining-layers-in-nn-architectures-2744d29cab8">深层聚合思想</a><br><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/44958351">研习U-Net</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://abelxiaoxing.github.io/2024/07/22/Windows%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE%E5%AE%8C%E5%85%A8%E6%8C%87%E5%8D%97/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="abelxiaoxing">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="abel的小天地">
      <meta itemprop="description" content="一个个人资料记录的小地方">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | abel的小天地">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/07/22/Windows%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE%E5%AE%8C%E5%85%A8%E6%8C%87%E5%8D%97/" class="post-title-link" itemprop="url">Windows环境配置完全指南</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-07-22 17:10:00" itemprop="dateCreated datePublished" datetime="2024-07-22T17:10:00+08:00">2024-07-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-03-21 15:16:21" itemprop="dateModified" datetime="2025-03-21T15:16:21+08:00">2025-03-21</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Windows/" itemprop="url" rel="index"><span itemprop="name">Windows</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="终端代理配置"><a href="#终端代理配置" class="headerlink" title="终端代理配置"></a>终端代理配置</h2><h3 id="配置步骤"><a href="#配置步骤" class="headerlink" title="配置步骤"></a>配置步骤</h3><ol>
<li>安装Windows Terminal（推荐使用Microsoft Store安装最新版本）</li>
<li>配置系统环境变量，设置Windows Terminal的代理</li>
</ol>
<p><img src="/../images/Windows%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE%E5%AE%8C%E5%85%A8%E6%8C%87%E5%8D%97/%E7%B3%BB%E7%BB%9F%E4%BB%A3%E7%90%86%E9%85%8D%E7%BD%AE.png" alt="系统代理配置"></p>
<h2 id="Windows-Terminal设置"><a href="#Windows-Terminal设置" class="headerlink" title="Windows Terminal设置"></a>Windows Terminal设置</h2><h3 id="解决x2go弹窗问题"><a href="#解决x2go弹窗问题" class="headerlink" title="解决x2go弹窗问题"></a>解决x2go弹窗问题</h3><ol>
<li>打开Windows Terminal应用程序</li>
<li>进入设置面板</li>
<li>选择左侧的「启动」选项</li>
<li>在右侧面板中，将「默认终端应用程序」修改为「Windows 控制台主机」</li>
</ol>
<h2 id="WSL2配置指南"><a href="#WSL2配置指南" class="headerlink" title="WSL2配置指南"></a>WSL2配置指南</h2><h3 id="基础安装"><a href="#基础安装" class="headerlink" title="基础安装"></a>基础安装</h3><ol>
<li>在管理员权限的终端中执行以下命令安装WSL2：<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wsl <span class="literal">--install</span></span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="迁移WSL2到其他磁盘"><a href="#迁移WSL2到其他磁盘" class="headerlink" title="迁移WSL2到其他磁盘"></a>迁移WSL2到其他磁盘</h3><ol>
<li><p>查看当前运行的WSL实例：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wsl <span class="literal">-l</span> <span class="literal">-v</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>终止正在运行的实例：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wsl <span class="literal">--terminate</span> &lt;instance_name&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>导出WSL实例：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wsl <span class="literal">--export</span> &lt;instance_name&gt; D:\export.tar</span><br></pre></td></tr></table></figure>
</li>
<li><p>卸载原有实例：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wsl <span class="literal">--unregister</span> &lt;instance_name&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>导入WSL实例到新位置：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wsl <span class="literal">--import</span> &lt;instance_name&gt; D:\import\ D:\export.tar <span class="literal">--version</span> <span class="number">2</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>注：<code>--version 2</code>参数可选，现代WSL默认使用WSL2版本</p>
</blockquote>
</li>
</ol>
<h3 id="启用systemd"><a href="#启用systemd" class="headerlink" title="启用systemd"></a>启用systemd</h3><p>WSL2默认使用传统的init系统，建议切换到更现代的systemd以获得更好的服务管理体验。</p>
<ol>
<li><p>编辑WSL配置文件：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> vim /etc/wsl.conf</span><br></pre></td></tr></table></figure>
</li>
<li><p>添加以下配置：</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[boot]</span></span><br><span class="line"><span class="attr">systemd</span>=<span class="literal">true</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>设置配置文件权限：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> <span class="built_in">chmod</span> +x /etc/init.wsl</span><br></pre></td></tr></table></figure>
</li>
<li><p>重启WSL：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wsl <span class="literal">--shutdown</span></span><br><span class="line">wsl</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="配置WSL2网络代理"><a href="#配置WSL2网络代理" class="headerlink" title="配置WSL2网络代理"></a>配置WSL2网络代理</h3><ol>
<li>创建或编辑<code>C:\Users\&lt;UserName&gt;\.wslconfig</code>文件</li>
<li>添加以下配置：<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[wsl2]</span></span><br><span class="line"><span class="attr">networkingMode</span>=mirrored</span><br><span class="line"><span class="attr">ipv6</span>=<span class="literal">true</span></span><br><span class="line"><span class="attr">dnsTunneling</span>=<span class="literal">true</span></span><br><span class="line"><span class="attr">autoProxy</span>=<span class="literal">true</span></span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="配置WSL2自动启动"><a href="#配置WSL2自动启动" class="headerlink" title="配置WSL2自动启动"></a>配置WSL2自动启动</h3><ol>
<li>按<code>Win+R</code>打开运行对话框，输入<code>shell:startup</code></li>
<li>在启动文件夹中创建<code>wsl-start.vbs</code>文件，添加以下内容：<figure class="highlight vbscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Set</span> ws = WScript.<span class="built_in">CreateObject</span>(<span class="string">&quot;WScript.Shell&quot;</span>)        </span><br><span class="line">ws.run <span class="string">&quot;wsl&quot;</span>, vbhide</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="FRP客户端自启动配置"><a href="#FRP客户端自启动配置" class="headerlink" title="FRP客户端自启动配置"></a>FRP客户端自启动配置</h2><h3 id="创建启动脚本"><a href="#创建启动脚本" class="headerlink" title="创建启动脚本"></a>创建启动脚本</h3><ol>
<li>在FRP客户端目录下创建<code>start.bat</code>文件：<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@echo off</span><br><span class="line">:home</span><br><span class="line">frpc -c frpc.ini</span><br><span class="line">goto home</span><br></pre></td></tr></table></figure>
此脚本可以确保FRP客户端在异常退出后自动重启。</li>
</ol>
<h3 id="配置开机自启动"><a href="#配置开机自启动" class="headerlink" title="配置开机自启动"></a>配置开机自启动</h3><h4 id="方法一：使用启动文件夹（简单但会显示命令行窗口）"><a href="#方法一：使用启动文件夹（简单但会显示命令行窗口）" class="headerlink" title="方法一：使用启动文件夹（简单但会显示命令行窗口）"></a>方法一：使用启动文件夹（简单但会显示命令行窗口）</h4><ol>
<li>右键<code>start.bat</code>创建快捷方式</li>
<li>将快捷方式复制到以下目录：<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\&lt;UserName&gt;\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup\</span><br></pre></td></tr></table></figure></li>
</ol>
<h4 id="方法二：使用任务计划程序（推荐，可隐藏窗口）"><a href="#方法二：使用任务计划程序（推荐，可隐藏窗口）" class="headerlink" title="方法二：使用任务计划程序（推荐，可隐藏窗口）"></a>方法二：使用任务计划程序（推荐，可隐藏窗口）</h4><ol>
<li>打开任务计划程序（在开始菜单搜索”任务计划程序”）</li>
<li>创建新任务：<br><img src="/../images/Windows%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE%E5%AE%8C%E5%85%A8%E6%8C%87%E5%8D%97/%E4%BB%BB%E5%8A%A1%E8%AE%A1%E5%88%92%E7%A8%8B%E5%BA%8F%E5%B8%B8%E8%A7%84%E8%AE%BE%E7%BD%AE.png.png" alt="任务计划程序常规设置"><br><img src="/../images/Windows%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE%E5%AE%8C%E5%85%A8%E6%8C%87%E5%8D%97/%E5%88%9B%E5%BB%BA%E4%BB%BB%E5%8A%A1%E8%AE%BE%E7%BD%AE.png" alt="创建任务设置"><ul>
<li>【常规】选项卡：<ul>
<li>设置任务名称</li>
<li>选择”不管用户是否登录都要运行”</li>
<li>勾选”使用最高权限运行”</li>
<li>勾选”隐藏”<br><img src="/../images/Windows%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE%E5%AE%8C%E5%85%A8%E6%8C%87%E5%8D%97/%E4%BB%BB%E5%8A%A1%E8%AE%A1%E5%88%92%E7%A8%8B%E5%BA%8F%E8%A7%A6%E5%8F%91%E5%99%A8%E8%AE%BE%E7%BD%AE.png" alt="任务计划程序触发器设置"></li>
</ul>
</li>
<li>【触发器】选项卡：<ul>
<li>新建触发器</li>
<li>选择”启动时”<br><img src="/../images/Windows%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE%E5%AE%8C%E5%85%A8%E6%8C%87%E5%8D%97/%E4%BB%BB%E5%8A%A1%E8%AE%A1%E5%88%92%E7%A8%8B%E5%BA%8F%E6%93%8D%E4%BD%9C%E8%AE%BE%E7%BD%AE.png" alt="任务计划程序操作设置"></li>
</ul>
</li>
<li>【操作】选项卡：<ul>
<li>新建操作</li>
<li>选择”启动程序”</li>
<li>程序&#x2F;脚本：选择<code>start.bat</code>的完整路径</li>
<li>起始位置：填写<code>start.bat</code>所在目录</li>
</ul>
</li>
</ul>
</li>
</ol>
<p>完成配置后，返回 “常规” 页，点击确定，此时会要求输入密码，输入你的电脑密码，然后点击确定即可。FRP客户端将在系统启动时自动运行，且不会显示命令行窗口。<br>   <img src="/../images/Windows%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE%E5%AE%8C%E5%85%A8%E6%8C%87%E5%8D%97/%E4%BB%BB%E5%8A%A1%E8%AE%A1%E5%88%92%E7%A8%8B%E5%BA%8F%E7%A1%AE%E8%AE%A4%E9%A1%B5%E9%9D%A2.png" alt="任务计划程序确认页面"></p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul>
<li><a target="_blank" rel="noopener" href="https://docs.microsoft.com/zh-cn/windows/wsl/">WSL2官方文档</a></li>
<li><a target="_blank" rel="noopener" href="https://gofrp.org/docs/">FRP项目文档</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.microsoft.com/zh-cn/windows/terminal/">Windows Terminal文档</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/C_C666/article/details/127619978">任务计划程序使用指南</a></li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" title="下一页" aria-label="下一页" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">abelxiaoxing</span>
  </div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script>

  






  





</body>
</html>
